<div class="error-details-container">
  <div class="page-header">
    <div class="header-left">
      <button
        mat-icon-button
        color="primary"
        (click)="goBack()"
        class="back-button"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="page-title">Error Details</h1>
    </div>

    <div class="header-actions" *ngIf="error">
      <button
        mat-raised-button
        color="primary"
        [disabled]="error.resolved || resolvingError"
        (click)="markAsResolved()"
      >
        <mat-icon>check_circle</mat-icon>
        <span *ngIf="!resolvingError">Mark as Resolved</span>
        <span *ngIf="resolvingError">Resolving...</span>
      </button>

      <button
        mat-raised-button
        color="accent"
        *ngIf="error.jobId"
        (click)="viewJob()"
      >
        <mat-icon>work</mat-icon>
        View Job
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Error Details Content -->
  <div class="details-content" *ngIf="!loading && error">
    <!-- Overview Card -->
    <mat-card class="details-card">
      <mat-card-header>
        <mat-card-title>Error Overview</mat-card-title>
        <mat-card-subtitle>
          <div class="status-badge" [ngClass]="getStatusColor(error.status)">
            {{ error.status }} - {{ getStatusText(error.status) }}
          </div>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <div class="overview-grid">
          <div class="grid-item">
            <div class="item-label">Timestamp</div>
            <div class="item-value">{{ formatDate(error.timestamp) }}</div>
          </div>

          <div class="grid-item" *ngIf="error.jobId">
            <div class="item-label">Job ID</div>
            <div class="item-value job-link" (click)="viewJob()">
              {{ error.jobId }}
            </div>
          </div>

          <div class="grid-item">
            <div class="item-label">Method</div>
            <div class="item-value">{{ error.method || "N/A" }}</div>
          </div>

          <div class="grid-item">
            <div class="item-label">Endpoint</div>
            <div class="item-value">{{ error.endpoint || "N/A" }}</div>
          </div>

          <div class="grid-item">
            <div class="item-label">Retry Count</div>
            <div
              class="item-value"
              [ngClass]="{ 'high-retry': error.retryCount > 2 }"
            >
              {{ error.retryCount }}
            </div>
          </div>

          <div class="grid-item">
            <div class="item-label">Status</div>
            <div class="item-value">
              <span
                class="status-chip"
                [ngClass]="error.resolved ? 'resolved' : 'open'"
              >
                {{ error.resolved ? "Resolved" : "Open" }}
              </span>
              <span *ngIf="error.resolved && error.resolvedAt">
                ({{ formatDate(error.resolvedAt) }})
              </span>
            </div>
          </div>

          <div class="grid-item" *ngIf="error.userId">
            <div class="item-label">User ID</div>
            <div class="item-value">{{ error.userId }}</div>
          </div>

          <div class="grid-item" *ngIf="error.ipAddress">
            <div class="item-label">IP Address</div>
            <div class="item-value">{{ error.ipAddress }}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Error Message and Stack Trace -->
    <mat-card class="details-card">
      <mat-card-header>
        <mat-card-title>Error Message</mat-card-title>
        <button
          mat-icon-button
          color="primary"
          matTooltip="Copy error message"
          (click)="copyToClipboard(error.message)"
        >
          <mat-icon>content_copy</mat-icon>
        </button>
      </mat-card-header>

      <mat-card-content>
        <div class="error-message">
          {{ error.message }}
        </div>

        <mat-divider *ngIf="error.stackTrace"></mat-divider>

        <div *ngIf="error.stackTrace" class="stack-trace-container">
          <div class="section-header">
            <h3>Stack Trace</h3>
            <button
              mat-icon-button
              color="primary"
              matTooltip="Copy stack trace"
              (click)="copyToClipboard(error.stackTrace)"
            >
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>

          <pre class="stack-trace">{{ error.stackTrace }}</pre>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Request and Response -->
    <mat-card
      class="details-card"
      *ngIf="error.requestBody || error.responseBody"
    >
      <mat-card-header>
        <mat-card-title>Request & Response</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <!-- Request Body -->
        <div *ngIf="error.requestBody" class="request-response-container">
          <div class="section-header">
            <h3>Request Body</h3>
            <button
              mat-icon-button
              color="primary"
              matTooltip="Copy request body"
              (click)="copyToClipboard(error.requestBody)"
            >
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>

          <pre class="code-block">{{ formatJson(error.requestBody) }}</pre>
        </div>

        <mat-divider
          *ngIf="error.requestBody && error.responseBody"
        ></mat-divider>

        <!-- Response Body -->
        <div *ngIf="error.responseBody" class="request-response-container">
          <div class="section-header">
            <h3>Response Body</h3>
            <button
              mat-icon-button
              color="primary"
              matTooltip="Copy response body"
              (click)="copyToClipboard(error.responseBody)"
            >
              <mat-icon>content_copy</mat-icon>
            </button>
          </div>

          <pre class="code-block">{{ formatJson(error.responseBody) }}</pre>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Headers -->
    <mat-card class="details-card" *ngIf="error.headers">
      <mat-card-header>
        <mat-card-title>Headers</mat-card-title>
        <button
          mat-icon-button
          color="primary"
          matTooltip="Copy headers"
          (click)="copyToClipboard(formatJson(error.headers))"
        >
          <mat-icon>content_copy</mat-icon>
        </button>
      </mat-card-header>

      <mat-card-content>
        <div class="headers-container">
          <div
            class="header-item"
            *ngFor="let header of error.headers | keyvalue"
          >
            <div class="header-name">{{ header.key }}</div>
            <div class="header-value">{{ header.value }}</div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Error State -->
  <div class="not-found-container" *ngIf="!loading && !error">
    <mat-icon class="not-found-icon">error_outline</mat-icon>
    <h2>Error log not found</h2>
    <p>The error log you're looking for doesn't exist or has been deleted.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Error Logs
    </button>
  </div>
</div>
