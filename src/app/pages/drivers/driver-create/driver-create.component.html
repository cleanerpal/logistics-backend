<mat-card class="mat-elevation-z3">
  <!-- Loading indicator -->
  <div class="loading-overlay" *ngIf="isSubmitting">
    <mat-spinner diameter="40"></mat-spinner>
    <span>{{ isEditMode ? "Updating driver..." : "Creating driver..." }}</span>
  </div>

  <!-- Header -->
  <div class="header-wrapper">
    <div class="header-title">
      <button mat-icon-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>{{ isEditMode ? "Edit Driver" : "New Driver" }}</h1>
    </div>
  </div>

  <!-- Form -->
  <form [formGroup]="driverForm" (ngSubmit)="onSubmit()" class="form-container">
    <div class="form-section">
      <h2 class="section-title">Personal Details</h2>

      <!-- Name Row -->
      <div class="form-row">
        <!-- First Name -->
        <mat-form-field appearance="outline">
          <mat-label>First Name</mat-label>
          <input
            matInput
            formControlName="firstName"
            placeholder="Enter first name"
          />
          <mat-error *ngIf="driverForm.get('firstName')?.hasError('required')">
            First name is required
          </mat-error>
        </mat-form-field>

        <!-- Last Name -->
        <mat-form-field appearance="outline">
          <mat-label>Last Name</mat-label>
          <input
            matInput
            formControlName="lastName"
            placeholder="Enter last name"
          />
          <mat-error *ngIf="driverForm.get('lastName')?.hasError('required')">
            Last name is required
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Contact Row -->
      <div class="form-row">
        <!-- Email -->
        <mat-form-field appearance="outline">
          <mat-label>Email</mat-label>
          <input
            type="email"
            matInput
            formControlName="email"
            placeholder="Enter email address"
          />
          <mat-error *ngIf="driverForm.get('email')?.hasError('required')">
            Email is required
          </mat-error>
          <mat-error *ngIf="driverForm.get('email')?.hasError('email')">
            Please enter a valid email address
          </mat-error>
          <mat-hint *ngIf="isEditMode"
            >Email cannot be changed after creation</mat-hint
          >
        </mat-form-field>

        <!-- Phone -->
        <mat-form-field appearance="outline">
          <mat-label>Phone Number</mat-label>
          <input
            matInput
            formControlName="phone"
            placeholder="Enter phone number"
          />
          <mat-error *ngIf="driverForm.get('phone')?.hasError('required')">
            Phone number is required
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Driver ID (optional) -->
      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Driver ID (Optional)</mat-label>
          <input
            matInput
            formControlName="driverId"
            placeholder="Auto-generated if left empty"
          />
          <mat-hint>Leave blank for auto-generated ID</mat-hint>
        </mat-form-field>
      </div>

      <!-- Address -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Address</mat-label>
        <textarea
          matInput
          formControlName="address"
          placeholder="Enter address"
          rows="3"
        ></textarea>
      </mat-form-field>
    </div>

    <div class="form-section">
      <h2 class="section-title">Company Information</h2>

      <!-- Company -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Company</mat-label>
        <mat-select formControlName="company">
          <mat-option>None</mat-option>
          <mat-option *ngFor="let company of companies" [value]="company.id">
            {{ company.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Company Name (if not in dropdown) -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Company Name (if not in list)</mat-label>
        <input
          matInput
          formControlName="companyName"
          placeholder="Enter company name if not in dropdown"
        />
        <mat-hint
          >Only fill if the company is not in the dropdown above</mat-hint
        >
      </mat-form-field>
    </div>

    <div class="form-section">
      <h2 class="section-title">Driver Details</h2>

      <!-- Status -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Status</mat-label>
        <mat-select formControlName="status">
          <mat-option
            *ngFor="let status of statusOptions"
            [value]="status.value"
          >
            {{ status.label }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="driverForm.get('status')?.hasError('required')">
          Status is required
        </mat-error>
      </mat-form-field>

      <!-- License Information -->
      <div class="form-row">
        <!-- License Number -->
        <mat-form-field appearance="outline">
          <mat-label>License Number</mat-label>
          <input
            matInput
            formControlName="licenseNumber"
            placeholder="Enter license number"
          />
        </mat-form-field>

        <!-- License Type -->
        <mat-form-field appearance="outline">
          <mat-label>License Type</mat-label>
          <mat-select formControlName="licenseType">
            <mat-option>None</mat-option>
            <mat-option *ngFor="let type of licenseTypes" [value]="type">
              {{ type }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <!-- License Expiry Date -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>License Expiry Date</mat-label>
        <input
          matInput
          [matDatepicker]="expiryPicker"
          formControlName="licenseExpiry"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="expiryPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #expiryPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <div class="form-section">
      <h2 class="section-title">Additional Information</h2>

      <!-- Notes -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Notes</mat-label>
        <textarea
          matInput
          formControlName="notes"
          placeholder="Enter additional notes about the driver"
          rows="3"
        ></textarea>
      </mat-form-field>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <button mat-stroked-button type="button" (click)="goBack()">
        Cancel
      </button>
      <button
        mat-flat-button
        color="primary"
        type="submit"
        [disabled]="driverForm.invalid || isSubmitting"
      >
        {{
          isSubmitting
            ? "Saving..."
            : isEditMode
            ? "Update Driver"
            : "Create Driver"
        }}
      </button>
    </div>
  </form>
</mat-card>
