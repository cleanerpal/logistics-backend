<div class="vehicle-jobs-container">
  <div class="page-header">
    <div class="title-section">
      <button
        mat-icon-button
        color="primary"
        (click)="goBack()"
        class="back-button"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="page-title">
        Vehicle Jobs:
        <span class="vehicle-info" *ngIf="vehicleData">
          {{ vehicleData.make }} {{ vehicleData.model }} ({{
            vehicleData.registration
          }})
        </span>
      </h1>
    </div>
  </div>

  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Jobs table -->
  <div class="table-container" *ngIf="!loading">
    <table mat-table [dataSource]="dataSource" matSort class="jobs-table">
      <!-- Job ID Column -->
      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Job ID</th>
        <td mat-cell *matCellDef="let job">{{ job.id }}</td>
      </ng-container>

      <!-- Vehicle Column -->
      <ng-container matColumnDef="vehicle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Vehicle</th>
        <td mat-cell *matCellDef="let job">
          {{ job.vehicleMake }} {{ job.vehicleModel }}
          <div class="vehicle-reg">{{ job.vehicleRegistration }}</div>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let job">
          <span
            class="status-badge"
            [style.background-color]="getStatusColor(job.status)"
          >
            {{ job.status }}
          </span>
        </td>
      </ng-container>

      <!-- Delivery Date Column -->
      <ng-container matColumnDef="deliveryDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Scheduled Delivery
        </th>
        <td mat-cell *matCellDef="let job">
          {{ formatDate(job.deliveryDate) }}
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let job">
          <button
            mat-icon-button
            color="primary"
            [matTooltip]="'Edit Job'"
            (click)="editJob(job.id); $event.stopPropagation()"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Row definitions -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr
        mat-row
        *matRowDef="let job; columns: displayedColumns"
        (click)="editJob(job.id)"
        class="job-row"
      ></tr>

      <!-- No data row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="5">No jobs found for this vehicle</td>
      </tr>
    </table>

    <!-- Paginator -->
    <mat-paginator
      [pageSizeOptions]="[10, 25, 50]"
      [pageSize]="50"
      showFirstLastButtons
      aria-label="Select page of jobs"
    >
    </mat-paginator>
  </div>
</div>
