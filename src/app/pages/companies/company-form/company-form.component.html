<div class="company-form-container">
  <div class="page-header">
    <h1 class="page-title">
      {{ isEditMode ? "Edit Company" : "Create Company" }}
    </h1>
  </div>

  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Company form -->
  <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" *ngIf="!loading">
    <!-- Company Information Section -->
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>Company Information</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row row-split">
          <mat-form-field appearance="outline">
            <mat-label>Company Name</mat-label>
            <input matInput formControlName="companyName" />
            <mat-error
              *ngIf="companyForm.get('companyName')?.hasError('required')"
            >
              Company name is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Contact Name</mat-label>
            <input matInput formControlName="name" />
            <mat-error *ngIf="companyForm.get('name')?.hasError('required')">
              Contact name is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row row-split">
          <mat-form-field appearance="outline">
            <mat-label>Phone</mat-label>
            <input
              matInput
              formControlName="phone"
              placeholder="e.g. 07700900000"
            />
            <mat-error *ngIf="companyForm.get('phone')?.hasError('required')">
              Phone number is required
            </mat-error>
            <mat-error *ngIf="companyForm.get('phone')?.hasError('pattern')">
              Please enter a valid UK phone number
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput formControlName="email" type="email" />
            <mat-error *ngIf="companyForm.get('email')?.hasError('required')">
              Email is required
            </mat-error>
            <mat-error *ngIf="companyForm.get('email')?.hasError('email')">
              Please enter a valid email address
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Address Section -->
    <mat-card class="form-card">
      <mat-card-header>
        <mat-card-title>Primary Address</mat-card-title>
        <mat-card-subtitle *ngIf="isEditMode">
          Additional addresses can be managed through the Manage Addresses page
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Street Address</mat-label>
            <input matInput formControlName="street" />
            <mat-error *ngIf="companyForm.get('street')?.hasError('required')">
              Street address is required
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row row-split">
          <mat-form-field appearance="outline">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" />
            <mat-error *ngIf="companyForm.get('city')?.hasError('required')">
              City is required
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>State/County</mat-label>
            <input matInput formControlName="state" />
          </mat-form-field>
        </div>

        <div class="form-row row-split">
          <mat-form-field appearance="outline">
            <mat-label>Postcode</mat-label>
            <input matInput formControlName="postcode" />
            <mat-error
              *ngIf="companyForm.get('postcode')?.hasError('required')"
            >
              Postcode is required
            </mat-error>
            <mat-error *ngIf="companyForm.get('postcode')?.hasError('pattern')">
              Please enter a valid UK postcode
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Country</mat-label>
            <input matInput formControlName="country" />
            <mat-error *ngIf="companyForm.get('country')?.hasError('required')">
              Country is required
            </mat-error>
          </mat-form-field>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" mat-stroked-button (click)="onCancel()">
        <mat-icon>cancel</mat-icon>
        Cancel
      </button>

      <button
        type="submit"
        mat-raised-button
        color="primary"
        [disabled]="saving"
      >
        <mat-spinner diameter="20" *ngIf="saving"></mat-spinner>
        <span *ngIf="!saving">
          <mat-icon>save</mat-icon>
          {{ isEditMode ? "Update" : "Create" }} Company
        </span>
      </button>
    </div>
  </form>
</div>
