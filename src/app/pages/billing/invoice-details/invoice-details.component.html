<!-- invoice-details.component.html -->
<div class="invoice-details-container">
  <div class="page-header">
    <div class="title-section">
      <button
        mat-icon-button
        color="primary"
        (click)="goBack()"
        class="back-button"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="page-title">Invoice Details</h1>
    </div>
  </div>

  <!-- Loading spinner -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
  </div>

  <!-- Invoice content -->
  <div class="invoice-content" *ngIf="!loading && invoice">
    <!-- Invoice header actions -->
    <div class="invoice-actions">
      <button
        mat-raised-button
        color="primary"
        class="action-button"
        *ngIf="invoice.status === 'Draft'"
        (click)="sendInvoice()"
      >
        <mat-icon>email</mat-icon>
        Send to Customer
      </button>

      <button
        mat-raised-button
        color="accent"
        class="action-button"
        *ngIf="invoice.status === 'Sent' || invoice.status === 'Overdue'"
        (click)="markAsPaid()"
      >
        <mat-icon>check_circle</mat-icon>
        Mark as Paid
      </button>

      <button
        mat-stroked-button
        color="primary"
        class="action-button"
        (click)="editInvoice()"
      >
        <mat-icon>edit</mat-icon>
        Edit
      </button>

      <button
        mat-stroked-button
        color="primary"
        class="action-button"
        (click)="downloadInvoice()"
      >
        <mat-icon>download</mat-icon>
        Download
      </button>
    </div>

    <!-- Invoice PDF preview -->
    <div class="invoice-pdf">
      <!-- PDF header with logo -->
      <div class="pdf-header">
        <div class="company-logo">
          <div class="logo-placeholder">NI Vehicle Logistics</div>
        </div>
        <div class="invoice-info">
          <h2 class="invoice-title">INVOICE</h2>
          <div class="invoice-number">{{ invoice.invoiceNumber }}</div>
          <div class="invoice-date">
            Date: {{ formatDate(invoice.createdAt) }}
          </div>
          <div class="invoice-due-date">
            Due: {{ formatDate(invoice.dueDate) }}
          </div>
          <div
            class="invoice-status"
            [ngClass]="'status-' + invoice.status.toLowerCase()"
          >
            {{ invoice.status }}
          </div>
        </div>
      </div>

      <!-- Customer and company info -->
      <div class="pdf-address-section">
        <div class="company-details">
          <div class="company-name">NI Vehicle Logistics Ltd</div>
          <div class="company-address">123 Transport Way</div>
          <div class="company-address">Belfast, BT1 1AA</div>
          <div class="company-phone">Phone: +44 28 1234 5678</div>
          <div class="company-email">Email: accounts&#64;nivehicle.com</div>
        </div>

        <div class="customer-details">
          <div class="section-title">Bill To:</div>
          <div class="customer-name">{{ invoice.customerName }}</div>
          <div class="customer-company" *ngIf="invoice.customerCompany">
            {{ invoice.customerCompany }}
          </div>
          <div class="customer-address">{{ invoice.customerAddress }}</div>
          <div class="customer-email">{{ invoice.customerEmail }}</div>
        </div>
      </div>

      <!-- Invoice items -->
      <div class="pdf-items-section">
        <table class="invoice-items-table">
          <thead>
            <tr>
              <th>Description</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <!-- Job items -->
            <ng-container *ngFor="let job of jobs">
              <tr class="item-row">
                <td class="item-description">
                  <div class="item-title">Job: {{ job.id }}</div>
                  <div class="item-detail">
                    {{ job.vehicleMake }} {{ job.vehicleModel }} ({{
                      job.vehicleRegistration
                    }})
                  </div>
                </td>
                <td class="item-amount">
                  {{ formatCurrency(job.amount || 0) }}
                </td>
              </tr>

              <!-- Job's approved expenses -->
              <ng-container *ngIf="job.expenses && job.expenses.length > 0">
                <tr
                  *ngFor="let expense of job.expenses"
                  class="expense-row"
                  [class.hidden]="!expense.approved"
                >
                  <td class="item-description">
                    <div class="expense-title">- {{ expense.description }}</div>
                  </td>
                  <td class="item-amount" *ngIf="expense.approved">
                    {{ formatCurrency(expense.amount) }}
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </tbody>
        </table>
      </div>

      <!-- Invoice summary -->
      <div class="pdf-summary-section">
        <div class="summary-row">
          <div class="summary-label">Subtotal:</div>
          <div class="summary-value">
            {{ formatCurrency(invoice.jobAmount) }}
          </div>
        </div>

        <div class="summary-row" *ngIf="invoice.expensesAmount > 0">
          <div class="summary-label">Expenses:</div>
          <div class="summary-value">
            {{ formatCurrency(invoice.expensesAmount) }}
          </div>
        </div>

        <div class="summary-row total-row">
          <div class="summary-label">Total:</div>
          <div class="summary-value">
            {{ formatCurrency(invoice.totalAmount) }}
          </div>
        </div>
      </div>

      <!-- Notes section -->
      <div class="pdf-notes-section" *ngIf="invoice.notes">
        <div class="section-title">Notes:</div>
        <div class="notes-content">{{ invoice.notes }}</div>
      </div>

      <!-- Payment instructions -->
      <div class="pdf-payment-section">
        <div class="section-title">Payment Instructions:</div>
        <div class="payment-details">
          <div>Bank: National Bank</div>
          <div>Account Name: NI Vehicle Logistics Ltd</div>
          <div>Account Number: 12345678</div>
          <div>Sort Code: 12-34-56</div>
          <div>Reference: {{ invoice.invoiceNumber }}</div>
        </div>
      </div>

      <!-- Footer -->
      <div class="pdf-footer">
        <div>Thank you for your business</div>
        <div>
          NI Vehicle Logistics Ltd | Company Reg: 12345678 | VAT: GB123456789
        </div>
      </div>
    </div>
  </div>
</div>
