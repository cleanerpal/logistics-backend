<div class="job-details-page">
  <!-- Sticky Header -->
  <header class="sticky-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" routerLink="/jobs">
          <span class="material-icons">arrow_back</span>
          Back to Jobs
        </button>
        <div class="job-identifier">
          <h1>{{ job.id }}</h1>
          <span class="status-badge" [ngClass]="getStatusClass(job.status)">
            {{ job.status }}
          </span>
        </div>
        <div class="header-actions">
          <button class="action-btn">
            <span class="material-icons">edit</span>
            Edit
          </button>
          <button class="action-btn">
            <span class="material-icons">print</span>
            Print
          </button>
        </div>
      </div>

      <!-- Tab Navigation -->
      <nav class="tab-navigation">
        <button
          [class.active]="activeTab === 'details'"
          (click)="setActiveTab('details')"
        >
          Details
        </button>
        <button
          [class.active]="activeTab === 'timeline'"
          (click)="setActiveTab('timeline')"
        >
          Timeline
        </button>
        <button
          [class.active]="activeTab === 'documents'"
          (click)="setActiveTab('documents')"
        >
          Documents
        </button>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Details Tab -->
    <div class="tab-content" *ngIf="activeTab === 'details'">
      <div class="two-column-layout">
        <!-- Left Column -->
        <div class="left-column">
          <!-- Customer Card -->
          <div class="info-card">
            <h2>Customer Information</h2>
            <div class="card-content">
              <div class="info-row">
                <span class="label">Name</span>
                <span class="value">{{ job.customer.name }}</span>
              </div>
              <div class="info-row">
                <span class="label">Phone</span>
                <span class="value">{{ job.customer.phone }}</span>
              </div>
              <div class="info-row">
                <span class="label">Email</span>
                <span class="value">{{ job.customer.email }}</span>
              </div>
              <div class="info-row">
                <span class="label">Company</span>
                <span class="value">{{ job.customer.company }}</span>
              </div>
            </div>
          </div>

          <!-- Vehicle Card -->
          <div class="info-card">
            <h2>Vehicle Details</h2>
            <div class="card-content">
              <div class="info-row">
                <span class="label">Make & Model</span>
                <span class="value"
                  >{{ job.vehicle.make }} {{ job.vehicle.model }}</span
                >
              </div>
              <div class="info-row">
                <span class="label">Year</span>
                <span class="value">{{ job.vehicle.year }}</span>
              </div>
              <div class="info-row">
                <span class="label">Reg/Chassis</span>
                <span class="value">{{ job.vehicle.registration }}</span>
              </div>
              <div class="info-row">
                <span class="label">Color</span>
                <span class="value">{{ job.vehicle.color }}</span>
              </div>
              <div class="info-row">
                <span class="label">Shipping Ref</span>
                <span class="value">{{ job.vehicle.shippingRef }}</span>
              </div>
            </div>
          </div>

          <!-- Addresses Card -->
          <div class="info-card">
            <h2>Addresses</h2>
            <div class="card-content">
              <div class="address-section">
                <h3>Collection</h3>
                <p>{{ job.addresses.collection.street }}</p>
                <p>{{ job.addresses.collection.city }}</p>
                <p>{{ job.addresses.collection.postcode }}</p>
                <p class="instructions">
                  {{ job.addresses.collection.instructions }}
                </p>
              </div>
              <div class="address-section">
                <h3>Delivery</h3>
                <p>{{ job.addresses.delivery.street }}</p>
                <p>{{ job.addresses.delivery.city }}</p>
                <p>{{ job.addresses.delivery.postcode }}</p>
                <p class="instructions">
                  {{ job.addresses.delivery.instructions }}
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
          <!-- Status Card -->
          <div
            class="info-card status-card"
            [ngClass]="getStatusClass(job.status)"
          >
            <h2>Current Status</h2>
            <div class="current-status">
              <span class="status-indicator"></span>
              <div class="status-details">
                <span class="status-text">{{ job.status }}</span>
                <span
                  class="current-driver"
                  *ngIf="job.status === 'in-progress' && job.currentDriver"
                >
                  Current Driver: {{ job.currentDriver }}
                </span>
              </div>
            </div>
          </div>

          <!-- Driver Card -->
          <div class="info-card">
            <h2>Assigned Driver</h2>
            <div class="card-content">
              <div class="info-row">
                <span class="label">Name</span>
                <span class="value">{{ job.driver.name }}</span>
              </div>
              <div class="info-row">
                <span class="label">Phone</span>
                <span class="value">{{ job.driver.phone }}</span>
              </div>
              <div class="info-row">
                <span class="label">Current Location</span>
                <span class="value">{{ job.driver.currentLocation }}</span>
              </div>
              <div class="info-row">
                <span class="label">Assigned Date</span>
                <span class="value">{{
                  job.driver.assignedDate | date : "medium"
                }}</span>
              </div>
            </div>
          </div>

          <!-- Current Team Card -->
          <div class="info-card active-team-card">
            <h2>Current Team</h2>
            <div class="card-content">
              <!-- Primary Driver -->
              <div class="team-member primary-driver">
                <div class="team-member-header">
                  <span class="role-badge">Primary Driver</span>
                  <span class="time-badge">
                    Since
                    {{
                      job.currentTeam.primaryDriver.since | date : "shortTime"
                    }}</span
                  >
                </div>
                <div class="info-row">
                  <span class="label">Name</span>
                  <span class="value">{{
                    job.currentTeam.primaryDriver.name
                  }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Phone</span>
                  <span class="value">{{
                    job.currentTeam.primaryDriver.phone
                  }}</span>
                </div>
              </div>

              <!-- Additional Staff -->
              <div
                class="team-member"
                *ngFor="let member of job.currentTeam.additionalStaff"
              >
                <div class="team-member-header">
                  <span class="role-badge">{{ member.role }} </span>
                  <span class="time-badge"
                    >Since {{ member.since | date : "shortTime" }}</span
                  >
                </div>
                <div class="info-row">
                  <span class="label">Name</span>
                  <span class="value">{{ member.name }}</span>
                </div>
                <div class="info-row">
                  <span class="label">Phone</span>
                  <span class="value">{{ member.phone }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Timeline Tab -->
    <div class="tab-content" *ngIf="activeTab === 'timeline'">
      <div class="timeline-view">
        <div class="timeline-header">
          <h2>Job Timeline</h2>
        </div>
        <div class="timeline-container">
          <div class="timeline-event" *ngFor="let event of job.timeline">
            <div class="timeline-marker">
              <div class="timeline-icon">
                <span class="material-icons">{{
                  getTimelineIcon(event.status)
                }}</span>
              </div>
              <div class="timeline-line" *ngIf="!isLastEvent(event)"></div>
            </div>
            <div class="timeline-content">
              <div class="event-header">
                <h3 class="event-status">{{ event.status }}</h3>
                <time class="event-time">{{
                  event.date | date : "medium"
                }}</time>
              </div>
              <p class="event-description">{{ event.description }}</p>
              <div class="event-metadata">
                <span class="metadata-item">
                  <span class="material-icons">schedule</span>
                  {{ event.date | date : "shortTime" }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Documents Tab -->
    <div class="tab-content" *ngIf="activeTab === 'documents'">
      <div class="documents-view">
        <!-- Official Documents Section -->
        <section class="document-section">
          <h2>Official Documents</h2>
          <div class="document-grid">
            <div class="document-card" *ngFor="let doc of officialDocuments">
              <div class="document-icon">
                <span class="material-icons">description</span>
              </div>
              <div class="document-info">
                <h3>{{ doc.name }}</h3>
                <p>{{ doc.description }}</p>
                <div class="document-meta">
                  <span>{{ doc.dateAdded | date : "shortDate" }}</span>
                  <span>{{ doc.fileSize }}</span>
                </div>
              </div>
              <button class="download-btn" (click)="downloadDocument(doc)">
                <span class="material-icons">download</span>
                Download
              </button>
            </div>
          </div>
        </section>

        <!-- Vehicle Inspection Section -->
        <section class="inspection-section">
          <h2>Vehicle Inspection</h2>
          <div class="view-toggle">
            <button
              [class.active]="currentView === 'front'"
              (click)="setVehicleView('front')"
            >
              Front View
            </button>
            <button
              [class.active]="currentView === 'rear'"
              (click)="setVehicleView('rear')"
            >
              Rear View
            </button>
            <button
              [class.active]="currentView === 'left'"
              (click)="setVehicleView('left')"
            >
              Left Side
            </button>
            <button
              [class.active]="currentView === 'right'"
              (click)="setVehicleView('right')"
            >
              Right Side
            </button>
          </div>

          <div class="vehicle-inspection-view">
            <div class="vehicle-image-container">
              <img
                [src]="getCurrentViewImage()"
                [alt]="currentView + ' view of vehicle'"
              />
              <div class="inspection-points">
                <div
                  *ngFor="let point of getViewPoints()"
                  class="inspection-point"
                  [class.has-issue]="point.hasIssue"
                  [style.left.%]="point.position.x"
                  [style.top.%]="point.position.y"
                  (click)="showInspectionDetail(point)"
                >
                  <div class="point-marker">
                    <span class="material-icons">
                      {{ point.hasIssue ? "error" : "check_circle" }}
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <div class="inspection-detail" *ngIf="selectedPoint">
              <h3>{{ selectedPoint.label }}</h3>
              <div
                class="condition-badge"
                [ngClass]="getSeverityClass(selectedPoint.severity)"
              >
                {{ selectedPoint.severity | titlecase }} Severity
              </div>
              <div class="detail-section">
                <h4>Condition</h4>
                <p>{{ selectedPoint.condition }}</p>
              </div>
              <div class="detail-section">
                <h4>Notes</h4>
                <p>{{ selectedPoint.notes }}</p>
              </div>
              <div
                class="detail-section"
                *ngIf="selectedPoint.images.length > 0"
              >
                <h4>Images</h4>
                <div class="image-gallery">
                  <div
                    class="image-thumbnail"
                    *ngFor="let image of selectedPoint.images"
                  >
                    <img [src]="image.url" (click)="openImageViewer(image)" />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Additional Photos Section -->
        <section class="photos-section">
          <h2>Additional Photos</h2>
          <div class="photo-grid">
            <div class="photo-card" *ngFor="let photo of additionalPhotos">
              <img [src]="photo.url" (click)="openImageViewer(photo)" />
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- Image Viewer Modal -->
  <div
    class="image-viewer"
    *ngIf="isImageViewerOpen"
    (click)="closeImageViewer()"
  >
    <div class="viewer-content" (click)="$event.stopPropagation()">
      <button class="close-btn" (click)="closeImageViewer()">
        <span class="material-icons">close</span>
      </button>
      <img *ngIf="selectedImage" [src]="selectedImage.url" />
    </div>
  </div>
</div>
