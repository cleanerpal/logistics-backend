import{b as te}from"./chunk-ESJIWLK4.js";import"./chunk-F5X5MWHG.js";import{a as S,b as kt}from"./chunk-VWFB2ZCV.js";import{a as yt,b as Lt}from"./chunk-6ZM5HFJH.js";import{b as Zt}from"./chunk-QVQWCPEO.js";import{c as St}from"./chunk-4TDDZIB3.js";import{a as Jt,d as qt,e as Ut,f as Kt,g as Wt,h as Xt,i as Yt}from"./chunk-PQIIHW7R.js";import"./chunk-GW6WOXIL.js";import{b as _t,c as Ct}from"./chunk-LDLE5TDT.js";import"./chunk-DJMXPRNS.js";import"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as ft}from"./chunk-FL7UC7QU.js";import{a as y,b as It,c as Dt}from"./chunk-RGR4672A.js";import{a as Rt,b as Ft,c as Tt,d as jt,e as Vt,f as Bt,g as Nt,h as At,i as Ht,j as $t,k as Qt,l as zt,m as Gt}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as ct,c as mt,h as dt}from"./chunk-OFY7VGJP.js";import{b as pt,f as gt,i as ut}from"./chunk-P7ITNQJW.js";import{a as wt,b as Et}from"./chunk-HDC6EVXZ.js";import{b as Pt,c as Ot}from"./chunk-Q2NIOR5G.js";import{C as ht,E as Mt,H as bt,I as xt,J as vt,b as tt,g as et,h as rt,l as ot,o as nt,p as it,q as at,u as lt,w as st}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{c as $,g as Q}from"./chunk-4PPYA6ZN.js";import{ea as z,ga as G,h as N,ia as J,j as A,ka as q,ma as U,o as H,ra as K,ta as W,ua as X,wa as Y,xa as Z}from"./chunk-3O2P3FIP.js";import{$b as L,Cb as m,Lb as o,Mb as n,Nb as g,Ob as C,Pb as h,Rb as E,Vb as M,Wb as p,ac as k,bc as I,db as l,ec as D,fc as a,gc as b,hc as P,ib as w,ic as j,pa as f,pb as T,pc as V,qa as _,qc as R,vb as d,wc as B}from"./chunk-NXWLSP6D.js";import{g as F}from"./chunk-RA2WU32H.js";var re=()=>[10,25,50],oe=r=>({"high-retry":r}),ne=r=>({"resolved-row":r});function ie(r,t){if(r&1){let e=E();o(0,"button",28),M("click",function(){let c;f(e);let s=p();return _((c=s.filterForm.get("jobId"))==null?null:c.setValue(""))}),o(1,"mat-icon"),a(2,"close"),n()()}}function ae(r,t){r&1&&(o(0,"div",29),g(1,"mat-spinner",30),n())}function le(r,t){r&1&&(o(0,"th",46),a(1,"Job ID"),n())}function se(r,t){if(r&1){let e=E();o(0,"span")(1,"a",49),M("click",function(){f(e);let c=p().$implicit,s=p(2);return _(s.viewJob(c.jobId))}),a(2),n()()}if(r&2){let e=p().$implicit;l(2),b(e.jobId)}}function ce(r,t){r&1&&(o(0,"span",50),a(1,"No Job ID"),n())}function me(r,t){if(r&1&&(o(0,"td",47),d(1,se,3,1,"span",48)(2,ce,2,0,"ng-template",null,1,B),n()),r&2){let e=t.$implicit,i=D(3);l(),m("ngIf",e.jobId)("ngIfElse",i)}}function de(r,t){r&1&&(o(0,"th",46),a(1,"Status"),n())}function pe(r,t){if(r&1&&(o(0,"td",47)(1,"div",51),a(2),n()()),r&2){let e=t.$implicit,i=p(2);l(),m("ngClass",i.getStatusColor(e.status)),l(),j(" ",e.status," - ",i.getStatusText(e.status)," ")}}function ge(r,t){r&1&&(o(0,"th",46),a(1,"Error Message"),n())}function ue(r,t){if(r&1&&(o(0,"td",47)(1,"div",52),a(2),n()()),r&2){let e=t.$implicit,i=p(2);l(),m("matTooltip",e.message),l(),P(" ",i.formatMessage(e.message)," ")}}function fe(r,t){r&1&&(o(0,"th",46),a(1,"Timestamp"),n())}function _e(r,t){if(r&1&&(o(0,"td",47),a(1),n()),r&2){let e=t.$implicit,i=p(2);l(),P(" ",i.formatDate(e.timestamp)," ")}}function Ce(r,t){r&1&&(o(0,"th",46),a(1,"Retry Count"),n())}function he(r,t){if(r&1&&(o(0,"td",47)(1,"span",53),a(2),n()()),r&2){let e=t.$implicit;l(),m("ngClass",R(2,oe,e.retryCount>2)),l(),P(" ",e.retryCount," ")}}function Me(r,t){r&1&&(o(0,"th",54),a(1,"Actions"),n())}function be(r,t){if(r&1){let e=E();o(0,"td",47)(1,"button",55),M("click",function(){let c=f(e).$implicit,s=p(2);return _(s.viewErrorDetails(c.id))}),o(2,"mat-icon"),a(3,"info"),n()(),o(4,"button",56),M("click",function(){let c=f(e).$implicit,s=p(2);return _(s.markAsResolved(c))}),o(5,"mat-icon"),a(6,"check_circle"),n()()()}if(r&2){let e=t.$implicit;l(4),m("disabled",e.resolved)}}function xe(r,t){r&1&&g(0,"tr",57)}function ve(r,t){if(r&1&&g(0,"tr",58),r&2){let e=t.$implicit;m("ngClass",R(1,ne,e.resolved))}}function we(r,t){r&1&&(o(0,"tr",59)(1,"td",60),a(2," No error logs found matching the current filters "),n()())}function Ee(r,t){if(r&1&&(o(0,"div",31)(1,"table",32),C(2,33),d(3,le,2,0,"th",34)(4,me,4,2,"td",35),h(),C(5,36),d(6,de,2,0,"th",34)(7,pe,3,3,"td",35),h(),C(8,37),d(9,ge,2,0,"th",34)(10,ue,3,2,"td",35),h(),C(11,38),d(12,fe,2,0,"th",34)(13,_e,2,1,"td",35),h(),C(14,39),d(15,Ce,2,0,"th",34)(16,he,3,4,"td",35),h(),C(17,40),d(18,Me,2,0,"th",41)(19,be,7,1,"td",35),h(),d(20,xe,1,0,"tr",42)(21,ve,1,3,"tr",43)(22,we,3,0,"tr",44),n(),g(23,"mat-paginator",45),n()),r&2){let e=p();l(),m("dataSource",e.dataSource),l(19),m("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),l(),m("matRowDefColumns",e.displayedColumns),l(2),m("pageSizeOptions",V(6,re))("pageSize",50)}}var ee=class r{constructor(t,e,i,c){this.firestore=t;this.formBuilder=e;this.snackBar=i;this.router=c;this.filterForm=this.formBuilder.group({jobId:[""],dateRange:this.formBuilder.group({start:[null],end:[null]}),showResolved:[!1]})}dataSource=new Gt;displayedColumns=["jobId","status","message","timestamp","retryCount","actions"];paginator;sort;filterForm;loading=!0;totalErrors=0;resolvedErrors=0;openErrors=0;errorSubscription;ngOnInit(){this.loadErrorLogs(),this.filterForm.valueChanges.subscribe(()=>{this.applyFilters()})}ngAfterViewInit(){setTimeout(()=>{this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.sortingDataAccessor=(t,e)=>{switch(e){case"timestamp":return t.timestamp.toMillis();default:return t[e]}}})}ngOnDestroy(){this.errorSubscription&&this.errorSubscription.unsubscribe()}loadErrorLogs(){this.loading=!0;try{let t=q(this.firestore,"ApiErrors"),e=[];this.filterForm.get("showResolved")?.value||e.push(Z("resolved","==",!1)),e.push(W("timestamp","desc")),e.push(K(500));let c=X(t,...e);this.errorSubscription=J(c,{idField:"id"}).subscribe({next:s=>{this.dataSource.data=s,this.loading=!1,this.totalErrors=s.length,this.resolvedErrors=s.filter(u=>u.resolved).length,this.openErrors=this.totalErrors-this.resolvedErrors,this.applyFilters()},error:s=>{console.error("Error loading error logs:",s),this.snackBar.open("Error loading error logs. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}catch(t){console.error("Error setting up error logs subscription:",t),this.loading=!1}}applyFilters(){let t=this.filterForm.get("jobId")?.value?.trim().toLowerCase(),e=this.filterForm.get("dateRange")?.value;this.dataSource.filterPredicate=(i,c)=>{let s=!t||i.jobId&&i.jobId.toLowerCase().includes(t),u=!0;if(e.start&&e.end){let x=i.timestamp.toDate(),O=new Date(e.start),v=new Date(e.end);v.setHours(23,59,59),u=x>=O&&x<=v}return!!s&&u},this.dataSource.filter="custom-filter",this.dataSource.paginator&&this.dataSource.paginator.firstPage()}resetFilters(){this.filterForm.patchValue({jobId:"",dateRange:{start:null,end:null}}),this.applyFilters()}toggleShowResolved(){let t=this.filterForm.get("showResolved")?.value;this.filterForm.get("showResolved")?.setValue(!t),this.loadErrorLogs()}markAsResolved(t){return F(this,null,function*(){try{let e=U(this.firestore,"ApiErrors",t.id);yield Y(e,{resolved:!0,resolvedAt:z.now()}),this.snackBar.open("Error marked as resolved.","Close",{duration:3e3})}catch(e){console.error("Error marking as resolved:",e),this.snackBar.open("Error updating status. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}viewJob(t){t&&this.router.navigate(["/jobs",t])}viewErrorDetails(t){this.router.navigate(["/error-logs",t])}getStatusText(t){return t>=500?"Server Error":t>=400?"Client Error":t>=300?"Redirect":t>=200?"Success":t>=100?"Informational":"Unknown"}getStatusColor(t){return t>=500?"error-color":t>=400?"warning-color":t>=300?"info-color":t>=200?"success-color":""}formatDate(t){return t.toDate().toLocaleString()}formatMessage(t){return t.length>80?t.substring(0,80)+"...":t}static \u0275fac=function(e){return new(e||r)(w(G),w(lt),w(Pt),w($))};static \u0275cmp=T({type:r,selectors:[["app-error-logs-list"]],viewQuery:function(e,i){if(e&1&&(L(S,5),L(y,5)),e&2){let c;k(c=I())&&(i.paginator=c.first),k(c=I())&&(i.sort=c.first)}},decls:51,vars:13,consts:[["rangePicker",""],["noJobId",""],[1,"error-logs-container"],[1,"page-header"],[1,"page-title"],[1,"status-indicators"],[1,"status-chip","total"],[1,"chip-label"],[1,"chip-value"],[1,"status-chip","open"],[1,"status-chip","resolved"],[1,"filter-card"],[1,"filter-form",3,"formGroup"],[1,"search-container"],["appearance","outline"],["matInput","","formControlName","jobId","placeholder","Enter Job ID"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["matSuffix",""],["mat-stroked-button","","color","primary",1,"reset-button",3,"click","disabled"],["formGroupName","dateRange",1,"date-container"],["appearance","outline",1,"date-field"],[3,"rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],["mat-stroked-button","",1,"toggle-button",3,"click","color"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"error-logs-table",3,"dataSource"],["matColumnDef","jobId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","status"],["matColumnDef","message"],["matColumnDef","timestamp"],["matColumnDef","retryCount"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",3,"ngClass",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of error logs",3,"pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[4,"ngIf","ngIfElse"],[1,"job-link",3,"click"],[1,"no-job-id"],[1,"status-badge",3,"ngClass"],[1,"message-container",3,"matTooltip"],[1,"retry-count",3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","View details",3,"click"],["mat-icon-button","","color","accent","matTooltip","Mark as resolved",3,"click","disabled"],["mat-header-row",""],["mat-row","",3,"ngClass"],[1,"mat-row"],["colspan","6",1,"mat-cell"]],template:function(e,i){if(e&1){let c=E();o(0,"div",2)(1,"div",3)(2,"h1",4),a(3,"Error Logs"),n(),o(4,"div",5)(5,"div",6)(6,"span",7),a(7,"Total Errors:"),n(),o(8,"span",8),a(9),n()(),o(10,"div",9)(11,"span",7),a(12,"Open:"),n(),o(13,"span",8),a(14),n()(),o(15,"div",10)(16,"span",7),a(17,"Resolved:"),n(),o(18,"span",8),a(19),n()()()(),o(20,"mat-card",11)(21,"mat-card-content")(22,"form",12)(23,"div",13)(24,"mat-form-field",14)(25,"mat-label"),a(26,"Search by Job ID"),n(),g(27,"input",15),d(28,ie,3,0,"button",16),o(29,"mat-icon",17),a(30,"search"),n()(),o(31,"button",18),M("click",function(){return f(c),_(i.resetFilters())}),o(32,"mat-icon"),a(33,"refresh"),n(),a(34," Reset "),n()(),o(35,"div",19)(36,"mat-form-field",20)(37,"mat-label"),a(38,"Date Range"),n(),o(39,"mat-date-range-input",21),g(40,"input",22)(41,"input",23),n(),g(42,"mat-datepicker-toggle",24)(43,"mat-date-range-picker",null,0),n(),o(45,"button",25),M("click",function(){return f(c),_(i.toggleShowResolved())}),o(46,"mat-icon"),a(47),n(),a(48),n()()()()(),d(49,ae,2,0,"div",26)(50,Ee,24,7,"div",27),n()}if(e&2){let c,s,u,x,O,v=D(44);l(9),b(i.totalErrors),l(5),b(i.openErrors),l(5),b(i.resolvedErrors),l(3),m("formGroup",i.filterForm),l(6),m("ngIf",(c=i.filterForm.get("jobId"))==null?null:c.value),l(3),m("disabled",!((s=i.filterForm.get("jobId"))!=null&&s.value)&&!((s=i.filterForm.get("dateRange.start"))!=null&&s.value)&&!((s=i.filterForm.get("dateRange.end"))!=null&&s.value)),l(8),m("rangePicker",v),l(3),m("for",v),l(3),m("color",(u=i.filterForm.get("showResolved"))!=null&&u.value?"accent":"primary"),l(2),b((x=i.filterForm.get("showResolved"))!=null&&x.value?"visibility_off":"visibility"),l(),P(" ",(O=i.filterForm.get("showResolved"))!=null&&O.value?"Hide Resolved":"Show Resolved"," "),l(),m("ngIf",i.loading),l(),m("ngIf",!i.loading)}},dependencies:[H,N,A,st,ot,tt,et,rt,nt,at,it,Q,zt,Rt,Tt,Nt,jt,Ft,At,Vt,Bt,Ht,$t,Qt,kt,S,Dt,y,It,Ct,_t,ut,pt,gt,ft,vt,xt,bt,Mt,ht,dt,ct,mt,Yt,qt,Ut,Kt,Wt,Xt,Jt,Et,wt,Lt,yt,Ot,St,te,Zt],styles:[".error-logs-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.status-indicators[_ngcontent-%COMP%]{display:flex;gap:16px}@media (max-width: 576px){.status-indicators[_ngcontent-%COMP%]{flex-direction:column;gap:8px}}.status-chip[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 12px;border-radius:16px;background-color:#fff;box-shadow:0 2px 4px #0000001a}.status-chip[_ngcontent-%COMP%]   .chip-label[_ngcontent-%COMP%]{margin-right:8px;font-weight:500;font-size:14px}.status-chip[_ngcontent-%COMP%]   .chip-value[_ngcontent-%COMP%]{font-weight:600;font-size:16px}.status-chip.total[_ngcontent-%COMP%]{border-left:4px solid #4a3c31}.status-chip.total[_ngcontent-%COMP%]   .chip-value[_ngcontent-%COMP%]{color:#4a3c31}.status-chip.open[_ngcontent-%COMP%]{border-left:4px solid #b00020}.status-chip.open[_ngcontent-%COMP%]   .chip-value[_ngcontent-%COMP%]{color:#b00020}.status-chip.resolved[_ngcontent-%COMP%]{border-left:4px solid #4caf50}.status-chip.resolved[_ngcontent-%COMP%]   .chip-value[_ngcontent-%COMP%]{color:#4caf50}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.filter-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.filter-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}@media (max-width: 992px){.filter-form[_ngcontent-%COMP%]{flex-direction:column}}.search-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:flex-start;gap:16px}.search-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.search-container[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]{margin-top:4px;border-color:#c19a6b;color:#c19a6b}@media (max-width: 576px){.search-container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.search-container[_ngcontent-%COMP%]   .reset-button[_ngcontent-%COMP%]{width:100%}}.date-container[_ngcontent-%COMP%]{flex:1;display:flex;gap:16px;align-items:flex-start}.date-container[_ngcontent-%COMP%]   .date-field[_ngcontent-%COMP%]{flex:1}.date-container[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{margin-top:4px;border-color:#c19a6b;color:#c19a6b}.date-container[_ngcontent-%COMP%]   .toggle-button.mat-accent[_ngcontent-%COMP%]{border-color:#4a3c31;color:#4a3c31}@media (max-width: 576px){.date-container[_ngcontent-%COMP%]{flex-direction:column;width:100%}.date-container[_ngcontent-%COMP%]   .toggle-button[_ngcontent-%COMP%]{width:100%}}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.loading-container[_ngcontent-%COMP%]   .mat-mdc-progress-spinner[_ngcontent-%COMP%]     circle{stroke:#c19a6b}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.error-logs-table[_ngcontent-%COMP%]{width:100%}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#4a3c31;color:#fff;font-weight:500;padding:12px 16px;white-space:nowrap}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:12px 16px;color:#333}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{transition:background-color .2s}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row.resolved-row[_ngcontent-%COMP%]{background-color:#4caf500d;color:#9e9e9e}.error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row.resolved-row[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%], .error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row.resolved-row[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%], .error-logs-table[_ngcontent-%COMP%]   .mat-mdc-row.resolved-row[_ngcontent-%COMP%]   .retry-count[_ngcontent-%COMP%]{opacity:.6}.error-logs-table[_ngcontent-%COMP%]   .job-link[_ngcontent-%COMP%]{color:#c19a6b;text-decoration:underline;cursor:pointer;font-weight:500}.error-logs-table[_ngcontent-%COMP%]   .job-link[_ngcontent-%COMP%]:hover{color:#af814a}.error-logs-table[_ngcontent-%COMP%]   .no-job-id[_ngcontent-%COMP%]{color:#9e9e9e;font-style:italic}.error-logs-table[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{display:inline-block;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500;color:#fff;text-align:center;min-width:120px}.error-logs-table[_ngcontent-%COMP%]   .status-badge.error-color[_ngcontent-%COMP%]{background-color:#b00020}.error-logs-table[_ngcontent-%COMP%]   .status-badge.warning-color[_ngcontent-%COMP%]{background-color:#ff9800}.error-logs-table[_ngcontent-%COMP%]   .status-badge.info-color[_ngcontent-%COMP%]{background-color:#2196f3}.error-logs-table[_ngcontent-%COMP%]   .status-badge.success-color[_ngcontent-%COMP%]{background-color:#4caf50}.error-logs-table[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px;cursor:default}.error-logs-table[_ngcontent-%COMP%]   .retry-count[_ngcontent-%COMP%]{font-weight:500}.error-logs-table[_ngcontent-%COMP%]   .retry-count.high-retry[_ngcontent-%COMP%]{color:#b00020;font-weight:600}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5}@media (max-width: 992px){.error-logs-table[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{max-width:200px}}@media (max-width: 768px){.error-logs-table[_ngcontent-%COMP%]   .message-container[_ngcontent-%COMP%]{max-width:150px}}@media (max-width: 576px){.table-container[_ngcontent-%COMP%]{overflow-x:auto}}"]})};export{ee as ErrorLogsListComponent};
