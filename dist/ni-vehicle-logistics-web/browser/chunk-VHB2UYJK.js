import"./chunk-F5X5MWHG.js";import{a as C,b as rt}from"./chunk-VWFB2ZCV.js";import{a as it,b as ot}from"./chunk-6ZM5HFJH.js";import"./chunk-DJMXPRNS.js";import"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import"./chunk-FL7UC7QU.js";import{a as D,b as nt,c as at}from"./chunk-RGR4672A.js";import{a as st,b as lt,c as ct,d as dt,e as mt,f as pt,g as ut,h as ft,i as vt,j as gt,k as bt,l as _t,m as ht}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import"./chunk-P7ITNQJW.js";import{a as Z,b as tt}from"./chunk-HDC6EVXZ.js";import{b as et}from"./chunk-Q2NIOR5G.js";import{C as K,H as W,I as X,J as Y}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as V,c as A}from"./chunk-4PPYA6ZN.js";import{ga as Q,ia as $,j as H,ka as J,ma as z,na as q,o as N,oa as U,pa as L,ta as G,ua as I,xa as P}from"./chunk-3O2P3FIP.js";import{$b as y,Cb as d,Db as R,Lb as o,Mb as n,Nb as b,Ob as p,Pb as u,Rb as w,Vb as _,Wb as f,ac as j,bc as k,db as s,fc as a,gc as E,hc as h,ib as g,ic as B,pa as M,pb as O,pc as F,qa as S,vb as c}from"./chunk-NXWLSP6D.js";import{g as x}from"./chunk-RA2WU32H.js";var xt=()=>[10,25,50];function Mt(t,i){t&1&&(o(0,"div",7),b(1,"mat-spinner",8),n())}function St(t,i){t&1&&(o(0,"th",23),a(1,"Job ID"),n())}function wt(t,i){if(t&1&&(o(0,"td",24),a(1),n()),t&2){let e=i.$implicit;s(),E(e.id)}}function yt(t,i){t&1&&(o(0,"th",23),a(1,"Vehicle"),n())}function jt(t,i){if(t&1&&(o(0,"td",24),a(1),o(2,"div",25),a(3),n()()),t&2){let e=i.$implicit;s(),B(" ",e.vehicleMake," ",e.vehicleModel," "),s(2),E(e.vehicleRegistration)}}function kt(t,i){t&1&&(o(0,"th",23),a(1,"Status"),n())}function Et(t,i){if(t&1&&(o(0,"td",24)(1,"span",26),a(2),n()()),t&2){let e=i.$implicit,r=f(2);s(),R("background-color",r.getStatusColor(e.status)),s(),h(" ",e.status," ")}}function Jt(t,i){t&1&&(o(0,"th",23),a(1," Scheduled Delivery "),n())}function It(t,i){if(t&1&&(o(0,"td",24),a(1),n()),t&2){let e=i.$implicit,r=f(2);s(),h(" ",r.formatDate(e.deliveryDate)," ")}}function Pt(t,i){t&1&&(o(0,"th",27),a(1,"Actions"),n())}function Tt(t,i){if(t&1){let e=w();o(0,"td",24)(1,"button",28),_("click",function(l){let m=M(e).$implicit;return f(2).viewJobDetails(m.id),S(l.stopPropagation())}),o(2,"mat-icon"),a(3,"visibility"),n()()()}}function Ot(t,i){t&1&&b(0,"tr",29)}function Rt(t,i){if(t&1){let e=w();o(0,"tr",30),_("click",function(){let l=M(e).$implicit,m=f(2);return S(m.viewJobDetails(l.id))}),n()}}function Bt(t,i){t&1&&(o(0,"tr",31)(1,"td",32),a(2,"No jobs found for this driver"),n()())}function Ft(t,i){if(t&1&&(o(0,"div",9)(1,"table",10),p(2,11),c(3,St,2,0,"th",12)(4,wt,2,1,"td",13),u(),p(5,14),c(6,yt,2,0,"th",12)(7,jt,4,3,"td",13),u(),p(8,15),c(9,kt,2,0,"th",12)(10,Et,3,3,"td",13),u(),p(11,16),c(12,Jt,2,0,"th",12)(13,It,2,1,"td",13),u(),p(14,17),c(15,Pt,2,0,"th",18)(16,Tt,4,0,"td",13),u(),c(17,Ot,1,0,"tr",19)(18,Rt,1,0,"tr",20)(19,Bt,3,0,"tr",21),n(),b(20,"mat-paginator",22),n()),t&2){let e=f();s(),d("dataSource",e.dataSource),s(16),d("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),s(),d("matRowDefColumns",e.displayedColumns),s(2),d("pageSizeOptions",F(5,xt))}}var Ct=class t{constructor(i,e,r,l){this.firestore=i;this.route=e;this.router=r;this.snackBar=l}driverId=null;driverName="";jobs=[];dataSource=new ht([]);displayedColumns=["id","vehicle","status","deliveryDate","actions"];loading=!0;subscription;paginator;sort;ngOnInit(){this.route.paramMap.subscribe(i=>{this.driverId=i.get("id"),this.driverId?(this.loadDriverDetails(this.driverId),this.loadDriverJobs(this.driverId)):this.router.navigate(["/drivers"])})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadDriverDetails(i){return x(this,null,function*(){try{let e=z(this.firestore,"Users",i),r=yield U(e);r.exists()?this.driverName=r.data().displayName||"Unknown Driver":(this.snackBar.open("Driver not found.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/drivers"]))}catch(e){console.error("Error loading driver details:",e),this.snackBar.open("Error loading driver details.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}loadDriverJobs(i){return x(this,null,function*(){this.loading=!0;try{let e=J(this.firestore,"DriverTimeline"),r=I(e,P("driverId","==",i)),m=(yield L(r)).docs.map(v=>v.data().jobId);if(m.length===0){this.jobs=[],this.dataSource.data=[],this.loading=!1;return}let T=J(this.firestore,"Jobs"),Dt=I(T,P(q(),"in",m),G("deliveryDate","desc"));this.subscription=$(Dt,{idField:"id"}).subscribe({next:v=>{this.jobs=v,this.dataSource.data=this.jobs,setTimeout(()=>{this.paginator&&this.sort&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}),this.loading=!1},error:v=>{console.error("Error loading driver jobs:",v),this.snackBar.open("Error loading driver jobs.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}catch(e){console.error("Error setting up driver jobs subscription:",e),this.snackBar.open("Error loading jobs.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}viewJobDetails(i){this.router.navigate(["/jobs/edit",i])}goBack(){this.router.navigate(["/drivers"])}formatDate(i){return i?i.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}getStatusColor(i){switch(i){case"Unallocated":return"#F44336";case"Allocated":return"#FFC107";case"Collected":return"#2196F3";case"Delivered":return"#4CAF50";case"Cancelled":return"#9E9E9E";default:return"#9E9E9E"}}static \u0275fac=function(e){return new(e||t)(g(Q),g(V),g(A),g(et))};static \u0275cmp=O({type:t,selectors:[["app-driver-jobs"]],viewQuery:function(e,r){if(e&1&&(y(C,5),y(D,5)),e&2){let l;j(l=k())&&(r.paginator=l.first),j(l=k())&&(r.sort=l.first)}},decls:10,vars:3,consts:[[1,"driver-jobs-container"],[1,"page-header"],[1,"header-left"],["mat-icon-button","",1,"back-button",3,"click"],[1,"page-title"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"jobs-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","vehicle"],["matColumnDef","status"],["matColumnDef","deliveryDate"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","job-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of jobs",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"vehicle-reg"],[1,"status-badge"],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","View Job Details",3,"click"],["mat-header-row",""],["mat-row","",1,"job-row",3,"click"],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),_("click",function(){return r.goBack()}),o(4,"mat-icon"),a(5,"arrow_back"),n()(),o(6,"h1",4),a(7),n()()(),c(8,Mt,2,0,"div",5)(9,Ft,21,6,"div",6),n()),e&2&&(s(7),h("Jobs for ",r.driverName,""),s(),d("ngIf",r.loading),s(),d("ngIf",!r.loading))},dependencies:[N,H,_t,st,ct,ut,dt,lt,ft,mt,pt,vt,gt,bt,at,D,nt,rt,C,W,K,Y,X,tt,Z,ot,it],styles:[".driver-jobs-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.back-button[_ngcontent-%COMP%]{color:#4a3c31}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.jobs-table[_ngcontent-%COMP%]{width:100%}.jobs-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:500;color:#4a3c31;white-space:nowrap}.jobs-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{color:#333}.jobs-table[_ngcontent-%COMP%]   .job-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}.jobs-table[_ngcontent-%COMP%]   .job-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:500;color:#fff;display:inline-block;min-width:80px;text-align:center}.vehicle-reg[_ngcontent-%COMP%]{font-size:12px;color:#666}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5}.mat-mdc-no-data-row[_ngcontent-%COMP%]{padding:16px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}"]})};export{Ct as DriverJobsComponent};
