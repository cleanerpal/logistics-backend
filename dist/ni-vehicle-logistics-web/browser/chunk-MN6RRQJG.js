import{a as Te}from"./chunk-3LXRQY3K.js";import"./chunk-F5X5MWHG.js";import{a as P,b as Me}from"./chunk-VWFB2ZCV.js";import{a as fe,b as Ce}from"./chunk-6ZM5HFJH.js";import"./chunk-MS4AQ6UA.js";import{b as ne,c as ae}from"./chunk-LDLE5TDT.js";import{a as pe,b as ue}from"./chunk-DJMXPRNS.js";import{d as ge}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as te}from"./chunk-FL7UC7QU.js";import{a as v,b as _e,c as he}from"./chunk-RGR4672A.js";import{a as S,b as be,c as Oe,d as Pe,e as ve,f as Se,g as xe,h as we,i as ye,j as De,k as Ue,l as Ee,m as ke}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as J,c as K,h as X}from"./chunk-OFY7VGJP.js";import{b as Y,f as Z,i as ee}from"./chunk-P7ITNQJW.js";import{a as me}from"./chunk-HDC6EVXZ.js";import{b as ce,c as de}from"./chunk-Q2NIOR5G.js";import{C as ie,E as re,H as oe,I as le,J as se,b as j,g as q,k as U,n as W,w as G}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as Q}from"./chunk-M4BJXN77.js";import{c as V}from"./chunk-4PPYA6ZN.js";import{h as N,i as $,j as B,o as H,xa as z}from"./chunk-3O2P3FIP.js";import{$b as h,Cb as m,H as A,L as F,Lb as a,Mb as r,Nb as C,Ob as g,Pb as p,Rb as D,Vb as M,Wb as _,X as x,ac as b,bc as O,db as s,f as T,fc as o,gc as L,hc as u,ib as f,pa as w,pb as I,pc as R,qa as y,vb as c}from"./chunk-NXWLSP6D.js";import{a as E,b as k}from"./chunk-RA2WU32H.js";var Ie=()=>[10,25,50];function Le(t,e){if(t&1&&(a(0,"mat-option",27),o(1),r()),t&2){let n=e.$implicit;m("value",n.value),s(),u(" ",n.label," ")}}function Re(t,e){t&1&&(a(0,"div",28),C(1,"mat-spinner",29),r())}function Ne(t,e){t&1&&(a(0,"th",30),o(1,"Name"),r())}function $e(t,e){if(t&1&&(a(0,"td",31),o(1),r()),t&2){let n=e.$implicit;s(),u(" ",n.displayName||"No name provided"," ")}}function Be(t,e){t&1&&(a(0,"th",30),o(1,"Email"),r())}function He(t,e){if(t&1&&(a(0,"td",31),o(1),r()),t&2){let n=e.$implicit;s(),L(n.email)}}function Ve(t,e){t&1&&(a(0,"th",30),o(1,"Role"),r())}function ze(t,e){if(t&1&&(a(0,"td",31)(1,"span",32),o(2),r()()),t&2){let n=e.$implicit;s(),m("ngClass",(n.role==null?null:n.role.toLowerCase())||"default"),s(),u(" ",n.role||"Not assigned"," ")}}function Qe(t,e){t&1&&(a(0,"th",30),o(1,"Team"),r())}function je(t,e){if(t&1&&(a(0,"td",31),o(1),r()),t&2){let n=e.$implicit;s(),u(" ",n.team||"Not assigned"," ")}}function qe(t,e){t&1&&(a(0,"th",30),o(1," Last Active "),r())}function We(t,e){if(t&1&&(a(0,"td",31),o(1),r()),t&2){let n=e.$implicit,i=_();s(),u(" ",i.formatDate(n.lastActive)," ")}}function Ge(t,e){t&1&&(a(0,"th",33),o(1,"Actions"),r())}function Je(t,e){if(t&1){let n=D();a(0,"td",31)(1,"button",34),M("click",function(l){let d=w(n).$implicit,Fe=_();return y(Fe.deleteUser(d,l))}),a(2,"mat-icon"),o(3,"delete"),r()()()}}function Ke(t,e){t&1&&C(0,"tr",35)}function Xe(t,e){if(t&1){let n=D();a(0,"tr",36),M("click",function(){let l=w(n).$implicit,d=_();return y(d.navigateToUserForm(l.id))}),r()}}function Ye(t,e){t&1&&(a(0,"tr",37)(1,"td",38)(2,"div",39)(3,"mat-icon"),o(4,"sentiment_dissatisfied"),r(),a(5,"p"),o(6,"No users found matching the filter criteria"),r()()()())}var Ae=class t{constructor(e,n,i,l){this.firebaseService=e;this.auditLogsService=n;this.router=i;this.snackBar=l}paginator;sort;table;dataSource=new ke([]);displayedColumns=["displayName","email","role","team","lastActive","actions"];searchControl=new U("");roleFilterControl=new U("All");roles=[{value:"All",label:"All Roles"},{value:"SuperAdmin",label:"Super Admin"},{value:"Admin",label:"Admin"},{value:"Driver",label:"Driver"}];isLoading=!0;usersSubscription;destroy$=new T;ngOnInit(){this.setupSearchListener(),this.setupRoleFilterListener(),this.loadUsers()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.sortingDataAccessor=(e,n)=>{switch(n){case"lastActive":return e.lastActive?e.lastActive.getTime():0;default:return e[n]||""}}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.usersSubscription&&this.usersSubscription.unsubscribe()}setupSearchListener(){this.searchControl.valueChanges.pipe(A(300),F(),x(this.destroy$)).subscribe(e=>{this.applyFilter(e||"")})}setupRoleFilterListener(){this.roleFilterControl.valueChanges.pipe(x(this.destroy$)).subscribe(()=>{this.loadUsers()})}loadUsers(){this.isLoading=!0;let e=this.roleFilterControl.value;this.usersSubscription&&this.usersSubscription.unsubscribe();let n=[];e!=="All"&&e&&n.push(z("role","==",e)),this.usersSubscription=this.firebaseService.getCollectionWithSnapshot("users",n.length>0?n:void 0).subscribe({next:i=>{this.dataSource.data=i.map(d=>k(E({},d),{lastActive:d.lastActive?new Date(d.lastActive):void 0})),this.isLoading=!1;let l=this.searchControl.value;l&&this.applyFilter(l)},error:i=>{console.error("Error loading users:",i),this.snackBar.open("Error loading users. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1}})}applyFilter(e){let n=e.toLowerCase().trim();this.dataSource.filterPredicate=(i,l)=>i.displayName?.toLowerCase().includes(l)||!1||i.email.toLowerCase().includes(l)||!1,this.dataSource.filter=n,this.dataSource.paginator&&this.dataSource.paginator.firstPage()}navigateToUserForm(e){e?this.router.navigate(["/users/edit",e]):this.router.navigate(["/users/create"])}formatDate(e){return e?new Date().getTime()-e.getTime()>864e5?e.toLocaleDateString():e.toLocaleTimeString():"Never"}deleteUser(e,n){n.stopPropagation(),confirm(`Are you sure you want to delete user ${e.displayName||e.email}?`)&&this.firebaseService.deleteDocument("users",e.id).then(()=>{this.auditLogsService.createAuditLog({action:"DELETE",resource:"users",resourceId:e.id,details:`Deleted user: ${e.displayName||e.email}`,userId:e.id,userName:e.displayName||e.email}),this.snackBar.open("User deleted successfully","Close",{duration:3e3})}).catch(i=>{console.error("Error deleting user:",i),this.snackBar.open("Error deleting user. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})})}static \u0275fac=function(n){return new(n||t)(f(Q),f(Te),f(V),f(ce))};static \u0275cmp=I({type:t,selectors:[["app-user-management"]],viewQuery:function(n,i){if(n&1&&(h(P,5),h(v,5),h(S,5)),n&2){let l;b(l=O())&&(i.paginator=l.first),b(l=O())&&(i.sort=l.first),b(l=O())&&(i.table=l.first)}},decls:47,vars:11,consts:[[1,"user-management-container"],[1,"page-header"],[1,"header-title"],["mat-raised-button","","color","primary",1,"create-button",3,"click"],[1,"filter-container"],["appearance","outline",1,"search-field"],["matInput","","placeholder","Search by name or email",3,"formControl"],["matSuffix",""],["appearance","outline",1,"role-filter"],[3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[1,"table-container"],["class","loading-shade",4,"ngIf"],["mat-table","","matSort","",1,"users-table",3,"dataSource"],["matColumnDef","displayName"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","email"],["matColumnDef","role"],["matColumnDef","team"],["matColumnDef","lastActive"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","user-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of users",3,"pageSizeOptions","pageSize"],[3,"value"],[1,"loading-shade"],["diameter","50"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"role-badge",3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","color","warn","matTooltip","Delete user",3,"click"],["mat-header-row",""],["mat-row","",1,"user-row",3,"click"],[1,"mat-row"],["colspan","6",1,"mat-cell"],[1,"no-data-message"]],template:function(n,i){n&1&&(a(0,"div",0)(1,"div",1)(2,"h1",2),o(3,"User Management"),r(),a(4,"button",3),M("click",function(){return i.navigateToUserForm()}),a(5,"mat-icon"),o(6,"add"),r(),o(7," Create User "),r()(),a(8,"mat-card")(9,"mat-card-content")(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),o(13,"Search users"),r(),C(14,"input",6),a(15,"mat-icon",7),o(16,"search"),r()(),a(17,"mat-form-field",8)(18,"mat-label"),o(19,"Filter by Role"),r(),a(20,"mat-select",9),c(21,Le,2,2,"mat-option",10),r()()(),a(22,"div",11),c(23,Re,2,0,"div",12),a(24,"table",13),g(25,14),c(26,Ne,2,0,"th",15)(27,$e,2,1,"td",16),p(),g(28,17),c(29,Be,2,0,"th",15)(30,He,2,1,"td",16),p(),g(31,18),c(32,Ve,2,0,"th",15)(33,ze,3,2,"td",16),p(),g(34,19),c(35,Qe,2,0,"th",15)(36,je,2,1,"td",16),p(),g(37,20),c(38,qe,2,0,"th",15)(39,We,2,1,"td",16),p(),g(40,21),c(41,Ge,2,0,"th",22)(42,Je,4,0,"td",16),p(),c(43,Ke,1,0,"tr",23)(44,Xe,1,0,"tr",24)(45,Ye,7,0,"tr",25),r(),C(46,"mat-paginator",26),r()()()()),n&2&&(s(14),m("formControl",i.searchControl),s(6),m("formControl",i.roleFilterControl),s(),m("ngForOf",i.roles),s(2),m("ngIf",i.isLoading),s(),m("dataSource",i.dataSource),s(19),m("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),s(),m("matRowDefColumns",i.displayedColumns),s(2),m("pageSizeOptions",R(10,Ie))("pageSize",50))},dependencies:[H,N,$,B,G,j,q,W,Ee,S,Oe,xe,Pe,be,we,ve,Se,ye,De,Ue,Me,P,he,v,_e,ae,ne,ee,Y,Z,te,oe,re,ie,ue,pe,ge,se,le,X,J,K,Ce,fe,de,me],styles:[".user-management-container[_ngcontent-%COMP%]{padding:24px;background-color:#f5f5f5;min-height:calc(100vh - 64px)}.user-management-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.user-management-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{font-size:28px;font-weight:500;color:#4a3c31;margin:0}.user-management-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.user-management-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .create-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.user-management-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a}.user-management-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px}.user-management-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:16px}@media (max-width: 768px){.user-management-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]{flex-direction:column}}.user-management-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{flex:3}.user-management-container[_ngcontent-%COMP%]   .filter-container[_ngcontent-%COMP%]   .role-filter[_ngcontent-%COMP%]{flex:1;min-width:180px}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]{position:relative;min-height:400px;overflow:auto}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .loading-shade[_ngcontent-%COMP%]{position:absolute;inset:0;background:#0000000d;z-index:1;display:flex;align-items:center;justify-content:center}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .loading-shade[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]     circle{stroke:#c19a6b}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]{width:100%}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#4a3c31;color:#fff;font-weight:500;white-space:nowrap}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{cursor:pointer}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:nth-child(2n){background-color:#00000005}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .user-row[_ngcontent-%COMP%]{transition:background-color .2s ease}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .role-badge[_ngcontent-%COMP%]{padding:4px 12px;border-radius:16px;font-size:12px;font-weight:500;display:inline-block;text-align:center;min-width:90px}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .role-badge.superadmin[_ngcontent-%COMP%]{background-color:#4a3c31;color:#fff}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .role-badge.admin[_ngcontent-%COMP%]{background-color:#2196f3;color:#fff}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .role-badge.driver[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .role-badge.default[_ngcontent-%COMP%]{background-color:#9e9e9e;color:#fff}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:32px;color:#9e9e9e}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px}.user-management-container[_ngcontent-%COMP%]   .table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px}  .mat-mdc-form-field-appearance-outline .mat-mdc-form-field-outline{color:#9e9e9e}  .mat-mdc-form-field-appearance-outline.mat-focused .mat-mdc-form-field-outline{color:#c19a6b}  .mat-mdc-paginator{background-color:transparent}  .error-snackbar{background-color:#b00020;color:#fff}@media (max-width: 992px){.user-management-container[_ngcontent-%COMP%]{padding:16px}.user-management-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%], .user-management-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{padding:0 8px}}@media (max-width: 768px){.user-management-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-column-team[_ngcontent-%COMP%]{display:none}}@media (max-width: 576px){.user-management-container[_ngcontent-%COMP%]   .users-table[_ngcontent-%COMP%]   .mat-column-lastActive[_ngcontent-%COMP%]{display:none}}"]})};export{Ae as UserManagementComponent};
