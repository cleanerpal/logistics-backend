import"./chunk-DWEM3L4R.js";import{a as ie,b as oe}from"./chunk-ESJIWLK4.js";import{c as ne}from"./chunk-4TDDZIB3.js";import"./chunk-PP7BOOB7.js";import"./chunk-DQFV6XNM.js";import{a as z,b as F,c as L,d as U,e as $,f as q,h as G}from"./chunk-OFY7VGJP.js";import"./chunk-P7ITNQJW.js";import{a as Z,b as ee}from"./chunk-HDC6EVXZ.js";import{b as te}from"./chunk-Q2NIOR5G.js";import{C as H,E as Q,F as Y,H as K,I as W,J as X}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as y,c as I,d as k,g as E}from"./chunk-4PPYA6ZN.js";import{ga as w,h as P,i as j,ia as V,j as D,ka as T,ma as A,o as S,oa as J,ra as R,ua as N,xa as B}from"./chunk-3O2P3FIP.js";import{Cb as l,Lb as n,Mb as t,Nb as _,Rb as M,Vb as u,Wb as g,db as r,fc as i,gc as v,hc as d,ib as p,ic as O,pa as b,pb as x,qa as C,qc as f,vb as m}from"./chunk-NXWLSP6D.js";import{g as h}from"./chunk-RA2WU32H.js";var re=c=>({"service-due-soon":c}),ce=c=>["/jobs/edit",c];function le(c,o){c&1&&(n(0,"div",10),_(1,"mat-spinner",11),t())}function se(c,o){c&1&&(n(0,"div",25),i(1," No recent jobs found for this vehicle. "),t())}function de(c,o){if(c&1&&(n(0,"div",38),i(1),t()),c&2){let e=g().$implicit;r(),d(" Ref: ",e.customerReference," ")}}function me(c,o){c&1&&_(0,"mat-divider")}function ge(c,o){if(c&1&&(n(0,"div",28)(1,"div",29)(2,"div",30),i(3),t(),n(4,"div",31),i(5),t()(),n(6,"div",32),m(7,de,2,1,"div",33),n(8,"div",34)(9,"div",35)(10,"mat-icon"),i(11,"calendar_today"),t(),i(12),t(),n(13,"div",35)(14,"mat-icon"),i(15,"calendar_today"),t(),i(16),t()()(),n(17,"div",36)(18,"a",37),i(19," View Details "),t()(),m(20,me,1,0,"mat-divider",24),t()),c&2){let e=o.$implicit,a=o.last,s=g(3);r(3),v(e.id),r(),l("ngClass",s.getJobStatusColorClass(e.status)),r(),d(" ",e.status," "),r(2),l("ngIf",e.customerReference),r(5),d(" Collection: ",s.formatDate(e.collectionDate)," "),r(4),d(" Delivery: ",s.formatDate(e.deliveryDate)," "),r(2),l("routerLink",f(8,ce,e.id)),r(2),l("ngIf",!a)}}function pe(c,o){if(c&1&&(n(0,"div",26),m(1,ge,21,10,"div",27),t()),c&2){let e=g(2);r(),l("ngForOf",e.recentJobs)}}function ue(c,o){if(c&1){let e=M();n(0,"mat-card-actions")(1,"button",39),u("click",function(){b(e);let s=g(2);return C(s.viewAllJobs())}),i(2," View All Jobs "),n(3,"mat-icon"),i(4,"arrow_forward"),t()()()}}function ve(c,o){if(c&1&&(n(0,"div",12)(1,"mat-card",13)(2,"mat-card-header")(3,"mat-card-title"),i(4),t(),n(5,"mat-card-subtitle"),i(6),t(),n(7,"div",14)(8,"div",15),i(9),t()()(),n(10,"mat-card-content")(11,"div",16)(12,"div",17)(13,"div",18),i(14,"Type"),t(),n(15,"div",19),i(16),t()(),n(17,"div",17)(18,"div",18),i(19,"Year"),t(),n(20,"div",19),i(21),t()(),n(22,"div",17)(23,"div",18),i(24,"Current Location"),t(),n(25,"div",19),i(26),t()(),n(27,"div",17)(28,"div",18),i(29,"Current Driver"),t(),n(30,"div",19),i(31),t()(),n(32,"div",17)(33,"div",18),i(34,"Last Service Date"),t(),n(35,"div",19),i(36),t()(),n(37,"div",17)(38,"div",18),i(39,"Next Service Due"),t(),n(40,"div",20),i(41),t()()()()(),n(42,"mat-card",21)(43,"mat-card-header")(44,"mat-card-title"),i(45,"Recent Jobs"),t()(),n(46,"mat-card-content"),m(47,se,2,0,"div",22)(48,pe,2,1,"div",23),t(),m(49,ue,5,0,"mat-card-actions",24),t()()),c&2){let e=g();r(4),O("",e.vehicle.make," ",e.vehicle.model,""),r(2),v(e.vehicle.registration),r(2),l("ngClass",e.getStatusColorClass(e.vehicle.status)),r(),d(" ",e.vehicle.status," "),r(7),v(e.vehicle.type),r(5),v(e.vehicle.year),r(5),d(" ",e.vehicle.location||"Not specified"," "),r(5),d(" ",e.vehicle.currentDriverName||"None assigned"," "),r(5),d(" ",e.formatDate(e.vehicle.lastServiceDate)," "),r(4),l("ngClass",f(15,re,e.isServiceDueSoon())),r(),d(" ",e.formatDate(e.vehicle.nextServiceDue)," "),r(6),l("ngIf",e.recentJobs.length===0),r(),l("ngIf",e.recentJobs.length>0),r(),l("ngIf",e.recentJobs.length>0)}}var ae=class c{constructor(o,e,a,s){this.route=o;this.router=e;this.firestore=a;this.snackBar=s}vehicleId=null;vehicle=null;recentJobs=[];loading=!0;jobsSubscription;ngOnInit(){this.route.paramMap.subscribe(o=>{this.vehicleId=o.get("id"),this.vehicleId?this.loadVehicleData():(this.snackBar.open("Vehicle ID not provided","Close",{duration:3e3}),this.router.navigate(["/vehicles"]))})}ngOnDestroy(){this.jobsSubscription&&this.jobsSubscription.unsubscribe()}loadVehicleData(){return h(this,null,function*(){if(this.vehicleId)try{let o=A(this.firestore,"Vehicles",this.vehicleId),e=yield J(o);if(e.exists()){let a=e.data();this.vehicle={id:e.id,registration:a.registration||"",make:a.make||"",model:a.model||"",type:a.type||"",year:a.year||0,location:a.location||"",status:a.status||"Available",lastServiceDate:a.lastServiceDate,nextServiceDue:a.nextServiceDue,currentDriverId:a.currentDriverId,currentDriverName:a.currentDriverName,createdAt:a.createdAt,updatedAt:a.updatedAt},this.loadRecentJobs()}else this.snackBar.open("Vehicle not found","Close",{duration:3e3}),this.router.navigate(["/vehicles"])}catch(o){console.error("Error loading vehicle:",o),this.snackBar.open("Error loading vehicle details","Close",{duration:3e3}),this.loading=!1}})}loadRecentJobs(){if(this.vehicleId)try{let o=T(this.firestore,"Jobs"),e=N(o,B("vehicleId","==",this.vehicleId),R(5));this.jobsSubscription=V(e,{idField:"id"}).subscribe({next:a=>{this.recentJobs=a,this.loading=!1},error:a=>{console.error("Error loading recent jobs:",a),this.loading=!1}})}catch(o){console.error("Error setting up jobs subscription:",o),this.loading=!1}}editVehicle(){this.vehicleId&&this.router.navigate(["/vehicles/edit",this.vehicleId])}viewAllJobs(){this.vehicleId&&this.router.navigate(["/vehicles",this.vehicleId,"jobs"])}goBack(){this.router.navigate(["/vehicles"])}formatDate(o){return o?o.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A"}getStatusColorClass(o){switch(o){case"Available":return"status-available";case"In Use":return"status-in-use";case"Maintenance":return"status-maintenance";case"Out of Service":return"status-out-of-service";default:return""}}isServiceDueSoon(){if(!this.vehicle?.nextServiceDue)return!1;let o=new Date,a=this.vehicle.nextServiceDue.toDate().getTime()-o.getTime(),s=Math.ceil(a/(1e3*60*60*24));return s<=30&&s>0}getJobStatusColorClass(o){switch(o){case"Unallocated":return"job-status-unallocated";case"Allocated":return"job-status-allocated";case"Collected":return"job-status-collected";case"Delivered":return"job-status-delivered";case"Cancelled":return"job-status-cancelled";default:return""}}static \u0275fac=function(e){return new(e||c)(p(y),p(I),p(w),p(te))};static \u0275cmp=x({type:c,selectors:[["app-vehicle-details"]],decls:19,vars:2,consts:[[1,"vehicle-details-container"],[1,"page-header"],[1,"title-section"],["mat-icon-button","","color","primary",1,"back-button",3,"click"],[1,"page-title"],[1,"header-actions"],["mat-raised-button","","color","primary",3,"click"],["mat-stroked-button","","color","accent",3,"click"],["class","loading-container",4,"ngIf"],["class","details-content",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"details-content"],[1,"info-card"],[1,"status-chip-container"],[1,"status-chip",3,"ngClass"],[1,"details-grid"],[1,"details-item"],[1,"details-label"],[1,"details-value"],[1,"details-value",3,"ngClass"],[1,"recent-jobs-card"],["class","no-jobs-message",4,"ngIf"],["class","jobs-list",4,"ngIf"],[4,"ngIf"],[1,"no-jobs-message"],[1,"jobs-list"],["class","job-item",4,"ngFor","ngForOf"],[1,"job-item"],[1,"job-header"],[1,"job-id"],[1,"job-status",3,"ngClass"],[1,"job-details"],["class","job-reference",4,"ngIf"],[1,"job-dates"],[1,"job-date"],[1,"job-actions"],["mat-stroked-button","","color","primary",3,"routerLink"],[1,"job-reference"],["mat-button","","color","primary",3,"click"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),u("click",function(){return a.goBack()}),n(4,"mat-icon"),i(5,"arrow_back"),t()(),n(6,"h1",4),i(7,"Vehicle Details"),t()(),n(8,"div",5)(9,"button",6),u("click",function(){return a.editVehicle()}),n(10,"mat-icon"),i(11,"edit"),t(),i(12," Edit Vehicle "),t(),n(13,"button",7),u("click",function(){return a.viewAllJobs()}),n(14,"mat-icon"),i(15,"work"),t(),i(16," View All Jobs "),t()()(),m(17,le,2,0,"div",8)(18,ve,50,17,"div",9),t()),e&2&&(r(17),l("ngIf",a.loading),r(),l("ngIf",!a.loading&&a.vehicle))},dependencies:[S,P,j,D,E,k,G,z,$,L,q,U,F,K,Y,Q,H,X,W,ne,oe,ie,ee,Z],styles:[".vehicle-details-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;align-items:center}.page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{margin-right:8px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background-color:#c19a6b;color:#fff}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}}@media (max-width: 576px){.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.details-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}@media (max-width: 992px){.details-content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.info-card[_ngcontent-%COMP%], .recent-jobs-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a;height:100%}.info-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%], .recent-jobs-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{position:relative;padding:16px 16px 0}.info-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%], .recent-jobs-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:20px;margin-bottom:4px}.info-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%], .recent-jobs-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:16px}.info-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%], .recent-jobs-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.status-chip-container[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px}.status-chip[_ngcontent-%COMP%]{padding:4px 12px;border-radius:16px;font-size:12px;font-weight:500;color:#fff;display:inline-block;text-align:center}.status-chip.status-available[_ngcontent-%COMP%]{background-color:#4caf50}.status-chip.status-in-use[_ngcontent-%COMP%]{background-color:#2196f3}.status-chip.status-maintenance[_ngcontent-%COMP%]{background-color:#ffc107}.status-chip.status-out-of-service[_ngcontent-%COMP%]{background-color:#f44336}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}@media (max-width: 576px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.details-item[_ngcontent-%COMP%]   .details-label[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:4px}.details-item[_ngcontent-%COMP%]   .details-value[_ngcontent-%COMP%]{font-size:16px;color:#333;font-weight:500}.details-item[_ngcontent-%COMP%]   .details-value.service-due-soon[_ngcontent-%COMP%]{color:#f44336}.no-jobs-message[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#666;font-style:italic}.jobs-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.job-item[_ngcontent-%COMP%]{padding:16px 0}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-id[_ngcontent-%COMP%]{font-weight:500;font-size:16px;color:#4a3c31}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status[_ngcontent-%COMP%]{padding:4px 12px;border-radius:16px;font-size:12px;font-weight:500;color:#fff}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status.job-status-unallocated[_ngcontent-%COMP%]{background-color:#f44336}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status.job-status-allocated[_ngcontent-%COMP%]{background-color:#ffc107}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status.job-status-collected[_ngcontent-%COMP%]{background-color:#2196f3}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status.job-status-delivered[_ngcontent-%COMP%]{background-color:#4caf50}.job-item[_ngcontent-%COMP%]   .job-header[_ngcontent-%COMP%]   .job-status.job-status-cancelled[_ngcontent-%COMP%]{background-color:#9e9e9e}.job-item[_ngcontent-%COMP%]   .job-details[_ngcontent-%COMP%]{margin-bottom:16px}.job-item[_ngcontent-%COMP%]   .job-details[_ngcontent-%COMP%]   .job-reference[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:8px}.job-item[_ngcontent-%COMP%]   .job-details[_ngcontent-%COMP%]   .job-dates[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.job-item[_ngcontent-%COMP%]   .job-details[_ngcontent-%COMP%]   .job-dates[_ngcontent-%COMP%]   .job-date[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:14px;color:#333}.job-item[_ngcontent-%COMP%]   .job-details[_ngcontent-%COMP%]   .job-dates[_ngcontent-%COMP%]   .job-date[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;height:16px;width:16px;margin-right:4px;color:#c19a6b}.job-item[_ngcontent-%COMP%]   .job-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.mat-mdc-card-actions[_ngcontent-%COMP%]{padding:8px 16px 16px;display:flex;justify-content:center}"]})};export{ae as VehicleDetailsComponent};
