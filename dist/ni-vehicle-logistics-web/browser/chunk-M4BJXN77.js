import{c as y}from"./chunk-4PPYA6ZN.js";import{_ as R,ca as U,da as D,ga as w,ja as v,ka as h,la as x,ma as o,oa as $,sa as f,ua as p,va as A,wa as L}from"./chunk-3O2P3FIP.js";import{aa as b,c as a,ga as c}from"./chunk-NXWLSP6D.js";import{a as m,g as n}from"./chunk-RA2WU32H.js";var P=class u{auth=c(R);firestore=c(w);router=c(y);user$;constructor(){this.user$=new a(t=>({unsubscribe:this.auth.onAuthStateChanged(e=>{e?this.getUserData(e.uid).then(i=>{i?t.next({uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||"",role:i.role}):t.next({uid:e.uid,email:e.email||"",displayName:e.displayName||"",photoURL:e.photoURL||""})}):t.next(null)})}))}getUserData(t){return n(this,null,function*(){let r=o(this.firestore,`users/${t}`),e=yield $(r);return e.exists()?e.data():null})}emailLogin(t,r){return n(this,null,function*(){try{let e=yield U(this.auth,t,r);return this.updateUserData(e.user)}catch(e){throw console.error("Email login error:",e),e}})}signOut(){return n(this,null,function*(){yield D(this.auth),this.router.navigate(["/login"])})}updateUserData(t){return n(this,null,function*(){if(!t)return;let r=o(this.firestore,`users/${t.uid}`),e={uid:t.uid,email:t.email||"",displayName:t.displayName||"",photoURL:t.photoURL||""};return A(r,e,{merge:!0})})}getDocumentWithSnapshot(t,r){return new a(e=>{let i=o(this.firestore,`${t}/${r}`);return{unsubscribe:f(i,s=>{s.exists()?e.next(m({id:s.id},s.data())):e.next(null)},s=>{e.error(s)})}})}getCollectionWithSnapshot(t,r){return new a(e=>{let i=h(this.firestore,t),l=p(i);return r&&r.length>0&&(l=p(i,...r)),{unsubscribe:f(l,d=>{let T=d.docs.map(g=>m({id:g.id},g.data()));e.next(T)},d=>{e.error(d)})}})}addDocument(t,r){return n(this,null,function*(){let e=h(this.firestore,t);return(yield v(e,r)).id})}updateDocument(t,r,e){return n(this,null,function*(){let i=o(this.firestore,`${t}/${r}`);return L(i,e)})}deleteDocument(t,r){return n(this,null,function*(){let e=o(this.firestore,`${t}/${r}`);return x(e)})}isAuthenticated(){return new a(t=>({unsubscribe:this.auth.onAuthStateChanged(e=>{t.next(!!e)})}))}static \u0275fac=function(r){return new(r||u)};static \u0275prov=b({token:u,factory:u.\u0275fac,providedIn:"root"})};export{P as a};
