import"./chunk-F5X5MWHG.js";import{a as S,b as ut}from"./chunk-VWFB2ZCV.js";import{a as _t,b as ft}from"./chunk-6ZM5HFJH.js";import{b as rt,c as nt}from"./chunk-LDLE5TDT.js";import"./chunk-DJMXPRNS.js";import"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as it}from"./chunk-FL7UC7QU.js";import{a as w,b as vt,c as gt}from"./chunk-RGR4672A.js";import{a as Ct,b as ht,c as xt,d as bt,e as Dt,f as Mt,g as St,h as wt,i as yt,j as Tt,k as Et,l as It,m as Pt}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as W,c as X,h as Y}from"./chunk-OFY7VGJP.js";import{b as Z,f as tt,i as et}from"./chunk-P7ITNQJW.js";import{a as st,b as dt}from"./chunk-HDC6EVXZ.js";import{b as pt}from"./chunk-Q2NIOR5G.js";import{C as ot,E as at,H as lt,I as mt,J as ct,b as L,g as q,k as U,n as G,w as K}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{c as $}from"./chunk-4PPYA6ZN.js";import{ga as B,ia as H,j as F,ka as J,o as N,ra as A,ta as Q,ua as j,xa as z}from"./chunk-3O2P3FIP.js";import{$b as y,Cb as d,H as I,L as P,Lb as r,Mb as n,Nb as C,Ob as _,Pb as f,Rb as D,Vb as u,Wb as p,ac as T,bc as E,db as l,ec as k,fc as o,gc as h,hc as M,ib as b,pa as v,pb as O,pc as R,qa as g,vb as c,wc as V}from"./chunk-NXWLSP6D.js";import"./chunk-RA2WU32H.js";var kt=()=>[10,25,50];function Rt(t,e){if(t&1){let i=D();r(0,"button",13),u("click",function(){v(i);let m=p();return g(m.searchControl.setValue(""))}),r(1,"mat-icon"),o(2,"close"),n()()}}function Vt(t,e){t&1&&(r(0,"div",14),C(1,"mat-spinner",15),n())}function Ft(t,e){t&1&&(r(0,"th",32),o(1,"Driver ID"),n())}function Nt(t,e){if(t&1&&(r(0,"td",33),o(1),n()),t&2){let i=e.$implicit;l(),h(i.id)}}function $t(t,e){t&1&&(r(0,"th",32),o(1,"Name"),n())}function Bt(t,e){if(t&1&&(r(0,"td",33),o(1),n()),t&2){let i=e.$implicit;l(),h(i.displayName)}}function Ht(t,e){t&1&&(r(0,"th",32),o(1,"Email"),n())}function Jt(t,e){if(t&1&&(r(0,"td",33),o(1),n()),t&2){let i=e.$implicit;l(),h(i.email)}}function At(t,e){t&1&&(r(0,"th",32),o(1,"Team"),n())}function Qt(t,e){if(t&1&&(r(0,"td",33),o(1),n()),t&2){let i=e.$implicit;l(),h(i.team)}}function jt(t,e){t&1&&(r(0,"th",32),o(1," Currently Driving "),n())}function zt(t,e){if(t&1&&(r(0,"span",36),o(1),n()),t&2){let i=p(2).$implicit;l(),M(" (",i.currentJobVehicle,") ")}}function Lt(t,e){if(t&1&&(r(0,"span"),o(1),c(2,zt,2,1,"span",35),n()),t&2){let i=p().$implicit;l(),M(" ",i.currentJobId," "),l(),d("ngIf",i.currentJobVehicle)}}function qt(t,e){t&1&&o(0,"None")}function Ut(t,e){if(t&1&&(r(0,"td",33),c(1,Lt,3,2,"span",34)(2,qt,1,0,"ng-template",null,0,V),n()),t&2){let i=e.$implicit,a=k(3);l(),d("ngIf",i.currentJobId)("ngIfElse",a)}}function Gt(t,e){t&1&&(r(0,"th",32),o(1,"Last Active"),n())}function Kt(t,e){if(t&1&&(r(0,"td",33),o(1),n()),t&2){let i=e.$implicit,a=p(2);l(),M(" ",a.formatDate(i.lastActive)," ")}}function Wt(t,e){t&1&&(r(0,"th",37),o(1,"Actions"),n())}function Xt(t,e){if(t&1){let i=D();r(0,"td",33)(1,"div",38)(2,"button",39),u("click",function(m){let s=v(i).$implicit;return p(2).editDriver(s.id),g(m.stopPropagation())}),r(3,"mat-icon"),o(4,"edit"),n()(),r(5,"button",40),u("click",function(m){let s=v(i).$implicit;return p(2).viewDriverJobs(s.id),g(m.stopPropagation())}),r(6,"mat-icon"),o(7,"list_alt"),n()()()()}}function Yt(t,e){t&1&&C(0,"tr",41)}function Zt(t,e){if(t&1){let i=D();r(0,"tr",42),u("click",function(){let m=v(i).$implicit,s=p(2);return g(s.editDriver(m.id))}),n()}}function te(t,e){t&1&&(r(0,"tr",43)(1,"td",44),o(2," No drivers found matching the current filters "),n()())}function ee(t,e){if(t&1&&(r(0,"div",16)(1,"table",17),_(2,18),c(3,Ft,2,0,"th",19)(4,Nt,2,1,"td",20),f(),_(5,21),c(6,$t,2,0,"th",19)(7,Bt,2,1,"td",20),f(),_(8,22),c(9,Ht,2,0,"th",19)(10,Jt,2,1,"td",20),f(),_(11,23),c(12,At,2,0,"th",19)(13,Qt,2,1,"td",20),f(),_(14,24),c(15,jt,2,0,"th",19)(16,Ut,4,2,"td",20),f(),_(17,25),c(18,Gt,2,0,"th",19)(19,Kt,2,1,"td",20),f(),_(20,26),c(21,Wt,2,0,"th",27)(22,Xt,8,0,"td",20),f(),c(23,Yt,1,0,"tr",28)(24,Zt,1,0,"tr",29)(25,te,3,0,"tr",30),n(),C(26,"mat-paginator",31),n()),t&2){let i=p();l(),d("dataSource",i.dataSource),l(22),d("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),l(),d("matRowDefColumns",i.displayedColumns),l(2),d("pageSizeOptions",R(6,kt))("pageSize",50)}}var Ot=class t{constructor(e,i,a){this.firestore=e;this.router=i;this.snackBar=a}drivers=[];dataSource=new Pt([]);displayedColumns=["id","displayName","email","team","currentJob","lastActive","actions"];searchControl=new U("");loading=!0;subscription;searchSubscription;paginator;sort;ngOnInit(){this.loadDrivers(),this.initSearchSubscription()}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe(),this.searchSubscription&&this.searchSubscription.unsubscribe()}loadDrivers(){this.loading=!0;let e=J(this.firestore,"Users"),i=j(e,z("role","==","Driver"),Q("displayName"),A(50));this.subscription=H(i,{idField:"id"}).subscribe({next:a=>{this.drivers=a,this.dataSource.data=this.drivers,setTimeout(()=>{this.paginator&&this.sort&&(this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort)}),this.loading=!1},error:a=>{console.error("Error loading drivers:",a),this.snackBar.open("Error loading drivers. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}initSearchSubscription(){this.searchSubscription=this.searchControl.valueChanges.pipe(I(300),P()).subscribe(e=>{this.applyFilter(e||"")})}applyFilter(e){this.dataSource.filter=e.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}navigateToCreate(){this.router.navigate(["/drivers/create"])}editDriver(e){this.router.navigate(["/drivers/edit",e])}viewDriverJobs(e){this.router.navigate(["/drivers",e,"jobs"])}formatDate(e){if(!e)return"Never";let i=new Date,a=e.toDate(),m=i.getTime()-a.getTime(),s=Math.round(m/(1e3*60));if(s<60)return`${s} min${s!==1?"s":""} ago`;if(s<1440){let x=Math.floor(s/60);return`${x} hour${x!==1?"s":""} ago`}else return a.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}static \u0275fac=function(i){return new(i||t)(b(B),b($),b(pt))};static \u0275cmp=O({type:t,selectors:[["app-drivers"]],viewQuery:function(i,a){if(i&1&&(y(S,5),y(w,5)),i&2){let m;T(m=E())&&(a.paginator=m.first),T(m=E())&&(a.sort=m.first)}},decls:20,vars:4,consts:[["notDriving",""],[1,"drivers-container"],[1,"page-header"],[1,"page-title"],[1,"header-actions"],["mat-raised-button","","color","primary",1,"create-button",3,"click"],[1,"search-card"],["appearance","outline",1,"search-input"],["matInput","","placeholder","Search by name, ID, or email...",3,"formControl"],["mat-icon-button","","matSuffix","","aria-label","Clear",3,"click",4,"ngIf"],["matSuffix",""],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["mat-icon-button","","matSuffix","","aria-label","Clear",3,"click"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"drivers-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","displayName"],["matColumnDef","email"],["matColumnDef","team"],["matColumnDef","currentJob"],["matColumnDef","lastActive"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","driver-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of drivers",3,"pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[4,"ngIf","ngIfElse"],["class","vehicle-info",4,"ngIf"],[1,"vehicle-info"],["mat-header-cell",""],[1,"action-buttons"],["mat-icon-button","","color","primary","matTooltip","Edit Driver",3,"click"],["mat-icon-button","","color","accent","matTooltip","View Jobs",3,"click"],["mat-header-row",""],["mat-row","",1,"driver-row",3,"click"],[1,"mat-row"],["colspan","7",1,"mat-cell"]],template:function(i,a){i&1&&(r(0,"div",1)(1,"div",2)(2,"h1",3),o(3,"Drivers Management"),n(),r(4,"div",4)(5,"button",5),u("click",function(){return a.navigateToCreate()}),r(6,"mat-icon"),o(7,"add"),n(),o(8," Create Driver "),n()()(),r(9,"mat-card",6)(10,"mat-card-content")(11,"mat-form-field",7)(12,"mat-label"),o(13,"Search Drivers"),n(),C(14,"input",8),c(15,Rt,3,0,"button",9),r(16,"mat-icon",10),o(17,"search"),n()()()(),c(18,Vt,2,0,"div",11)(19,ee,27,7,"div",12),n()),i&2&&(l(14),d("formControl",a.searchControl),l(),d("ngIf",a.searchControl.value),l(3),d("ngIf",a.loading),l(),d("ngIf",!a.loading))},dependencies:[N,F,K,L,q,G,It,Ct,xt,St,bt,ht,wt,Dt,Mt,yt,Tt,Et,gt,w,vt,ut,S,Y,W,X,lt,at,ot,ct,mt,it,et,Z,tt,nt,rt,dt,st,ft,_t],styles:[".drivers-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.header-actions[_ngcontent-%COMP%]{width:100%}}.create-button[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.search-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.search-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.search-input[_ngcontent-%COMP%]{width:100%}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.drivers-table[_ngcontent-%COMP%]{width:100%}.drivers-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:500;color:#4a3c31;white-space:nowrap}.drivers-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{color:#333}.drivers-table[_ngcontent-%COMP%]   .driver-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}.drivers-table[_ngcontent-%COMP%]   .driver-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px}.vehicle-info[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-left:4px}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5}.mat-mdc-no-data-row[_ngcontent-%COMP%]{padding:16px;text-align:center;color:#666;font-style:italic}"]})};export{Ot as DriversComponent};
