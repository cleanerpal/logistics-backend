import{a as mt,b as dt,c as pt,d as ft,i as ht}from"./chunk-PQIIHW7R.js";import"./chunk-GW6WOXIL.js";import"./chunk-MS4AQ6UA.js";import{b as Y,c as tt}from"./chunk-LDLE5TDT.js";import{a as h}from"./chunk-A3IKIUS4.js";import{a as st,b as ct}from"./chunk-DJMXPRNS.js";import{d as lt}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as X}from"./chunk-FL7UC7QU.js";import"./chunk-DQFV6XNM.js";import{a as L,b as U,c as G,d as H,f as q,h as W}from"./chunk-OFY7VGJP.js";import{b as Z,f as $,i as K}from"./chunk-P7ITNQJW.js";import{a as it,b as rt}from"./chunk-HDC6EVXZ.js";import{b as ot}from"./chunk-Q2NIOR5G.js";import{E as et,H as at,J as nt,b as I,g as V,h as z,i as N,k as g,l as Q,o as B,q as j,w as J}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{ga as F,j as O,o as T}from"./chunk-3O2P3FIP.js";import{$b as d,Cb as c,Lb as i,Mb as a,Nb as m,Ob as S,Pb as w,Rb as k,Vb as b,Wb as A,ac as p,bc as f,db as s,ec as M,fc as o,ga as v,pa as E,pb as R,qa as P,vb as D}from"./chunk-NXWLSP6D.js";import{g as _}from"./chunk-RA2WU32H.js";var gt=["jobTrendsChart"],Ct=["deliveryPerformanceChart"],yt=["driverPerformanceChart"],vt=["vehicleUtilizationChart"];function Dt(l,t){if(l&1){let n=k();S(0),i(1,"mat-form-field",10)(2,"mat-label"),o(3,"Start Date"),a(),m(4,"input",19)(5,"mat-datepicker-toggle",20)(6,"mat-datepicker",null,0),a(),i(8,"mat-form-field",10)(9,"mat-label"),o(10,"End Date"),a(),m(11,"input",21)(12,"mat-datepicker-toggle",20)(13,"mat-datepicker",null,1),a(),i(15,"button",22),b("click",function(){E(n);let r=A();return P(r.applyCustomDateRange())}),o(16," Apply "),a(),w()}if(l&2){let n=M(7),e=M(14);s(4),c("matDatepicker",n),s(),c("for",n),s(6),c("matDatepicker",e),s(),c("for",e)}}function bt(l,t){l&1&&(i(0,"div",23),m(1,"mat-spinner",24),a())}function Mt(l,t){l&1&&(i(0,"div",25)(1,"mat-card",26)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Job Volume Trends"),a(),i(5,"mat-card-subtitle"),o(6,"Total jobs by day"),a()(),i(7,"mat-card-content")(8,"div",27),m(9,"canvas",null,2),a()()(),i(11,"mat-card",26)(12,"mat-card-header")(13,"mat-card-title"),o(14,"Delivery Performance"),a(),i(15,"mat-card-subtitle"),o(16,"On-time vs delayed deliveries"),a()(),i(17,"mat-card-content")(18,"div",27),m(19,"canvas",null,3),a()()(),i(21,"mat-card",26)(22,"mat-card-header")(23,"mat-card-title"),o(24,"Driver Performance"),a(),i(25,"mat-card-subtitle"),o(26,"Average jobs per driver"),a()(),i(27,"mat-card-content")(28,"div",27),m(29,"canvas",null,4),a()()(),i(31,"mat-card",26)(32,"mat-card-header")(33,"mat-card-title"),o(34,"Vehicle Utilization"),a(),i(35,"mat-card-subtitle"),o(36,"Job counts by vehicle type"),a()(),i(37,"mat-card-content")(38,"div",27),m(39,"canvas",null,5),a()()()())}var ut=class l{firestore=v(F);snackBar=v(ot);jobTrendsChartRef;deliveryPerformanceChartRef;driverPerformanceChartRef;vehicleUtilizationChartRef;charts=[];loading=!0;filterForm=new N({dateRange:new g("last30days"),startDate:new g(null),endDate:new g(null)});startDate=new Date;endDate=new Date;constructor(){this.endDate=new Date,this.startDate=new Date,this.startDate.setDate(this.startDate.getDate()-30)}ngOnInit(){this.loadAnalyticsData()}ngAfterViewInit(){this.initializeCharts()}ngOnDestroy(){this.charts.forEach(t=>t.destroy())}onDateRangeChange(){let t=this.filterForm.get("dateRange")?.value;if(t==="custom")return;let n=new Date,e=new Date;switch(t){case"last7days":e.setDate(n.getDate()-7);break;case"last30days":e.setDate(n.getDate()-30);break;case"lastQuarter":e.setMonth(n.getMonth()-3);break}this.startDate=e,this.endDate=n,this.filterForm.get("startDate")?.setValue(e),this.filterForm.get("endDate")?.setValue(n),this.loadAnalyticsData()}applyCustomDateRange(){let t=this.filterForm.get("startDate")?.value,n=this.filterForm.get("endDate")?.value;t&&n?(this.startDate=t,this.endDate=n,this.loadAnalyticsData()):this.snackBar.open("Please select both start and end dates","Close",{duration:3e3})}loadAnalyticsData(){return _(this,null,function*(){this.loading=!0;try{setTimeout(()=>{this.updateCharts(),this.loading=!1},1e3)}catch(t){console.error("Error loading analytics data:",t),this.snackBar.open("Error loading analytics data. Please try again.","Close",{duration:5e3}),this.loading=!1}})}initializeCharts(){setTimeout(()=>{this.initJobTrendsChart(),this.initDeliveryPerformanceChart(),this.initDriverPerformanceChart(),this.initVehicleUtilizationChart()},100)}updateCharts(){this.charts.forEach(t=>t.update())}initJobTrendsChart(){if(!this.jobTrendsChartRef)return;let t=this.jobTrendsChartRef.nativeElement.getContext("2d");if(!t)return;let r={type:"line",data:{labels:Array.from({length:7},(x,C)=>{let y=new Date;return y.setDate(y.getDate()-6+C),y.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}),datasets:[{label:"Job Volumes",data:[12,19,15,20,25,18,22],backgroundColor:"#C19A6B",borderColor:"#C19A6B",borderWidth:2,tension:.4,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Jobs"}},x:{title:{display:!0,text:"Date"}}}}},u=new h(t,r);this.charts.push(u)}initDeliveryPerformanceChart(){if(!this.deliveryPerformanceChartRef)return;let t=this.deliveryPerformanceChartRef.nativeElement.getContext("2d");if(!t)return;let e={type:"doughnut",data:{labels:["On Time","Delayed"],datasets:[{data:[85,15],backgroundColor:["#4CAF50","#F44336"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:u=>{let x=u.label||"",C=u.raw;return`${x}: ${C}%`}}}}}},r=new h(t,e);this.charts.push(r)}initDriverPerformanceChart(){if(!this.driverPerformanceChartRef)return;let t=this.driverPerformanceChartRef.nativeElement.getContext("2d");if(!t)return;let e={type:"bar",data:{labels:["John D.","Sarah M.","Robert L.","Emma W.","Michael T."],datasets:[{label:"Jobs Completed",data:[18,15,12,20,16],backgroundColor:"#4A3C31",barThickness:30}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,title:{display:!0,text:"Jobs Completed"}},x:{title:{display:!0,text:"Driver"}}}}},r=new h(t,e);this.charts.push(r)}initVehicleUtilizationChart(){if(!this.vehicleUtilizationChartRef)return;let t=this.vehicleUtilizationChartRef.nativeElement.getContext("2d");if(!t)return;let e={type:"pie",data:{labels:["Sedan","SUV","Van","Truck","Special"],datasets:[{label:"Jobs by Vehicle Type",data:[25,40,30,15,5],backgroundColor:["#C19A6B","#4A3C31","#333333","#795548","#9E9E9E"],borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}}},r=new h(t,e);this.charts.push(r)}static \u0275fac=function(n){return new(n||l)};static \u0275cmp=R({type:l,selectors:[["app-analytics"]],viewQuery:function(n,e){if(n&1&&(d(gt,5),d(Ct,5),d(yt,5),d(vt,5)),n&2){let r;p(r=f())&&(e.jobTrendsChartRef=r.first),p(r=f())&&(e.deliveryPerformanceChartRef=r.first),p(r=f())&&(e.driverPerformanceChartRef=r.first),p(r=f())&&(e.vehicleUtilizationChartRef=r.first)}},decls:21,vars:4,consts:[["startPicker",""],["endPicker",""],["jobTrendsChart",""],["deliveryPerformanceChart",""],["driverPerformanceChart",""],["vehicleUtilizationChart",""],[1,"analytics-container"],[1,"page-title"],[1,"filter-card"],[1,"filter-form",3,"formGroup"],["appearance","outline"],["formControlName","dateRange",3,"selectionChange"],["value","last7days"],["value","last30days"],["value","lastQuarter"],["value","custom"],[4,"ngIf"],["class","loading-container",4,"ngIf"],["class","analytics-content",4,"ngIf"],["matInput","","formControlName","startDate",3,"matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","endDate",3,"matDatepicker"],["mat-raised-button","","color","primary",3,"click"],[1,"loading-container"],["diameter","50"],[1,"analytics-content"],[1,"chart-card"],[1,"chart-container"]],template:function(n,e){if(n&1&&(i(0,"div",6)(1,"h1",7),o(2,"Analytics Dashboard"),a(),i(3,"mat-card",8)(4,"mat-card-content")(5,"form",9)(6,"mat-form-field",10)(7,"mat-label"),o(8,"Date Range"),a(),i(9,"mat-select",11),b("selectionChange",function(){return e.onDateRangeChange()}),i(10,"mat-option",12),o(11,"Last 7 Days"),a(),i(12,"mat-option",13),o(13,"Last 30 Days"),a(),i(14,"mat-option",14),o(15,"Last Quarter"),a(),i(16,"mat-option",15),o(17,"Custom Range"),a()()(),D(18,Dt,17,4,"ng-container",16),a()()(),D(19,bt,2,0,"div",17)(20,Mt,41,0,"div",18),a()),n&2){let r;s(5),c("formGroup",e.filterForm),s(13),c("ngIf",((r=e.filterForm.get("dateRange"))==null?null:r.value)==="custom"),s(),c("ngIf",e.loading),s(),c("ngIf",!e.loading)}},dependencies:[T,O,W,L,G,q,H,U,at,et,nt,rt,it,ct,K,Z,$,st,lt,X,ht,dt,pt,ft,mt,tt,Y,J,Q,I,V,z,B,j],styles:[".analytics-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin-bottom:24px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.filter-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;gap:16px}.filter-form[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{min-width:200px}.analytics-content[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(500px,1fr));gap:24px}@media (max-width: 768px){.analytics-content[_ngcontent-%COMP%]{grid-template-columns:1fr}}.chart-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a;height:100%}.chart-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.chart-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:4px}.chart-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.chart-card[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{height:300px;position:relative}"]})};export{ut as AnalyticsComponent};
