import{b as he}from"./chunk-ESJIWLK4.js";import{b as ce,c as de}from"./chunk-LDLE5TDT.js";import{a as pe}from"./chunk-FL7UC7QU.js";import{a as ee,b as te,c as ne,d as oe,f as re,h as ae}from"./chunk-OFY7VGJP.js";import{b as ie,c as me,i as le}from"./chunk-P7ITNQJW.js";import{a as ye,b as ge}from"./chunk-HDC6EVXZ.js";import{b as Ce}from"./chunk-Q2NIOR5G.js";import{E as se,H as fe,I as ue,J as _e,b as K,d as f,g as $,h as H,i as L,l as J,o as Q,q as W,u as X,w as Y}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as A,c as G,g as R}from"./chunk-4PPYA6ZN.js";import{ea as M,ga as V,j as B,ja as j,ka as z,ma as E,o as D,oa as U,wa as Z}from"./chunk-3O2P3FIP.js";import{Cb as m,Lb as o,Mb as e,Nb as s,Rb as k,Vb as x,Wb as _,db as i,fc as r,ga as u,hc as v,pa as C,pb as q,qa as h,vb as d}from"./chunk-NXWLSP6D.js";import{a as N,b as T,g}from"./chunk-RA2WU32H.js";function ve(t,n){t&1&&(o(0,"div",5),s(1,"mat-spinner",6),e())}function Me(t,n){t&1&&(o(0,"mat-error"),r(1," Company name is required "),e())}function Ee(t,n){t&1&&(o(0,"mat-error"),r(1," Contact name is required "),e())}function Fe(t,n){t&1&&(o(0,"mat-error"),r(1," Phone number is required "),e())}function be(t,n){t&1&&(o(0,"mat-error"),r(1," Please enter a valid UK phone number "),e())}function Ie(t,n){t&1&&(o(0,"mat-error"),r(1," Email is required "),e())}function Se(t,n){t&1&&(o(0,"mat-error"),r(1," Please enter a valid email address "),e())}function Pe(t,n){t&1&&(o(0,"mat-card-subtitle"),r(1," Additional addresses can be managed through the Manage Addresses page "),e())}function Oe(t,n){t&1&&(o(0,"mat-error"),r(1," Street address is required "),e())}function we(t,n){t&1&&(o(0,"mat-error"),r(1," City is required "),e())}function Ne(t,n){t&1&&(o(0,"mat-error"),r(1," Postcode is required "),e())}function Te(t,n){t&1&&(o(0,"mat-error"),r(1," Please enter a valid UK postcode "),e())}function qe(t,n){t&1&&(o(0,"mat-error"),r(1," Country is required "),e())}function ke(t,n){t&1&&s(0,"mat-spinner",26)}function Be(t,n){if(t&1&&(o(0,"span")(1,"mat-icon"),r(2,"save"),e(),r(3),e()),t&2){let a=_(2);i(3),v(" ",a.isEditMode?"Update":"Create"," Company ")}}function De(t,n){if(t&1){let a=k();o(0,"form",7),x("ngSubmit",function(){C(a);let l=_();return h(l.onSubmit())}),o(1,"mat-card",8)(2,"mat-card-header")(3,"mat-card-title"),r(4,"Company Information"),e()(),o(5,"mat-card-content")(6,"div",9)(7,"mat-form-field",10)(8,"mat-label"),r(9,"Company Name"),e(),s(10,"input",11),d(11,Me,2,0,"mat-error",12),e(),o(12,"mat-form-field",10)(13,"mat-label"),r(14,"Contact Name"),e(),s(15,"input",13),d(16,Ee,2,0,"mat-error",12),e()(),o(17,"div",9)(18,"mat-form-field",10)(19,"mat-label"),r(20,"Phone"),e(),s(21,"input",14),d(22,Fe,2,0,"mat-error",12)(23,be,2,0,"mat-error",12),e(),o(24,"mat-form-field",10)(25,"mat-label"),r(26,"Email"),e(),s(27,"input",15),d(28,Ie,2,0,"mat-error",12)(29,Se,2,0,"mat-error",12),e()()()(),o(30,"mat-card",8)(31,"mat-card-header")(32,"mat-card-title"),r(33,"Primary Address"),e(),d(34,Pe,2,0,"mat-card-subtitle",12),e(),o(35,"mat-card-content")(36,"div",16)(37,"mat-form-field",10)(38,"mat-label"),r(39,"Street Address"),e(),s(40,"input",17),d(41,Oe,2,0,"mat-error",12),e()(),o(42,"div",9)(43,"mat-form-field",10)(44,"mat-label"),r(45,"City"),e(),s(46,"input",18),d(47,we,2,0,"mat-error",12),e(),o(48,"mat-form-field",10)(49,"mat-label"),r(50,"State/County"),e(),s(51,"input",19),e()(),o(52,"div",9)(53,"mat-form-field",10)(54,"mat-label"),r(55,"Postcode"),e(),s(56,"input",20),d(57,Ne,2,0,"mat-error",12)(58,Te,2,0,"mat-error",12),e(),o(59,"mat-form-field",10)(60,"mat-label"),r(61,"Country"),e(),s(62,"input",21),d(63,qe,2,0,"mat-error",12),e()()()(),o(64,"div",22)(65,"button",23),x("click",function(){C(a);let l=_();return h(l.onCancel())}),o(66,"mat-icon"),r(67,"cancel"),e(),r(68," Cancel "),e(),o(69,"button",24),d(70,ke,1,0,"mat-spinner",25)(71,Be,4,1,"span",12),e()()()}if(t&2){let a,c,l,y,F,b,I,S,P,O,w,p=_();m("formGroup",p.companyForm),i(11),m("ngIf",(a=p.companyForm.get("companyName"))==null?null:a.hasError("required")),i(5),m("ngIf",(c=p.companyForm.get("name"))==null?null:c.hasError("required")),i(6),m("ngIf",(l=p.companyForm.get("phone"))==null?null:l.hasError("required")),i(),m("ngIf",(y=p.companyForm.get("phone"))==null?null:y.hasError("pattern")),i(5),m("ngIf",(F=p.companyForm.get("email"))==null?null:F.hasError("required")),i(),m("ngIf",(b=p.companyForm.get("email"))==null?null:b.hasError("email")),i(5),m("ngIf",p.isEditMode),i(7),m("ngIf",(I=p.companyForm.get("street"))==null?null:I.hasError("required")),i(6),m("ngIf",(S=p.companyForm.get("city"))==null?null:S.hasError("required")),i(10),m("ngIf",(P=p.companyForm.get("postcode"))==null?null:P.hasError("required")),i(),m("ngIf",(O=p.companyForm.get("postcode"))==null?null:O.hasError("pattern")),i(5),m("ngIf",(w=p.companyForm.get("country"))==null?null:w.hasError("required")),i(6),m("disabled",p.saving),i(),m("ngIf",p.saving),i(),m("ngIf",!p.saving)}}var xe=class t{firestore=u(V);formBuilder=u(X);route=u(A);router=u(G);snackBar=u(Ce);companyForm;companyId=null;isEditMode=!1;loading=!1;saving=!1;ngOnInit(){this.initForm(),this.route.paramMap.subscribe(n=>{this.companyId=n.get("id"),this.companyId?(this.isEditMode=!0,this.loadCompanyData(this.companyId)):this.loading=!1})}initForm(){this.companyForm=this.formBuilder.group({name:["",f.required],companyName:["",f.required],street:["",f.required],city:["",f.required],state:[""],country:["",f.required],postcode:["",[f.required,f.pattern(/^([A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2})$/)]],phone:["",[f.required,f.pattern(/^(\+44|0)\d{10}$/)]],email:["",[f.required,f.email]]})}loadCompanyData(n){return g(this,null,function*(){this.loading=!0;try{let a=E(this.firestore,"Companies",n),c=yield U(a);if(c.exists()){let l=c.data();this.companyForm.patchValue({name:l.name||"",companyName:l.companyName||"",street:l.street||"",city:l.city||"",state:l.state||"",country:l.country||"",postcode:l.postcode||"",phone:l.phone||"",email:l.email||""}),this.loading=!1}else this.snackBar.open("Company not found.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/companies"])}catch(a){console.error("Error loading company data:",a),this.snackBar.open("Error loading company data. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}onSubmit(){return g(this,null,function*(){if(this.companyForm.invalid){this.markFormGroupTouched(this.companyForm),this.snackBar.open("Please fix the validation errors before submitting.","Close",{duration:5e3,panelClass:["warning-snackbar"]});return}this.saving=!0;try{let n=this.companyForm.value,a={name:n.name,companyName:n.companyName,street:n.street,city:n.city,state:n.state,country:n.country,postcode:n.postcode,phone:n.phone,email:n.email,updatedAt:M.now()};if(this.isEditMode&&this.companyId){let c=E(this.firestore,"Companies",this.companyId);yield Z(c,a),this.snackBar.open("Company updated successfully.","Close",{duration:3e3})}else{let c=z(this.firestore,"Companies"),l=T(N({},a),{createdAt:M.now()}),y=yield j(c,l);this.snackBar.open("Company created successfully.","Close",{duration:3e3}),this.router.navigate(["/companies/edit",y.id])}this.saving=!1}catch(n){console.error("Error saving company:",n),this.snackBar.open("Error saving company. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.saving=!1}})}markFormGroupTouched(n){Object.values(n.controls).forEach(a=>{a.markAsTouched(),a instanceof L&&this.markFormGroupTouched(a)})}onCancel(){this.router.navigate(["/companies"])}static \u0275fac=function(a){return new(a||t)};static \u0275cmp=q({type:t,selectors:[["app-company-form"]],decls:6,vars:3,consts:[[1,"company-form-container"],[1,"page-header"],[1,"page-title"],["class","loading-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],["diameter","50"],[3,"ngSubmit","formGroup"],[1,"form-card"],[1,"form-row","row-split"],["appearance","outline"],["matInput","","formControlName","companyName"],[4,"ngIf"],["matInput","","formControlName","name"],["matInput","","formControlName","phone","placeholder","e.g. 07700900000"],["matInput","","formControlName","email","type","email"],[1,"form-row"],["matInput","","formControlName","street"],["matInput","","formControlName","city"],["matInput","","formControlName","state"],["matInput","","formControlName","postcode"],["matInput","","formControlName","country"],[1,"form-actions"],["type","button","mat-stroked-button","",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["diameter","20",4,"ngIf"],["diameter","20"]],template:function(a,c){a&1&&(o(0,"div",0)(1,"div",1)(2,"h1",2),r(3),e()(),d(4,ve,2,0,"div",3)(5,De,72,16,"form",4),e()),a&2&&(i(3),v(" ",c.isEditMode?"Edit Company":"Create Company"," "),i(),m("ngIf",c.loading),i(),m("ngIf",!c.loading))},dependencies:[D,B,Y,J,K,$,H,Q,W,R,ae,ee,ne,re,oe,te,pe,le,ie,me,de,ce,fe,se,_e,ue,ge,ye,he],styles:[".company-form-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.form-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:8px}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.form-row[_ngcontent-%COMP%]{margin-bottom:16px;width:100%}.form-row.row-split[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row.row-split[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{flex:1}@media (max-width: 768px){.form-row.row-split[_ngcontent-%COMP%]{flex-direction:column;gap:0}}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px;margin-bottom:40px}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}button[color=primary][_ngcontent-%COMP%]{background-color:#c19a6b}"]})};export{xe as CompanyFormComponent};
