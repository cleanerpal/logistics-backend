import{a as le}from"./chunk-3LXRQY3K.js";import"./chunk-MS4AQ6UA.js";import{b as Q,c as X}from"./chunk-LDLE5TDT.js";import{a as me,b as se}from"./chunk-DJMXPRNS.js";import{d as ae}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as K}from"./chunk-FL7UC7QU.js";import"./chunk-DQFV6XNM.js";import{a as $,c as j,h as R}from"./chunk-OFY7VGJP.js";import{b as z,c as H,d as W,i as J}from"./chunk-P7ITNQJW.js";import{a as re,b as ie}from"./chunk-HDC6EVXZ.js";import{b as ne,c as oe}from"./chunk-Q2NIOR5G.js";import{E as Y,H as Z,I as ee,J as te,b as w,d as p,g as D,h as B,l as A,o as V,q as L,u as G,w as q}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as T}from"./chunk-M4BJXN77.js";import{a as k,c as N}from"./chunk-4PPYA6ZN.js";import{i as P,j as E,o as U}from"./chunk-3O2P3FIP.js";import{Cb as m,Lb as n,Mb as r,Nb as f,Rb as S,Vb as _,Wb as v,X as g,db as a,f as y,fc as o,gc as I,hc as h,ib as u,pa as b,pb as O,qa as x,vb as c}from"./chunk-NXWLSP6D.js";import"./chunk-RA2WU32H.js";function de(i,t){i&1&&(n(0,"div",6),f(1,"mat-spinner",7),r())}function ue(i,t){i&1&&(n(0,"mat-error"),o(1," Name is required "),r())}function pe(i,t){i&1&&(n(0,"mat-error"),o(1," Email is required "),r())}function fe(i,t){i&1&&(n(0,"mat-error"),o(1," Please enter a valid email address "),r())}function ge(i,t){if(i&1&&(n(0,"mat-option",21),o(1),r()),i&2){let e=t.$implicit;m("value",e.value),a(),h(" ",e.label," ")}}function _e(i,t){i&1&&(n(0,"mat-error"),o(1," Role is required "),r())}function ve(i,t){if(i&1&&(n(0,"mat-option",21),o(1),r()),i&2){let e=t.$implicit;m("value",e.value),a(),h(" ",e.label," ")}}function he(i,t){i&1&&(n(0,"mat-error"),o(1," Team is required for drivers "),r())}function Ce(i,t){i&1&&(n(0,"div",9)(1,"mat-form-field",10)(2,"mat-label"),o(3,"Driver ID"),r(),f(4,"input",22),n(5,"mat-hint"),o(6,"Driver ID is auto-generated"),r()()())}function Me(i,t){i&1&&(n(0,"mat-icon"),f(1,"mat-spinner",23),r())}function be(i,t){if(i&1){let e=S();n(0,"form",8),_("ngSubmit",function(){b(e);let d=v();return x(d.onSubmit())}),n(1,"div",9)(2,"mat-form-field",10)(3,"mat-label"),o(4,"Display Name"),r(),f(5,"input",11),c(6,ue,2,0,"mat-error",12),r()(),n(7,"div",9)(8,"mat-form-field",10)(9,"mat-label"),o(10,"Email Address"),r(),f(11,"input",13),c(12,pe,2,0,"mat-error",12)(13,fe,2,0,"mat-error",12),r()(),n(14,"div",9)(15,"mat-form-field",10)(16,"mat-label"),o(17,"Role"),r(),n(18,"mat-select",14),c(19,ge,2,2,"mat-option",15),r(),c(20,_e,2,0,"mat-error",12),r()(),n(21,"div",9)(22,"mat-form-field",10)(23,"mat-label"),o(24,"Team"),r(),n(25,"mat-select",16),c(26,ve,2,2,"mat-option",15),r(),c(27,he,2,0,"mat-error",12),r()(),c(28,Ce,7,0,"div",17),n(29,"div",18)(30,"button",19),_("click",function(){b(e);let d=v();return x(d.cancelEdit())}),o(31," Cancel "),r(),n(32,"button",20),c(33,Me,2,0,"mat-icon",12),n(34,"span"),o(35),r()()()()}if(i&2){let e,l,d,C,M,F,s=v();m("formGroup",s.userForm),a(6),m("ngIf",(e=s.userForm.get("displayName"))==null?null:e.hasError("required")),a(6),m("ngIf",(l=s.userForm.get("email"))==null?null:l.hasError("required")),a(),m("ngIf",(d=s.userForm.get("email"))==null?null:d.hasError("email")),a(6),m("ngForOf",s.roles),a(),m("ngIf",(C=s.userForm.get("role"))==null?null:C.hasError("required")),a(6),m("ngForOf",s.teams),a(),m("ngIf",(M=s.userForm.get("team"))==null?null:M.hasError("required")),a(),m("ngIf",((F=s.userForm.get("role"))==null?null:F.value)==="Driver"),a(4),m("disabled",s.userForm.invalid||s.isSaving),a(),m("ngIf",s.isSaving),a(2),h("",s.isEditMode?"Update":"Create"," User")}}var ce=class i{constructor(t,e,l,d,C,M){this.fb=t;this.route=e;this.router=l;this.firebaseService=d;this.auditLogsService=C;this.snackBar=M;this.userForm=this.createForm()}userForm;isEditMode=!1;userId;isLoading=!1;isSaving=!1;roles=[{value:"SuperAdmin",label:"Super Admin"},{value:"Admin",label:"Admin"},{value:"Driver",label:"Driver"}];teams=[{value:"Belfast",label:"Belfast Team"},{value:"Derry",label:"Derry Team"},{value:"Newry",label:"Newry Team"},{value:"Lisburn",label:"Lisburn Team"},{value:"Ballymena",label:"Ballymena Team"}];destroy$=new y;ngOnInit(){this.route.params.pipe(g(this.destroy$)).subscribe(t=>{t.id&&(this.isEditMode=!0,this.userId=t.id,this.userId&&this.loadUserData(this.userId))}),this.userForm.get("role")?.valueChanges.pipe(g(this.destroy$)).subscribe(t=>{t==="Driver"?(this.userForm.get("driverId")?.enable(),this.userForm.get("team")?.setValidators([p.required])):(this.userForm.get("driverId")?.disable(),this.userForm.get("team")?.clearValidators()),this.userForm.get("team")?.updateValueAndValidity()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}createForm(){return this.fb.group({displayName:["",[p.required]],email:["",[p.required,p.email]],role:["",[p.required]],team:[""],driverId:[{value:this.generateDriverId(),disabled:!0}]})}loadUserData(t){this.isLoading=!0,this.firebaseService.getDocumentWithSnapshot("users",t).pipe(g(this.destroy$)).subscribe({next:e=>{e?(this.userForm.patchValue({displayName:e.displayName||"",email:e.email||"",role:e.role||"",team:e.team||"",driverId:e.driverId||this.generateDriverId()}),e.role==="Driver"&&(this.userForm.get("driverId")?.enable(),this.userForm.get("team")?.setValidators([p.required]),this.userForm.get("team")?.updateValueAndValidity())):(this.snackBar.open("User not found","Close",{duration:3e3}),this.router.navigate(["/users"])),this.isLoading=!1},error:e=>{console.error("Error loading user data:",e),this.snackBar.open("Error loading user data","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isLoading=!1,this.router.navigate(["/users"])}})}generateDriverId(){return`DRV-${Math.floor(1e4+Math.random()*9e4)}`}onSubmit(){if(this.userForm.invalid){this.markFormGroupTouched(this.userForm);return}this.isSaving=!0;let t=this.prepareUserData();this.isEditMode&&this.userId?this.updateUser(this.userId,t):this.createUser(t)}prepareUserData(){let t=this.userForm.value,e={displayName:t.displayName,email:t.email,role:t.role};return t.team&&(e.team=t.team),t.role==="Driver"&&(e.driverId=this.userForm.get("driverId")?.value||this.generateDriverId()),e}createUser(t){this.firebaseService.addDocument("users",t).then(e=>{this.auditLogsService.createAuditLog({action:"CREATE",resource:"users",resourceId:e,details:`Created user: ${t.displayName} (${t.email})`,userName:t.displayName,userId:e}),this.snackBar.open("User created successfully","Close",{duration:3e3}),this.router.navigate(["/users"])}).catch(e=>{console.error("Error creating user:",e),this.snackBar.open("Error creating user","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isSaving=!1})}updateUser(t,e){this.firebaseService.updateDocument("users",t,e).then(()=>{this.auditLogsService.createAuditLog({action:"UPDATE",resource:"users",resourceId:t,details:`Updated user: ${e.displayName} (${e.email})`,userName:e.displayName,userId:t}),this.snackBar.open("User updated successfully","Close",{duration:3e3}),this.router.navigate(["/users"])}).catch(l=>{console.error("Error updating user:",l),this.snackBar.open("Error updating user","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.isSaving=!1})}cancelEdit(){this.router.navigate(["/users"])}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e.markAsTouched(),e.controls&&this.markFormGroupTouched(e)})}static \u0275fac=function(e){return new(e||i)(u(G),u(k),u(N),u(T),u(le),u(ne))};static \u0275cmp=O({type:i,selectors:[["app-user-form"]],decls:12,vars:3,consts:[[1,"user-form-container"],[1,"page-header"],[1,"header-title"],["mat-button","","color","accent",1,"back-button",3,"click"],["class","loading-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],["diameter","50"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","formControlName","displayName","placeholder","Enter user's full name"],[4,"ngIf"],["matInput","","formControlName","email","placeholder","Enter user's email","type","email"],["formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["formControlName","team"],["class","form-row",4,"ngIf"],[1,"form-actions"],["mat-button","","type","button",3,"click"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"],["matInput","","formControlName","driverId","readonly",""],["diameter","20","color","accent"]],template:function(e,l){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3),r(),n(4,"button",3),_("click",function(){return l.cancelEdit()}),n(5,"mat-icon"),o(6,"arrow_back"),r(),o(7," Back to Users "),r()(),n(8,"mat-card")(9,"mat-card-content"),c(10,de,2,0,"div",4)(11,be,36,12,"form",5),r()()()),e&2&&(a(3),I(l.isEditMode?"Edit User":"Create User"),a(7),m("ngIf",l.isLoading),a(),m("ngIf",!l.isLoading))},dependencies:[U,P,E,q,A,w,D,B,V,L,K,J,z,W,H,X,Q,se,me,ae,Z,Y,R,$,j,te,ee,ie,re,oe],styles:[".user-form-container[_ngcontent-%COMP%]{padding:24px;background-color:#f5f5f5;min-height:calc(100vh - 64px)}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .header-title[_ngcontent-%COMP%]{font-size:28px;font-weight:500;color:#4a3c31;margin:0}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{color:#4a3c31}.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.user-form-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a}.user-form-container[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:16px;position:relative;min-height:300px}.user-form-container[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background-color:#ffffffb3;z-index:1}.user-form-container[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]   mat-spinner[_ngcontent-%COMP%]     circle{stroke:#c19a6b}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px;max-width:800px;margin:0 auto}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:16px}@media (max-width: 768px){.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column}}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[color=primary][_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}  .mat-mdc-form-field-appearance-outline .mat-mdc-form-field-outline{color:#9e9e9e}  .mat-mdc-form-field-appearance-outline.mat-focused .mat-mdc-form-field-outline{color:#c19a6b}  .mat-mdc-form-field-appearance-outline.mat-form-field-invalid .mat-mdc-form-field-outline{color:#b00020}  .mat-mdc-progress-spinner.mat-accent circle{stroke:#fff}  .error-snackbar{background-color:#b00020;color:#fff}@media (max-width: 992px){.user-form-container[_ngcontent-%COMP%]{padding:16px}}@media (max-width: 576px){.user-form-container[_ngcontent-%COMP%]   .page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.user-form-container[_ngcontent-%COMP%]   form[_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};export{ce as UserFormComponent};
