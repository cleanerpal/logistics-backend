import{a as Ke,b as Xe}from"./chunk-IDK22FN7.js";import{c as Ue,h as We}from"./chunk-RDAIYJSK.js";import{b as Ye}from"./chunk-ESJIWLK4.js";import{a as Ze}from"./chunk-IWKF2V5Q.js";import"./chunk-F5X5MWHG.js";import{a as k,b as ye}from"./chunk-VWFB2ZCV.js";import{a as Me,b as Se}from"./chunk-6ZM5HFJH.js";import{c as Ce}from"./chunk-4TDDZIB3.js";import{a as He,d as Ge,e as Le,f as Qe,g as ze,h as qe,i as Je}from"./chunk-PQIIHW7R.js";import"./chunk-GW6WOXIL.js";import"./chunk-MS4AQ6UA.js";import{b as ce,c as me}from"./chunk-LDLE5TDT.js";import{a as Ee,b as be}from"./chunk-DJMXPRNS.js";import{d as ve}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as le}from"./chunk-FL7UC7QU.js";import{a as P,b as we,c as Te}from"./chunk-RGR4672A.js";import{a as ke,b as Pe,c as De,d as Oe,e as Fe,f as Re,g as Ie,h as Ve,i as Ne,j as Be,k as je,l as Ae,m as $e}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as ne,c as ie,h as ae}from"./chunk-OFY7VGJP.js";import{b as re,f as oe,i as se}from"./chunk-P7ITNQJW.js";import{a as _e,b as ge}from"./chunk-HDC6EVXZ.js";import{b as he}from"./chunk-Q2NIOR5G.js";import{C as pe,E as de,H as ue,I as fe,J as xe,b as J,g as U,h as W,l as K,o as X,p as Y,q as Z,u as ee,w as te}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{c as $}from"./chunk-4PPYA6ZN.js";import{ea as w,ga as H,i as B,ia as G,j,ka as L,la as Q,ma as S,o as A,ta as z,ua as q,wa as T}from"./chunk-3O2P3FIP.js";import{$b as D,Cb as m,Db as I,Lb as a,Mb as r,Nb as E,Ob as g,Pb as h,Rb as C,Vb as _,Wb as d,ac as O,bc as F,db as c,ec as V,fc as s,gc as y,hc as M,ib as v,pa as f,pb as R,pc as N,qa as x,vb as p}from"./chunk-NXWLSP6D.js";import{g as b}from"./chunk-RA2WU32H.js";var tt=()=>[10,25,50];function nt(n,e){if(n&1){let t=C();a(0,"button",27),_("click",function(){let o;f(t);let l=d();return x((o=l.searchForm.get("searchText"))==null?null:o.setValue(""))}),a(1,"mat-icon"),s(2,"close"),r()()}}function it(n,e){if(n&1&&(a(0,"mat-option",28),s(1),r()),n&2){let t=e.$implicit;m("value",t),c(),M(" ",t," ")}}function at(n,e){n&1&&(a(0,"div",29),E(1,"mat-spinner",30),r())}function rt(n,e){n&1&&(a(0,"th",49),s(1,"Expense ID"),r())}function ot(n,e){if(n&1&&(a(0,"td",50),s(1),r()),n&2){let t=e.$implicit;c(),y(t.id)}}function st(n,e){n&1&&(a(0,"th",49),s(1,"Driver"),r())}function lt(n,e){if(n&1&&(a(0,"td",50),s(1),r()),n&2){let t=e.$implicit;c(),y(t.driverName)}}function ct(n,e){n&1&&(a(0,"th",49),s(1,"Type"),r())}function mt(n,e){if(n&1&&(a(0,"td",50)(1,"span",51),s(2),r()()),n&2){let t=e.$implicit;c(2),y(t.type)}}function pt(n,e){n&1&&(a(0,"th",49),s(1,"Amount"),r())}function dt(n,e){if(n&1&&(a(0,"td",52),s(1),r()),n&2){let t=e.$implicit,i=d(2);c(),M(" ",i.formatAmount(t.amount)," ")}}function ut(n,e){n&1&&(a(0,"th",49),s(1,"Date"),r())}function ft(n,e){if(n&1&&(a(0,"td",50),s(1),r()),n&2){let t=e.$implicit,i=d(2);c(),M(" ",i.formatDate(t.date)," ")}}function xt(n,e){n&1&&(a(0,"th",49),s(1,"Status"),r())}function _t(n,e){if(n&1&&(a(0,"td",50)(1,"span",53),s(2),r()()),n&2){let t=e.$implicit,i=d(2);c(),I("background-color",i.getStatusColor(t.status)),c(),M(" ",t.status," ")}}function gt(n,e){n&1&&(a(0,"th",49),s(1,"Chargeable"),r())}function ht(n,e){if(n&1){let t=C();a(0,"td",50)(1,"mat-slide-toggle",54),_("change",function(o){let l=f(t).$implicit,u=d(2);return x(u.toggleChargeable(l.id,l.chargeable,o))})("click",function(o){return f(t),x(o.stopPropagation())}),r()()}if(n&2){let t=e.$implicit;c(),m("checked",t.chargeable)("disabled",t.status==="Rejected")}}function Ct(n,e){n&1&&(a(0,"th",55),s(1,"Actions"),r())}function vt(n,e){if(n&1){let t=C();a(0,"button",61),_("click",function(o){f(t);let l=d().$implicit,u=d(2);return x(u.approveExpense(l.id,o))}),a(1,"mat-icon"),s(2,"check_circle"),r()()}}function Et(n,e){if(n&1){let t=C();a(0,"button",62),_("click",function(o){f(t);let l=d().$implicit,u=d(2);return x(u.rejectExpense(l.id,o))}),a(1,"mat-icon"),s(2,"cancel"),r()()}}function bt(n,e){if(n&1){let t=C();a(0,"td",50)(1,"div",56)(2,"button",57),_("click",function(){let o=f(t).$implicit,l=d(2);return x(l.viewExpenseDetails(o.id))}),a(3,"mat-icon"),s(4,"visibility"),r()(),p(5,vt,3,0,"button",58)(6,Et,3,0,"button",59),a(7,"button",60),_("click",function(o){let l=f(t).$implicit;return d(2).confirmDelete(l.id),x(o.stopPropagation())}),a(8,"mat-icon"),s(9,"delete"),r()()()()}if(n&2){let t=e.$implicit;c(5),m("ngIf",t.status==="Pending"),c(),m("ngIf",t.status==="Pending")}}function Mt(n,e){n&1&&E(0,"tr",63)}function St(n,e){if(n&1){let t=C();a(0,"tr",64),_("click",function(){let o=f(t).$implicit,l=d(2);return x(l.viewExpenseDetails(o.id))}),r()}}function yt(n,e){n&1&&(a(0,"tr",65)(1,"td",66),s(2," No expenses found matching the current filters "),r()())}function wt(n,e){if(n&1&&(a(0,"div",31)(1,"table",32),g(2,33),p(3,rt,2,0,"th",34)(4,ot,2,1,"td",35),h(),g(5,36),p(6,st,2,0,"th",34)(7,lt,2,1,"td",35),h(),g(8,37),p(9,ct,2,0,"th",34)(10,mt,3,1,"td",35),h(),g(11,38),p(12,pt,2,0,"th",34)(13,dt,2,1,"td",39),h(),g(14,40),p(15,ut,2,0,"th",34)(16,ft,2,1,"td",35),h(),g(17,41),p(18,xt,2,0,"th",34)(19,_t,3,3,"td",35),h(),g(20,42),p(21,gt,2,0,"th",34)(22,ht,2,2,"td",35),h(),g(23,43),p(24,Ct,2,0,"th",44)(25,bt,10,2,"td",35),h(),p(26,Mt,1,0,"tr",45)(27,St,1,0,"tr",46)(28,yt,3,0,"tr",47),r(),E(29,"mat-paginator",48),r()),n&2){let t=d();c(),m("dataSource",t.dataSource),c(25),m("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),c(),m("matRowDefColumns",t.displayedColumns),c(2),m("pageSizeOptions",N(6,tt))("pageSize",50)}}var et=class n{constructor(e,t,i,o,l,u){this.firestore=e;this.storage=t;this.formBuilder=i;this.router=o;this.dialog=l;this.snackBar=u;this.searchForm=this.formBuilder.group({searchText:[""],dateRange:this.formBuilder.group({start:[null],end:[null]}),expenseType:[""]})}expenses=[];dataSource=new $e;displayedColumns=["id","driverName","type","amount","date","status","chargeable","actions"];searchForm;loading=!0;expensesSubscription;paginator;sort;expenseTypes=["Fuel","Toll","Car Wash","Vacuum","Other"];ngOnInit(){this.loadExpenses(),this.searchForm.valueChanges.subscribe(()=>{this.applyFilters()})}ngOnDestroy(){this.expensesSubscription&&this.expensesSubscription.unsubscribe()}loadExpenses(){this.loading=!0;try{let e=L(this.firestore,"Expenses"),t=q(e,z("date","desc"));this.expensesSubscription=G(t,{idField:"id"}).subscribe({next:i=>{this.expenses=i,this.dataSource.data=this.expenses,setTimeout(()=>{this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=this.createFilterPredicate()}),this.loading=!1},error:i=>{console.error("Error loading expenses:",i),this.snackBar.open("Error loading expenses. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}catch(e){console.error("Error setting up expenses subscription:",e),this.loading=!1}}createFilterPredicate(){return(e,t)=>{let i=JSON.parse(t);if(i.searchText){let o=i.searchText.toLowerCase();if(!e.driverName.toLowerCase().includes(o)&&!e.type.toLowerCase().includes(o)&&!e.id.toString().includes(o))return!1}if(i.expenseType&&e.type!==i.expenseType)return!1;if(i.dateRange.start&&i.dateRange.end){let o=new Date(i.dateRange.start),l=new Date(i.dateRange.end);l.setHours(23,59,59,999);let u=e.date.toDate();if(u<o||u>l)return!1}return!0}}applyFilters(){let e={searchText:this.searchForm.get("searchText")?.value,dateRange:this.searchForm.get("dateRange")?.value,expenseType:this.searchForm.get("expenseType")?.value};this.dataSource.filter=JSON.stringify(e),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}resetFilters(){this.searchForm.reset({searchText:"",dateRange:{start:null,end:null},expenseType:""})}viewExpenseDetails(e){this.router.navigate(["/expenses",e])}createExpense(){this.router.navigate(["/expenses/create"])}confirmDelete(e){confirm("Are you sure you want to delete this expense?")&&this.deleteExpense(e)}deleteExpense(e){return b(this,null,function*(){try{let t=S(this.firestore,"Expenses",e);yield Q(t),this.snackBar.open("Expense deleted successfully","Close",{duration:3e3})}catch(t){console.error("Error deleting expense:",t),this.snackBar.open("Error deleting expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}approveExpense(e,t){return b(this,null,function*(){t.stopPropagation();try{let i=S(this.firestore,"Expenses",e);yield T(i,{status:"Approved",updatedAt:w.now()}),this.snackBar.open("Expense approved","Close",{duration:3e3})}catch(i){console.error("Error approving expense:",i),this.snackBar.open("Error approving expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}rejectExpense(e,t){return b(this,null,function*(){t.stopPropagation();try{let i=S(this.firestore,"Expenses",e);yield T(i,{status:"Rejected",updatedAt:w.now()}),this.snackBar.open("Expense rejected","Close",{duration:3e3})}catch(i){console.error("Error rejecting expense:",i),this.snackBar.open("Error rejecting expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}toggleChargeable(e,t,i){return b(this,null,function*(){try{let o=S(this.firestore,"Expenses",e);yield T(o,{chargeable:!t,updatedAt:w.now()}),this.snackBar.open(`Expense marked as ${t?"non-chargeable":"chargeable"}`,"Close",{duration:3e3})}catch(o){console.error("Error toggling chargeable status:",o),this.snackBar.open("Error updating status. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}formatDate(e){return e?e.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A"}getStatusColor(e){switch(e){case"Approved":return"#4CAF50";case"Rejected":return"#F44336";case"Pending":return"#FFC107";default:return"#9E9E9E"}}formatAmount(e){return`\xA3${e.toFixed(2)}`}static \u0275fac=function(t){return new(t||n)(v(H),v(Ze),v(ee),v($),v(Ue),v(he))};static \u0275cmp=R({type:n,selectors:[["app-expenses"]],viewQuery:function(t,i){if(t&1&&(D(k,5),D(P,5)),t&2){let o;O(o=F())&&(i.paginator=o.first),O(o=F())&&(i.sort=o.first)}},decls:45,vars:8,consts:[["rangePicker",""],[1,"expenses-container"],[1,"page-header"],[1,"page-title"],[1,"header-actions"],["mat-raised-button","","color","primary",1,"create-button",3,"click"],[1,"filter-card"],[1,"filter-form",3,"formGroup"],[1,"search-container"],["appearance","outline"],["matInput","","formControlName","searchText","placeholder","Search by driver name, expense type..."],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["matSuffix",""],[1,"type-container"],["formControlName","expenseType"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formGroupName","dateRange",1,"date-container"],["appearance","outline",1,"date-field"],[3,"rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matIconSuffix","",3,"for"],[1,"filter-actions"],["mat-stroked-button","","color","primary",1,"reset-button",3,"click","disabled"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[3,"value"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"expenses-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","driverName"],["matColumnDef","type"],["matColumnDef","amount"],["mat-cell","","class","amount-cell",4,"matCellDef"],["matColumnDef","date"],["matColumnDef","status"],["matColumnDef","chargeable"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","expense-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of expenses",3,"pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"expense-type"],["mat-cell","",1,"amount-cell"],[1,"status-badge"],["color","primary",3,"change","click","checked","disabled"],["mat-header-cell",""],[1,"action-buttons"],["mat-icon-button","","color","primary","matTooltip","View details",3,"click"],["mat-icon-button","","color","accent","matTooltip","Approve",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Reject",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],["mat-icon-button","","color","accent","matTooltip","Approve",3,"click"],["mat-icon-button","","color","warn","matTooltip","Reject",3,"click"],["mat-header-row",""],["mat-row","",1,"expense-row",3,"click"],[1,"mat-row"],["colspan","8",1,"mat-cell"]],template:function(t,i){if(t&1){let o=C();a(0,"div",1)(1,"div",2)(2,"h1",3),s(3,"Expenses Management"),r(),a(4,"div",4)(5,"button",5),_("click",function(){return f(o),x(i.createExpense())}),a(6,"mat-icon"),s(7,"add"),r(),s(8," Add Expense "),r()()(),a(9,"mat-card",6)(10,"mat-card-content")(11,"form",7)(12,"div",8)(13,"mat-form-field",9)(14,"mat-label"),s(15,"Search"),r(),E(16,"input",10),p(17,nt,3,0,"button",11),a(18,"mat-icon",12),s(19,"search"),r()()(),a(20,"div",13)(21,"mat-form-field",9)(22,"mat-label"),s(23,"Expense Type"),r(),a(24,"mat-select",14)(25,"mat-option",15),s(26,"All Types"),r(),p(27,it,2,2,"mat-option",16),r()()(),a(28,"div",17)(29,"mat-form-field",18)(30,"mat-label"),s(31,"Date Range"),r(),a(32,"mat-date-range-input",19),E(33,"input",20)(34,"input",21),r(),E(35,"mat-datepicker-toggle",22)(36,"mat-date-range-picker",null,0),r()(),a(38,"div",23)(39,"button",24),_("click",function(){return f(o),x(i.resetFilters())}),a(40,"mat-icon"),s(41,"refresh"),r(),s(42," Reset Filters "),r()()()()(),p(43,at,2,0,"div",25)(44,wt,30,7,"div",26),r()}if(t&2){let o,l,u=V(37);c(11),m("formGroup",i.searchForm),c(6),m("ngIf",(o=i.searchForm.get("searchText"))==null?null:o.value),c(10),m("ngForOf",i.expenseTypes),c(5),m("rangePicker",u),c(3),m("for",u),c(4),m("disabled",!((l=i.searchForm.get("searchText"))!=null&&l.value)&&!((l=i.searchForm.get("dateRange.start"))!=null&&l.value)&&!((l=i.searchForm.get("dateRange.end"))!=null&&l.value)&&!((l=i.searchForm.get("expenseType"))!=null&&l.value)),c(4),m("ngIf",i.loading),c(),m("ngIf",!i.loading)}},dependencies:[A,B,j,te,K,J,U,W,X,Z,Y,Ae,ke,De,Ie,Oe,Pe,Ve,Fe,Re,Ne,Be,je,Te,P,we,ye,k,me,ce,se,re,oe,le,ue,de,pe,xe,fe,ae,ne,ie,Je,Ge,Le,Qe,ze,qe,He,be,Ee,ve,Xe,Ke,Ce,ge,_e,We,Se,Me,Ye],styles:[".expenses-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.header-actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}}@media (max-width: 576px){.header-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}}.create-button[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.filter-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.filter-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.filter-form[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start}@media (max-width: 992px){.filter-form[_ngcontent-%COMP%]{flex-direction:column}}.search-container[_ngcontent-%COMP%]{flex:2;display:flex;align-items:flex-start}.search-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.type-container[_ngcontent-%COMP%]{flex:1;display:flex;align-items:flex-start}.type-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.date-container[_ngcontent-%COMP%]{flex:2;display:flex;align-items:flex-start}.date-container[_ngcontent-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.filter-actions[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}@media (max-width: 992px){.filter-actions[_ngcontent-%COMP%]{width:100%}}.reset-button[_ngcontent-%COMP%]{color:#c19a6b;border-color:#c19a6b}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.expenses-table[_ngcontent-%COMP%]{width:100%}.expenses-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:500;color:#4a3c31;white-space:nowrap}.expenses-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{color:#333}.expenses-table[_ngcontent-%COMP%]   .expense-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}.expenses-table[_ngcontent-%COMP%]   .expense-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.expense-type[_ngcontent-%COMP%]{font-weight:500}.amount-cell[_ngcontent-%COMP%]{font-weight:500;text-align:right}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:500;color:#fff;display:inline-block;min-width:80px;text-align:center}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:4px}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5}[_nghost-%COMP%]     .mat-slide-toggle.mat-primary.mat-checked .mat-slide-toggle-thumb{background-color:#c19a6b}[_nghost-%COMP%]     .mat-slide-toggle.mat-primary.mat-checked .mat-slide-toggle-bar{background-color:#c19a6b80}"]})};export{et as ExpensesComponent};
