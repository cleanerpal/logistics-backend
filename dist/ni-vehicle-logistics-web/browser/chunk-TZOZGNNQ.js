import{a as Q,b as X}from"./chunk-IDK22FN7.js";import{c as K}from"./chunk-RDAIYJSK.js";import"./chunk-DWEM3L4R.js";import{a as Y,b as Z}from"./chunk-ESJIWLK4.js";import"./chunk-F5X5MWHG.js";import{b as J}from"./chunk-6ZM5HFJH.js";import{c as q}from"./chunk-4TDDZIB3.js";import"./chunk-GW6WOXIL.js";import"./chunk-PP7BOOB7.js";import"./chunk-DQFV6XNM.js";import{a as T,b as R,c as B,d as j,f as V,h as N}from"./chunk-OFY7VGJP.js";import"./chunk-P7ITNQJW.js";import{a as H,b as L}from"./chunk-HDC6EVXZ.js";import{b as W}from"./chunk-Q2NIOR5G.js";import{C as F,E as z,H as U,I as $,J as G}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as w,c as D}from"./chunk-4PPYA6ZN.js";import{ea as g,ga as I,j as y,la as S,ma as v,o as k,sa as A,wa as b}from"./chunk-3O2P3FIP.js";import{Cb as l,Db as O,Lb as n,Mb as i,Nb as M,Rb as _,Vb as p,Wb as d,db as s,fc as r,gc as E,hc as m,ib as f,pa as x,pb as P,qa as u,vb as C}from"./chunk-NXWLSP6D.js";import{g as h}from"./chunk-RA2WU32H.js";function te(o,t){if(o&1){let e=_();n(0,"button",12),p("click",function(){x(e);let a=d(2);return u(a.approveExpense())}),n(1,"mat-icon"),r(2,"check_circle"),i(),r(3," Approve "),i()}}function ne(o,t){if(o&1){let e=_();n(0,"button",11),p("click",function(){x(e);let a=d(2);return u(a.rejectExpense())}),n(1,"mat-icon"),r(2,"cancel"),i(),r(3," Reject "),i()}}function ie(o,t){if(o&1){let e=_();n(0,"div",8),C(1,te,4,0,"button",9)(2,ne,4,0,"button",10),n(3,"button",11),p("click",function(){x(e);let a=d();return u(a.confirmDelete())}),n(4,"mat-icon"),r(5,"delete"),i(),r(6," Delete "),i()()}if(o&2){let e=d();s(),l("ngIf",e.expense.status==="Pending"),s(),l("ngIf",e.expense.status==="Pending")}}function re(o,t){o&1&&(n(0,"div",13),M(1,"mat-spinner",14),i())}function ae(o,t){if(o&1){let e=_();n(0,"div",27)(1,"h3"),r(2,"Receipt"),i(),n(3,"div",28)(4,"div",29)(5,"mat-icon"),r(6,"receipt"),i(),n(7,"div",30),r(8,"Receipt Available"),i()(),n(9,"button",31),p("click",function(){x(e);let a=d(2);return u(a.viewReceipt())}),n(10,"mat-icon"),r(11,"visibility"),i(),r(12," View Receipt "),i()()()}}function oe(o,t){o&1&&(n(0,"div",27)(1,"h3"),r(2,"Receipt"),i(),n(3,"div",32),r(4,"No receipt was uploaded for this expense"),i()())}function se(o,t){if(o&1){let e=_();n(0,"div",15)(1,"mat-card",16)(2,"mat-card-header")(3,"mat-card-title"),r(4),n(5,"span",17),r(6),i()(),n(7,"mat-card-subtitle"),r(8),i()(),n(9,"mat-card-content")(10,"div",18)(11,"div",19)(12,"div",20),r(13,"Driver"),i(),n(14,"div",21),r(15),i()(),n(16,"div",19)(17,"div",20),r(18,"Amount"),i(),n(19,"div",22),r(20),i()(),n(21,"div",19)(22,"div",20),r(23,"Date"),i(),n(24,"div",21),r(25),i()(),n(26,"div",19)(27,"div",20),r(28,"Created"),i(),n(29,"div",21),r(30),i()(),n(31,"div",23)(32,"div",20),r(33,"Notes"),i(),n(34,"div",24),r(35),i()(),n(36,"div",23)(37,"div",20),r(38,"Chargeable"),i(),n(39,"div",21)(40,"mat-slide-toggle",25),p("change",function(){x(e);let a=d();return u(a.toggleChargeable())}),i()()()(),M(41,"mat-divider"),C(42,ae,13,0,"div",26)(43,oe,5,0,"div",26),i()()()}if(o&2){let e=d();s(4),m(" ",e.expense.type," Expense "),s(),O("background-color",e.getStatusColor(e.expense.status)),s(),m(" ",e.expense.status," "),s(2),m("Expense ID: ",e.expense.id,""),s(7),E(e.expense.driverName),s(5),m(" ",e.formatAmount(e.expense.amount)," "),s(5),E(e.formatDate(e.expense.date)),s(5),m(" ",e.formatDate(e.expense.createdAt)," "),s(5),m(" ",e.expense.notes||"No notes provided"," "),s(5),l("checked",e.expense.chargeable)("disabled",e.expense.status==="Rejected"),s(2),l("ngIf",e.expense.receiptUrl),s(),l("ngIf",!e.expense.receiptUrl)}}var ee=class o{constructor(t,e,c,a,ce){this.firestore=t;this.route=e;this.router=c;this.snackBar=a;this.dialog=ce}expenseId=null;expense=null;loading=!0;unsubscribe;ngOnInit(){this.route.paramMap.subscribe(t=>{this.expenseId=t.get("id"),this.expenseId?this.loadExpenseDetails(this.expenseId):this.router.navigate(["/expenses"])})}ngOnDestroy(){this.unsubscribe&&this.unsubscribe()}loadExpenseDetails(t){this.loading=!0;try{let e=v(this.firestore,"Expenses",t);this.unsubscribe=A(e,c=>{if(c.exists()){let a=c.data();this.expense={id:c.id,driverId:a.driverId||"",driverName:a.driverName||"Unknown Driver",type:a.type||"Other",amount:a.amount||0,date:a.date||g.now(),notes:a.notes||"",receiptUrl:a.receiptUrl||"",status:a.status||"Pending",chargeable:a.chargeable||!1,createdAt:a.createdAt||g.now(),updatedAt:a.updatedAt||g.now()}}else this.snackBar.open("Expense not found","Close",{duration:3e3}),this.router.navigate(["/expenses"]);this.loading=!1},c=>{console.error("Error loading expense details:",c),this.snackBar.open("Error loading expense details","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1})}catch(e){console.error("Error setting up expense subscription:",e),this.loading=!1}}goBack(){this.router.navigate(["/expenses"])}approveExpense(){return h(this,null,function*(){if(this.expenseId)try{let t=v(this.firestore,"Expenses",this.expenseId);yield b(t,{status:"Approved",updatedAt:g.now()}),this.snackBar.open("Expense approved","Close",{duration:3e3})}catch(t){console.error("Error approving expense:",t),this.snackBar.open("Error approving expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}rejectExpense(){return h(this,null,function*(){if(this.expenseId)try{let t=v(this.firestore,"Expenses",this.expenseId);yield b(t,{status:"Rejected",updatedAt:g.now()}),this.snackBar.open("Expense rejected","Close",{duration:3e3})}catch(t){console.error("Error rejecting expense:",t),this.snackBar.open("Error rejecting expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}toggleChargeable(){return h(this,null,function*(){if(!(!this.expenseId||!this.expense))try{let t=v(this.firestore,"Expenses",this.expenseId);yield b(t,{chargeable:!this.expense.chargeable,updatedAt:g.now()}),this.snackBar.open(`Expense marked as ${this.expense.chargeable?"non-chargeable":"chargeable"}`,"Close",{duration:3e3})}catch(t){console.error("Error updating expense chargeable status:",t),this.snackBar.open("Error updating expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}confirmDelete(){confirm("Are you sure you want to delete this expense?")&&this.deleteExpense()}deleteExpense(){return h(this,null,function*(){if(this.expenseId)try{let t=v(this.firestore,"Expenses",this.expenseId);yield S(t),this.snackBar.open("Expense deleted successfully","Close",{duration:3e3}),this.router.navigate(["/expenses"])}catch(t){console.error("Error deleting expense:",t),this.snackBar.open("Error deleting expense. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}viewReceipt(){this.expense?.receiptUrl&&window.open(this.expense.receiptUrl,"_blank")}formatDate(t){return t?t.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A"}formatAmount(t){return`\xA3${t.toFixed(2)}`}getStatusColor(t){switch(t){case"Approved":return"#4CAF50";case"Rejected":return"#F44336";case"Pending":return"#FFC107";default:return"#9E9E9E"}}static \u0275fac=function(e){return new(e||o)(f(I),f(w),f(D),f(W),f(K))};static \u0275cmp=P({type:o,selectors:[["app-expense-details"]],decls:11,vars:3,consts:[[1,"expense-details-container"],[1,"page-header"],[1,"title-section"],["mat-icon-button","","color","primary",1,"back-button",3,"click"],[1,"page-title"],["class","header-actions",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","details-content",4,"ngIf"],[1,"header-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"loading-container"],["diameter","50"],[1,"details-content"],[1,"details-card"],[1,"status-badge"],[1,"details-grid"],[1,"detail-item"],[1,"detail-label"],[1,"detail-value"],[1,"detail-value","amount"],[1,"detail-item","full-width"],[1,"detail-value","notes"],["color","primary",3,"change","checked","disabled"],["class","receipt-section",4,"ngIf"],[1,"receipt-section"],[1,"receipt-preview"],[1,"receipt-placeholder"],[1,"receipt-placeholder-text"],["mat-raised-button","","color","primary",3,"click"],[1,"no-receipt"]],template:function(e,c){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),p("click",function(){return c.goBack()}),n(4,"mat-icon"),r(5,"arrow_back"),i()(),n(6,"h1",4),r(7,"Expense Details"),i()(),C(8,ie,7,2,"div",5),i(),C(9,re,2,0,"div",6)(10,se,44,14,"div",7),i()),e&2&&(s(8),l("ngIf",c.expense),s(),l("ngIf",c.loading),s(),l("ngIf",!c.loading&&c.expense))},dependencies:[k,y,U,z,F,N,T,B,V,j,R,G,$,q,L,H,Z,Y,X,Q,J],styles:[".expense-details-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;align-items:center}.page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{margin-right:8px;color:#c19a6b}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}.page-header[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:12px;width:100%}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.details-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.details-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a}.details-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{position:relative;padding:16px 16px 0}.details-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:20px;margin-bottom:4px;display:flex;align-items:center;gap:12px}.details-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.details-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.details-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px;margin-bottom:20px}@media (max-width: 576px){.details-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.details-grid[_ngcontent-%COMP%]   .detail-item.full-width[_ngcontent-%COMP%]{grid-column:1/-1}.detail-label[_ngcontent-%COMP%]{font-size:14px;color:#666;margin-bottom:4px}.detail-value[_ngcontent-%COMP%]{font-size:16px;color:#333}.detail-value.amount[_ngcontent-%COMP%]{font-weight:600;color:#4a3c31}.detail-value.notes[_ngcontent-%COMP%]{font-style:italic;background-color:#f9f9f9;padding:12px;border-radius:4px;line-height:1.5}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;font-size:12px;font-weight:500;color:#fff;display:inline-block;text-align:center}.receipt-section[_ngcontent-%COMP%]{margin-top:24px}.receipt-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:16px}.receipt-section[_ngcontent-%COMP%]   .no-receipt[_ngcontent-%COMP%]{color:#666;font-style:italic}.receipt-section[_ngcontent-%COMP%]   .receipt-preview[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-bottom:16px}@media (max-width: 576px){.receipt-section[_ngcontent-%COMP%]   .receipt-preview[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}.receipt-section[_ngcontent-%COMP%]   .receipt-placeholder[_ngcontent-%COMP%]{width:150px;height:150px;background-color:#f0f0f0;border:1px dashed #ccc;border-radius:4px;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#666}.receipt-section[_ngcontent-%COMP%]   .receipt-placeholder[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:8px;color:#c19a6b}.receipt-section[_ngcontent-%COMP%]   .receipt-placeholder[_ngcontent-%COMP%]   .receipt-placeholder-text[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]     .mat-slide-toggle.mat-primary.mat-checked .mat-slide-toggle-thumb{background-color:#c19a6b}[_nghost-%COMP%]     .mat-slide-toggle.mat-primary.mat-checked .mat-slide-toggle-bar{background-color:#c19a6b80}button[color=primary][_ngcontent-%COMP%]{background-color:#c19a6b}button[color=accent][_ngcontent-%COMP%]{background-color:#4caf50;color:#fff}button[color=warn][_ngcontent-%COMP%]{background-color:#f44336;color:#fff}"]})};export{ee as ExpenseDetailsComponent};
