import"./chunk-MS4AQ6UA.js";import{b as se,c as de}from"./chunk-LDLE5TDT.js";import{a as Ce,b as xe}from"./chunk-DJMXPRNS.js";import{d as he}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as le}from"./chunk-FL7UC7QU.js";import"./chunk-DQFV6XNM.js";import{a as Z,b as ee,c as te,f as re,h as ie}from"./chunk-OFY7VGJP.js";import{b as ne,c as oe,d as ae,i as me}from"./chunk-P7ITNQJW.js";import{a as ve,b as ge}from"./chunk-HDC6EVXZ.js";import{b as _e}from"./chunk-Q2NIOR5G.js";import{E as ce,H as pe,I as ue,J as fe,b as z,d as g,g as H,h as L,i as Q,l as $,o as J,q as K,u as W,w as Y}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as B,c as q}from"./chunk-4PPYA6ZN.js";import{ea as y,ga as R,i as w,ia as V,j as T,ka as D,ma as b,o as k,oa as G,pa as X,ua as I,va as A,wa as j,xa as U}from"./chunk-3O2P3FIP.js";import{Cb as s,Lb as n,Mb as t,Nb as u,Rb as O,Vb as E,Wb as C,db as l,fc as a,hc as x,ib as _,pa as M,pb as N,qa as F,vb as c}from"./chunk-NXWLSP6D.js";import{a as S,b as P,g as h}from"./chunk-RA2WU32H.js";function Me(i,e){i&1&&(n(0,"div",5),u(1,"mat-spinner",6),t())}function Fe(i,e){i&1&&(n(0,"mat-hint"),a(1,"Auto-generated unique ID"),t())}function Ee(i,e){i&1&&(n(0,"mat-hint"),a(1,"ID cannot be changed after creation"),t())}function ye(i,e){i&1&&(n(0,"mat-error"),a(1," Name is required "),t())}function De(i,e){i&1&&(n(0,"mat-error"),a(1," Email is required "),t())}function Ie(i,e){i&1&&(n(0,"mat-error"),a(1," Please enter a valid email address "),t())}function Se(i,e){i&1&&(n(0,"mat-error"),a(1," Phone number is required "),t())}function Pe(i,e){i&1&&(n(0,"mat-error"),a(1," Please enter a valid phone number "),t())}function Ne(i,e){if(i&1&&(n(0,"mat-option",24),a(1),t()),i&2){let r=e.$implicit;s("value",r.name),l(),x(" ",r.name," ")}}function Oe(i,e){i&1&&(n(0,"mat-error"),a(1," Team is required "),t())}function we(i,e){i&1&&u(0,"mat-spinner",25)}function Te(i,e){if(i&1&&(n(0,"span")(1,"mat-icon"),a(2,"save"),t(),a(3),t()),i&2){let r=C(2);l(3),x(" ",r.isEditMode?"Update":"Create"," Driver ")}}function ke(i,e){if(i&1){let r=O();n(0,"form",7),E("ngSubmit",function(){M(r);let m=C();return F(m.onSubmit())}),n(1,"mat-card",8)(2,"mat-card-header")(3,"mat-card-title"),a(4,"Driver Information"),t()(),n(5,"mat-card-content")(6,"div",9)(7,"mat-form-field",10)(8,"mat-label"),a(9,"Driver ID"),t(),u(10,"input",11),c(11,Fe,2,0,"mat-hint",12)(12,Ee,2,0,"mat-hint",12),t()(),n(13,"div",9)(14,"mat-form-field",10)(15,"mat-label"),a(16,"Name"),t(),u(17,"input",13),c(18,ye,2,0,"mat-error",12),t()(),n(19,"div",9)(20,"mat-form-field",10)(21,"mat-label"),a(22,"Email"),t(),u(23,"input",14),c(24,De,2,0,"mat-error",12)(25,Ie,2,0,"mat-error",12),t()(),n(26,"div",9)(27,"mat-form-field",10)(28,"mat-label"),a(29,"Phone Number"),t(),u(30,"input",15),c(31,Se,2,0,"mat-error",12)(32,Pe,2,0,"mat-error",12),t()(),n(33,"div",9)(34,"mat-form-field",10)(35,"mat-label"),a(36,"Role"),t(),u(37,"input",16),n(38,"mat-hint"),a(39,"Driver role is fixed and cannot be changed"),t()()(),n(40,"div",9)(41,"mat-form-field",10)(42,"mat-label"),a(43,"Team"),t(),n(44,"mat-select",17)(45,"mat-option",18),a(46,"Select a team"),t(),c(47,Ne,2,2,"mat-option",19),t(),c(48,Oe,2,0,"mat-error",12),t()()()(),n(49,"div",20)(50,"button",21),E("click",function(){M(r);let m=C();return F(m.onCancel())}),n(51,"mat-icon"),a(52,"cancel"),t(),a(53," Cancel "),t(),n(54,"button",22),c(55,we,1,0,"mat-spinner",23)(56,Te,4,1,"span",12),t()()()}if(i&2){let r,o,m,p,f,v,d=C();s("formGroup",d.driverForm),l(11),s("ngIf",!d.isEditMode),l(),s("ngIf",d.isEditMode),l(6),s("ngIf",(r=d.driverForm.get("displayName"))==null?null:r.hasError("required")),l(6),s("ngIf",(o=d.driverForm.get("email"))==null?null:o.hasError("required")),l(),s("ngIf",(m=d.driverForm.get("email"))==null?null:m.hasError("email")),l(6),s("ngIf",(p=d.driverForm.get("phoneNumber"))==null?null:p.hasError("required")),l(),s("ngIf",(f=d.driverForm.get("phoneNumber"))==null?null:f.hasError("pattern")),l(15),s("ngForOf",d.teams),l(),s("ngIf",(v=d.driverForm.get("team"))==null?null:v.hasError("required")),l(6),s("disabled",d.saving),l(),s("ngIf",d.saving),l(),s("ngIf",!d.saving)}}var be=class i{constructor(e,r,o,m,p){this.formBuilder=e;this.firestore=r;this.route=o;this.router=m;this.snackBar=p}driverForm;isEditMode=!1;loading=!0;saving=!1;driverId=null;teams=[];subscriptions=[];ngOnInit(){this.initializeForm(),this.loadTeams(),this.route.paramMap.subscribe(e=>{this.driverId=e.get("id"),this.driverId?(this.isEditMode=!0,this.loadDriverData(this.driverId)):(this.loading=!1,this.generateDriverId())})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}initializeForm(){this.driverForm=this.formBuilder.group({id:[{value:"",disabled:!0}],displayName:["",g.required],email:["",[g.required,g.email]],phoneNumber:["",[g.required,g.pattern(/^(\+\d{1,3}[- ]?)?\d{10,14}$/)]],team:["",g.required],role:[{value:"Driver",disabled:!0}]})}generateDriverId(){return h(this,null,function*(){let e=()=>{let p="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",f="DRV-";for(let v=0;v<6;v++)f+=p.charAt(Math.floor(Math.random()*p.length));return f},r=p=>h(this,null,function*(){let f=D(this.firestore,"Users"),v=I(f,U("id","==",p));return!(yield X(v)).empty}),o=e(),m=yield r(o);for(;m;)o=e(),m=yield r(o);this.driverForm.get("id")?.setValue(o)})}loadTeams(){try{let e=D(this.firestore,"Teams"),r=I(e),o=V(r,{idField:"id"}).subscribe({next:m=>{this.teams=m},error:m=>{console.error("Error loading teams:",m),this.snackBar.open("Error loading teams. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}});this.subscriptions.push(o)}catch(e){console.error("Error setting up teams subscription:",e)}}loadDriverData(e){return h(this,null,function*(){try{let r=b(this.firestore,"Users",e),o=yield G(r);if(o.exists()){let m=o.data();this.driverForm.patchValue({id:e,displayName:m.displayName||"",email:m.email||"",phoneNumber:m.phoneNumber||"",team:m.team||"",role:"Driver"}),this.loading=!1}else this.snackBar.open("Driver not found.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/drivers"])}catch(r){console.error("Error loading driver data:",r),this.snackBar.open("Error loading driver data. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}onSubmit(){return h(this,null,function*(){if(this.driverForm.invalid){this.markFormGroupTouched(this.driverForm),this.snackBar.open("Please fix the validation errors before submitting.","Close",{duration:5e3,panelClass:["warning-snackbar"]});return}this.saving=!0;try{let e=this.driverForm.getRawValue(),r={displayName:e.displayName,email:e.email,phoneNumber:e.phoneNumber,team:e.team,role:"Driver",updatedAt:y.now()};if(this.isEditMode){let o=b(this.firestore,"Users",this.driverId);yield j(o,r),this.snackBar.open("Driver updated successfully.","Close",{duration:3e3})}else{let o=e.id,m=b(this.firestore,"Users",o);yield A(m,P(S({},r),{id:o,createdAt:y.now()})),this.snackBar.open("Driver created successfully.","Close",{duration:3e3})}this.router.navigate(["/drivers"])}catch(e){console.error("Error saving driver:",e),this.snackBar.open("Error saving driver. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}finally{this.saving=!1}})}onCancel(){this.router.navigate(["/drivers"])}markFormGroupTouched(e){Object.values(e.controls).forEach(r=>{r.markAsTouched(),r instanceof Q&&this.markFormGroupTouched(r)})}static \u0275fac=function(r){return new(r||i)(_(W),_(R),_(B),_(q),_(_e))};static \u0275cmp=N({type:i,selectors:[["app-driver-form"]],decls:6,vars:3,consts:[[1,"driver-form-container"],[1,"page-header"],[1,"page-title"],["class","loading-container",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],["diameter","50"],[3,"ngSubmit","formGroup"],[1,"form-card"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","id"],[4,"ngIf"],["matInput","","formControlName","displayName","placeholder","Full name"],["matInput","","formControlName","email","type","email","placeholder","email@example.com"],["matInput","","formControlName","phoneNumber","placeholder","+44 XXXX XXXXXX"],["matInput","","formControlName","role"],["formControlName","team"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"form-actions"],["type","button","mat-stroked-button","",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["diameter","20",4,"ngIf"],[3,"value"],["diameter","20"]],template:function(r,o){r&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),a(3),t()(),c(4,Me,2,0,"div",3)(5,ke,57,13,"form",4),t()),r&2&&(l(3),x(" ",o.isEditMode?"Edit Driver":"Create New Driver"," "),l(),s("ngIf",o.loading),l(),s("ngIf",!o.loading))},dependencies:[k,w,T,Y,$,z,H,L,J,K,ie,Z,te,re,ee,pe,ce,fe,ue,le,me,ne,ae,oe,de,se,xe,Ce,he,ge,ve],styles:[".driver-form-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.form-card[_ngcontent-%COMP%]{margin-bottom:24px;border-radius:8px;box-shadow:0 2px 10px #0000001a}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:8px}.form-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.form-row[_ngcontent-%COMP%]{margin-bottom:16px;width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px;margin-bottom:40px}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:120px}@media (max-width: 576px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}[_nghost-%COMP%]     .mat-mdc-raised-button.mat-primary{background-color:#c19a6b}[_nghost-%COMP%]     .mat-mdc-form-field{width:100%}"]})};export{be as DriverFormComponent};
