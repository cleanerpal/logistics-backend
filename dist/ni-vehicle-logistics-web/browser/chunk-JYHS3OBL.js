import{a as De,b as Oe,c as ke,d as Pe,e as we,f as Fe,g as Ne,h as B}from"./chunk-RDAIYJSK.js";import{a as qe,d as Re}from"./chunk-DWEM3L4R.js";import{a as Te,b as Be}from"./chunk-ESJIWLK4.js";import"./chunk-MS4AQ6UA.js";import{b as Ce,c as he}from"./chunk-LDLE5TDT.js";import{a as Se,b as Ie}from"./chunk-DJMXPRNS.js";import{d as Ee}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as ye}from"./chunk-FL7UC7QU.js";import"./chunk-DQFV6XNM.js";import{a as de,b as le,c as me,d as ce,f as pe,h as ue}from"./chunk-OFY7VGJP.js";import{b as fe,c as ge,i as _e}from"./chunk-P7ITNQJW.js";import{a as ve,b as Me}from"./chunk-HDC6EVXZ.js";import{b as Ae}from"./chunk-Q2NIOR5G.js";import{C as be,E as F,H as N,I as xe,J as T,b as te,d as g,g as ne,h as ie,l as re,o as ae,q as oe,u as se,w}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as U,c as Z,g as K}from"./chunk-4PPYA6ZN.js";import{ea as M,ga as H,i as L,ia as Q,j as O,ja as J,ka as P,la as W,ma as C,o as k,oa as X,ua as Y,wa as A,xa as ee}from"./chunk-3O2P3FIP.js";import{Cb as l,Lb as i,Mb as n,Nb as c,Ob as G,Pb as z,Rb as v,Vb as _,Wb as p,db as d,fc as o,ga as y,gc as I,hc as D,ib as x,pa as h,pb as S,qa as b,vb as m}from"./chunk-NXWLSP6D.js";import{g as f}from"./chunk-RA2WU32H.js";function je(a,t){a&1&&(i(0,"mat-error"),o(1," Address type is required "),n())}function $e(a,t){a&1&&(i(0,"mat-error"),o(1," Building number/name is required "),n())}function Ge(a,t){a&1&&(i(0,"mat-error"),o(1," Street is required "),n())}function ze(a,t){a&1&&(i(0,"mat-error"),o(1," City is required "),n())}function Le(a,t){a&1&&(i(0,"mat-error"),o(1," Postcode is required "),n())}function Ue(a,t){a&1&&(i(0,"mat-error"),o(1," Please enter a valid UK postcode "),n())}function Ze(a,t){a&1&&(i(0,"mat-error"),o(1," Country is required "),n())}function Ke(a,t){a&1&&(i(0,"div",8),c(1,"mat-spinner",9),n())}function He(a,t){if(a&1){let e=v();i(0,"div",14)(1,"p"),o(2,"No addresses found for this company."),n(),i(3,"button",15),_("click",function(){h(e);let s=p(2);return b(s.addAddress())}),i(4,"mat-icon"),o(5,"add"),n(),o(6," Add Address "),n()()}}function Qe(a,t){a&1&&(i(0,"span",29),o(1,"Default"),n())}function Je(a,t){if(a&1){let e=v();i(0,"button",30),_("click",function(){h(e);let s=p().$implicit,u=p(3);return b(u.setAsDefault(s.id))}),i(1,"mat-icon"),o(2,"star_border"),n()()}}function We(a,t){a&1&&c(0,"mat-divider")}function Xe(a,t){if(a&1){let e=v();G(0),i(1,"div",18)(2,"div",19)(3,"div",20)(4,"span",21),o(5),n(),m(6,Qe,2,0,"span",22),n(),i(7,"div",23),o(8),n()(),i(9,"div",24),m(10,Je,3,0,"button",25),i(11,"button",26),_("click",function(){let s=h(e).$implicit,u=p(3);return b(u.editAddress(s))}),i(12,"mat-icon"),o(13,"edit"),n()(),i(14,"button",27),_("click",function(){let s=h(e).$implicit,u=p(3);return b(u.deleteAddress(s.id))}),i(15,"mat-icon"),o(16,"delete"),n()()()(),m(17,We,1,0,"mat-divider",28),z()}if(a&2){let e=t.$implicit,r=t.last,s=p(3);d(5),I(e.type),d(),l("ngIf",e.isDefault),d(2),D(" ",s.formatAddress(e)," "),d(2),l("ngIf",!e.isDefault),d(7),l("ngIf",!r)}}function Ye(a,t){if(a&1&&(i(0,"mat-list",16),m(1,Xe,18,5,"ng-container",17),n()),a&2){let e=p(2);d(),l("ngForOf",e.addresses)}}function et(a,t){if(a&1&&(i(0,"div",10)(1,"mat-card",11)(2,"mat-card-header")(3,"mat-card-title"),o(4,"Saved Addresses"),n(),i(5,"mat-card-subtitle"),o(6,"Manage all addresses associated with this company"),n()(),i(7,"mat-card-content"),m(8,He,7,0,"div",12)(9,Ye,2,1,"mat-list",13),n()()()),a&2){let e=p();d(8),l("ngIf",e.addresses.length===0),d(),l("ngIf",e.addresses.length>0)}}var E=class a{constructor(t,e,r){this.formBuilder=t;this.data=e;this.dialogRef=r;this.addressForm=this.formBuilder.group({type:["Delivery",g.required],building:["",g.required],street:["",g.required],city:["",g.required],state:[""],country:["United Kingdom",g.required],postcode:["",[g.required,g.pattern(/^([A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2})$/)]],isDefault:[!1]})}addressForm;ngOnInit(){this.data.isEdit&&this.data.address&&this.addressForm.patchValue({type:this.data.address.type,building:this.data.address.building,street:this.data.address.street,city:this.data.address.city,state:this.data.address.state,country:this.data.address.country,postcode:this.data.address.postcode,isDefault:this.data.address.isDefault})}static \u0275fac=function(e){return new(e||a)(x(se),x(Oe),x(De))};static \u0275cmp=S({type:a,selectors:[["app-address-dialog"]],decls:57,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"form-row"],["appearance","outline"],["formControlName","type"],["value","Billing"],["value","Delivery"],["value","Other"],[4,"ngIf"],["matInput","","formControlName","building"],["matInput","","formControlName","street"],["matInput","","formControlName","city"],["matInput","","formControlName","state"],["matInput","","formControlName","postcode"],["matInput","","formControlName","country"],["mat-dialog-actions","","align","end"],["mat-button","",3,"mat-dialog-close"],["mat-raised-button","","color","primary",3,"mat-dialog-close","disabled"]],template:function(e,r){if(e&1&&(i(0,"h2",0),o(1),n(),i(2,"div",1)(3,"form",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),o(7,"Address Type"),n(),i(8,"mat-select",5)(9,"mat-option",6),o(10,"Billing"),n(),i(11,"mat-option",7),o(12,"Delivery"),n(),i(13,"mat-option",8),o(14,"Other"),n()(),m(15,je,2,0,"mat-error",9),n()(),i(16,"div",3)(17,"mat-form-field",4)(18,"mat-label"),o(19,"Building Number/Name"),n(),c(20,"input",10),m(21,$e,2,0,"mat-error",9),n()(),i(22,"div",3)(23,"mat-form-field",4)(24,"mat-label"),o(25,"Street"),n(),c(26,"input",11),m(27,Ge,2,0,"mat-error",9),n()(),i(28,"div",3)(29,"mat-form-field",4)(30,"mat-label"),o(31,"City"),n(),c(32,"input",12),m(33,ze,2,0,"mat-error",9),n()(),i(34,"div",3)(35,"mat-form-field",4)(36,"mat-label"),o(37,"State/County"),n(),c(38,"input",13),n()(),i(39,"div",3)(40,"mat-form-field",4)(41,"mat-label"),o(42,"Postcode"),n(),c(43,"input",14),m(44,Le,2,0,"mat-error",9)(45,Ue,2,0,"mat-error",9),n()(),i(46,"div",3)(47,"mat-form-field",4)(48,"mat-label"),o(49,"Country"),n(),c(50,"input",15),m(51,Ze,2,0,"mat-error",9),n()()()(),i(52,"div",16)(53,"button",17),o(54,"Cancel"),n(),i(55,"button",18),o(56," Save "),n()()),e&2){let s,u,q,R,V,j,$;d(),I(r.data.isEdit?"Edit Address":"Add Address"),d(2),l("formGroup",r.addressForm),d(12),l("ngIf",(s=r.addressForm.get("type"))==null?null:s.hasError("required")),d(6),l("ngIf",(u=r.addressForm.get("building"))==null?null:u.hasError("required")),d(6),l("ngIf",(q=r.addressForm.get("street"))==null?null:q.hasError("required")),d(6),l("ngIf",(R=r.addressForm.get("city"))==null?null:R.hasError("required")),d(11),l("ngIf",(V=r.addressForm.get("postcode"))==null?null:V.hasError("required")),d(),l("ngIf",(j=r.addressForm.get("postcode"))==null?null:j.hasError("pattern")),d(6),l("ngIf",($=r.addressForm.get("country"))==null?null:$.hasError("required")),d(2),l("mat-dialog-close",null),d(2),l("mat-dialog-close",r.addressForm.value)("disabled",r.addressForm.invalid)}},dependencies:[k,O,w,re,te,ne,ie,ae,oe,N,F,ye,_e,fe,ge,he,Ce,Ie,Se,Ee,B,Pe,we,Ne,Fe,T],styles:[".form-row[_ngcontent-%COMP%]{margin-bottom:16px}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}"]})},Ve=class a{firestore=y(H);route=y(U);router=y(Z);dialog=y(ke);snackBar=y(Ae);companyId=null;companyName="";addresses=[];loading=!0;addressesSubscription;ngOnInit(){this.route.paramMap.subscribe(t=>{this.companyId=t.get("id"),this.companyId?(this.loadCompanyDetails(this.companyId),this.loadAddresses(this.companyId)):this.router.navigate(["/companies"])})}ngOnDestroy(){this.addressesSubscription&&this.addressesSubscription.unsubscribe()}loadCompanyDetails(t){return f(this,null,function*(){try{let e=C(this.firestore,"Companies",t),r=yield X(e);if(r.exists()){let s=r.data();this.companyName=s.companyName||"Unknown Company"}else this.snackBar.open("Company not found.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.router.navigate(["/companies"])}catch(e){console.error("Error loading company details:",e),this.snackBar.open("Error loading company details.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}loadAddresses(t){try{let e=P(this.firestore,"Addresses"),r=Y(e,ee("companyId","==",t));this.addressesSubscription=Q(r,{idField:"id"}).subscribe({next:s=>{this.addresses=s,this.loading=!1},error:s=>{console.error("Error loading addresses:",s),this.snackBar.open("Error loading addresses.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}catch(e){console.error("Error setting up addresses subscription:",e),this.loading=!1}}addAddress(){if(!this.companyId)return;this.dialog.open(E,{width:"500px",data:{isEdit:!1,companyId:this.companyId,companyName:this.companyName}}).afterClosed().subscribe(e=>f(this,null,function*(){e&&(yield this.saveAddress(e))}))}editAddress(t){this.dialog.open(E,{width:"500px",data:{isEdit:!0,address:t,companyId:this.companyId,companyName:this.companyName}}).afterClosed().subscribe(r=>f(this,null,function*(){r&&(yield this.updateAddress(t.id,r))}))}saveAddress(t){return f(this,null,function*(){if(this.companyId)try{let e=P(this.firestore,"Addresses"),r={companyId:this.companyId,companyName:this.companyName,type:t.type,building:t.building,street:t.street,city:t.city,state:t.state,country:t.country,postcode:t.postcode,isDefault:t.isDefault||!1,createdAt:M.now(),updatedAt:M.now()};yield J(e,r),this.snackBar.open("Address added successfully.","Close",{duration:3e3})}catch(e){console.error("Error saving address:",e),this.snackBar.open("Error saving address.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}updateAddress(t,e){return f(this,null,function*(){try{let r=C(this.firestore,"Addresses",t),s={type:e.type,building:e.building,street:e.street,city:e.city,state:e.state,country:e.country,postcode:e.postcode,isDefault:e.isDefault||!1,updatedAt:M.now()};yield A(r,s),this.snackBar.open("Address updated successfully.","Close",{duration:3e3})}catch(r){console.error("Error updating address:",r),this.snackBar.open("Error updating address.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}deleteAddress(t){return f(this,null,function*(){if(confirm("Are you sure you want to delete this address?"))try{let e=C(this.firestore,"Addresses",t);yield W(e),this.snackBar.open("Address deleted successfully.","Close",{duration:3e3})}catch(e){console.error("Error deleting address:",e),this.snackBar.open("Error deleting address.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}setAsDefault(t){return f(this,null,function*(){try{for(let r of this.addresses)if(r.isDefault){let s=C(this.firestore,"Addresses",r.id);yield A(s,{isDefault:!1})}let e=C(this.firestore,"Addresses",t);yield A(e,{isDefault:!0}),this.snackBar.open("Default address updated.","Close",{duration:3e3})}catch(e){console.error("Error setting default address:",e),this.snackBar.open("Error setting default address.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}goBack(){this.router.navigate(["/companies"])}formatAddress(t){return`${t.building} ${t.street}, ${t.city}, ${t.postcode}, ${t.country}`}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=S({type:a,selectors:[["app-company-addresses"]],decls:15,vars:3,consts:[[1,"addresses-container"],[1,"page-header"],[1,"page-title"],[1,"header-actions"],["mat-raised-button","","color","primary",1,"add-button",3,"click"],["mat-stroked-button","",1,"back-button",3,"click"],["class","loading-container",4,"ngIf"],["class","addresses-content",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"addresses-content"],[1,"addresses-card"],["class","no-addresses-message",4,"ngIf"],["class","addresses-list",4,"ngIf"],[1,"no-addresses-message"],["mat-raised-button","","color","primary",3,"click"],[1,"addresses-list"],[4,"ngFor","ngForOf"],[1,"address-item"],[1,"address-content"],[1,"address-header"],[1,"address-type"],["class","default-badge",4,"ngIf"],[1,"address-details"],[1,"address-actions"],["mat-icon-button","","color","primary","matTooltip","Set as Default",3,"click",4,"ngIf"],["mat-icon-button","","color","primary","matTooltip","Edit",3,"click"],["mat-icon-button","","color","warn","matTooltip","Delete",3,"click"],[4,"ngIf"],[1,"default-badge"],["mat-icon-button","","color","primary","matTooltip","Set as Default",3,"click"]],template:function(e,r){e&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),o(3),n(),i(4,"div",3)(5,"button",4),_("click",function(){return r.addAddress()}),i(6,"mat-icon"),o(7,"add"),n(),o(8," Add Address "),n(),i(9,"button",5),_("click",function(){return r.goBack()}),i(10,"mat-icon"),o(11,"arrow_back"),n(),o(12," Back to Companies "),n()()(),m(13,Ke,2,0,"div",6)(14,et,10,2,"div",7),n()),e&2&&(d(3),D("",r.companyName," - Addresses"),d(10),l("ngIf",r.loading),d(),l("ngIf",!r.loading))},dependencies:[k,L,O,K,w,ue,de,me,pe,ce,le,Re,qe,Te,N,F,be,T,xe,Me,ve,Be,B],styles:[".addresses-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.header-actions[_ngcontent-%COMP%]{display:flex;gap:12px}@media (max-width: 768px){.header-actions[_ngcontent-%COMP%]{width:100%;justify-content:space-between}}@media (max-width: 576px){.header-actions[_ngcontent-%COMP%]{flex-direction:column;width:100%}}.add-button[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.back-button[_ngcontent-%COMP%]{color:#4a3c31;border-color:#4a3c31}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.addresses-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a}.addresses-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.addresses-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:4px}.addresses-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.addresses-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.no-addresses-message[_ngcontent-%COMP%]{padding:24px;text-align:center}.no-addresses-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:16px;color:#666;font-style:italic}.no-addresses-message[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#c19a6b;color:#fff}.addresses-list[_ngcontent-%COMP%]{padding:0}.address-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:16px 0}@media (max-width: 576px){.address-item[_ngcontent-%COMP%]{flex-direction:column;gap:12px}}.address-content[_ngcontent-%COMP%]{flex:1}.address-header[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px}.address-type[_ngcontent-%COMP%]{font-weight:500;color:#4a3c31}.default-badge[_ngcontent-%COMP%]{margin-left:8px;font-size:12px;padding:2px 8px;background-color:#c19a6b;color:#fff;border-radius:12px}.address-details[_ngcontent-%COMP%]{color:#333;line-height:1.5}.address-actions[_ngcontent-%COMP%]{display:flex;align-items:center}@media (max-width: 576px){.address-actions[_ngcontent-%COMP%]{justify-content:flex-end}}button[color=primary].mat-mdc-raised-button[_ngcontent-%COMP%]{background-color:#c19a6b}button[color=primary].mat-mdc-icon-button[_ngcontent-%COMP%]{color:#c19a6b}"]})};export{E as AddressDialogComponent,Ve as CompanyAddressesComponent};
