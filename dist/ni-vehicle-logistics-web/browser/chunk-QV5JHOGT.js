import"./chunk-F5X5MWHG.js";import{a as _,b as ie}from"./chunk-VWFB2ZCV.js";import{a as ee,b as te}from"./chunk-6ZM5HFJH.js";import"./chunk-DJMXPRNS.js";import"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import"./chunk-FL7UC7QU.js";import{a as b,b as oe,c as ne}from"./chunk-RGR4672A.js";import{a as ae,b as re,c as le,d as ce,e as se,f as de,g as me,h as pe,i as he,j as ue,k as fe,l as ge,m as _e}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{h as q}from"./chunk-OFY7VGJP.js";import"./chunk-P7ITNQJW.js";import{a as X,b as Y}from"./chunk-HDC6EVXZ.js";import{b as Z}from"./chunk-Q2NIOR5G.js";import{C as L,H as G,I as K,J as W}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{a as R,c as B,g as F}from"./chunk-4PPYA6ZN.js";import{ga as H,ia as z,j as O,ka as A,ma as N,o as T,oa as Q,ua as $,xa as U}from"./chunk-3O2P3FIP.js";import{$b as S,Cb as d,Db as P,Lb as n,Mb as a,Nb as f,Ob as p,Pb as h,Rb as x,Vb as g,Wb as m,ac as w,bc as y,db as r,fc as l,gc as D,hc as k,ib as u,ic as j,jc as J,pa as C,pb as E,pc as I,qa as M,vb as s}from"./chunk-NXWLSP6D.js";import{g as V}from"./chunk-RA2WU32H.js";var ve=()=>[10,25,50];function Ce(e,t){if(e&1&&(n(0,"span",8),l(1),a()),e&2){let i=m();r(),J(" ",i.vehicleData.make," ",i.vehicleData.model," (",i.vehicleData.registration,") ")}}function Me(e,t){e&1&&(n(0,"div",9),f(1,"mat-spinner",10),a())}function xe(e,t){e&1&&(n(0,"th",25),l(1,"Job ID"),a())}function Se(e,t){if(e&1&&(n(0,"td",26),l(1),a()),e&2){let i=t.$implicit;r(),D(i.id)}}function we(e,t){e&1&&(n(0,"th",25),l(1,"Vehicle"),a())}function ye(e,t){if(e&1&&(n(0,"td",26),l(1),n(2,"div",27),l(3),a()()),e&2){let i=t.$implicit;r(),j(" ",i.vehicleMake," ",i.vehicleModel," "),r(2),D(i.vehicleRegistration)}}function De(e,t){e&1&&(n(0,"th",25),l(1,"Status"),a())}function ke(e,t){if(e&1&&(n(0,"td",26)(1,"span",28),l(2),a()()),e&2){let i=t.$implicit,o=m(2);r(),P("background-color",o.getStatusColor(i.status)),r(),k(" ",i.status," ")}}function Ve(e,t){e&1&&(n(0,"th",25),l(1," Scheduled Delivery "),a())}function Ee(e,t){if(e&1&&(n(0,"td",26),l(1),a()),e&2){let i=t.$implicit,o=m(2);r(),k(" ",o.formatDate(i.deliveryDate)," ")}}function Pe(e,t){e&1&&(n(0,"th",29),l(1,"Actions"),a())}function je(e,t){if(e&1){let i=x();n(0,"td",26)(1,"button",30),g("click",function(c){let v=C(i).$implicit;return m(2).editJob(v.id),M(c.stopPropagation())}),n(2,"mat-icon"),l(3,"edit"),a()()()}e&2&&(r(),d("matTooltip","Edit Job"))}function Je(e,t){e&1&&f(0,"tr",31)}function Ie(e,t){if(e&1){let i=x();n(0,"tr",32),g("click",function(){let c=C(i).$implicit,v=m(2);return M(v.editJob(c.id))}),a()}}function Oe(e,t){e&1&&(n(0,"tr",33)(1,"td",34),l(2,"No jobs found for this vehicle"),a()())}function Te(e,t){if(e&1&&(n(0,"div",11)(1,"table",12),p(2,13),s(3,xe,2,0,"th",14)(4,Se,2,1,"td",15),h(),p(5,16),s(6,we,2,0,"th",14)(7,ye,4,3,"td",15),h(),p(8,17),s(9,De,2,0,"th",14)(10,ke,3,3,"td",15),h(),p(11,18),s(12,Ve,2,0,"th",14)(13,Ee,2,1,"td",15),h(),p(14,19),s(15,Pe,2,0,"th",20)(16,je,4,1,"td",15),h(),s(17,Je,1,0,"tr",21)(18,Ie,1,0,"tr",22)(19,Oe,3,0,"tr",23),a(),f(20,"mat-paginator",24),a()),e&2){let i=m();r(),d("dataSource",i.dataSource),r(16),d("matHeaderRowDef",i.displayedColumns)("matHeaderRowDefSticky",!0),r(),d("matRowDefColumns",i.displayedColumns),r(2),d("pageSizeOptions",I(6,ve))("pageSize",50)}}var be=class e{constructor(t,i,o,c){this.route=t;this.router=i;this.firestore=o;this.snackBar=c}vehicleId=null;vehicleData=null;loading=!0;dataSource=new _e;displayedColumns=["id","vehicle","status","deliveryDate","actions"];subscription;paginator;sort;ngOnInit(){this.route.paramMap.subscribe(t=>{this.vehicleId=t.get("id"),this.vehicleId?(this.loadVehicleData(),this.loadVehicleJobs()):(this.snackBar.open("Vehicle ID not provided","Close",{duration:3e3}),this.router.navigate(["/vehicles"]))})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}loadVehicleData(){return V(this,null,function*(){if(this.vehicleId)try{let t=N(this.firestore,"Vehicles",this.vehicleId),i=yield Q(t);if(i.exists()){let o=i.data();this.vehicleData={id:i.id,registration:o.registration||"Unknown",make:o.make||"Unknown",model:o.model||"Unknown",type:o.type||"Unknown"}}else this.snackBar.open("Vehicle not found","Close",{duration:3e3}),this.router.navigate(["/vehicles"])}catch(t){console.error("Error loading vehicle data:",t),this.snackBar.open("Error loading vehicle information","Close",{duration:3e3})}})}loadVehicleJobs(){if(this.vehicleId)try{let t=A(this.firestore,"Jobs"),i=$(t,U("vehicleId","==",this.vehicleId));this.subscription=z(i,{idField:"id"}).subscribe({next:o=>{this.dataSource.data=o,this.loading=!1,setTimeout(()=>{this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})},error:o=>{console.error("Error loading vehicle jobs:",o),this.snackBar.open("Error loading jobs. Please try again.","Close",{duration:5e3}),this.loading=!1}})}catch(t){console.error("Error setting up jobs subscription:",t),this.snackBar.open("Error setting up subscription. Please try again.","Close",{duration:5e3}),this.loading=!1}}editJob(t){this.router.navigate(["/jobs/edit",t])}formatDate(t){return t?t.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}):"N/A"}getStatusColor(t){switch(t){case"Unallocated":return"#F44336";case"Allocated":return"#FFC107";case"Collected":return"#2196F3";case"Delivered":return"#4CAF50";case"Cancelled":return"#9E9E9E";default:return"#9E9E9E"}}goBack(){this.router.navigate(["/vehicles"])}static \u0275fac=function(i){return new(i||e)(u(R),u(B),u(H),u(Z))};static \u0275cmp=E({type:e,selectors:[["app-vehicle-jobs"]],viewQuery:function(i,o){if(i&1&&(S(_,5),S(b,5)),i&2){let c;w(c=y())&&(o.paginator=c.first),w(c=y())&&(o.sort=c.first)}},decls:11,vars:3,consts:[[1,"vehicle-jobs-container"],[1,"page-header"],[1,"title-section"],["mat-icon-button","","color","primary",1,"back-button",3,"click"],[1,"page-title"],["class","vehicle-info",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],[1,"vehicle-info"],[1,"loading-container"],["diameter","50"],[1,"table-container"],["mat-table","","matSort","",1,"jobs-table",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","vehicle"],["matColumnDef","status"],["matColumnDef","deliveryDate"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","","class","job-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","","aria-label","Select page of jobs",3,"pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"vehicle-reg"],[1,"status-badge"],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click","matTooltip"],["mat-header-row",""],["mat-row","",1,"job-row",3,"click"],[1,"mat-row"],["colspan","5",1,"mat-cell"]],template:function(i,o){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),g("click",function(){return o.goBack()}),n(4,"mat-icon"),l(5,"arrow_back"),a()(),n(6,"h1",4),l(7," Vehicle Jobs: "),s(8,Ce,2,3,"span",5),a()()(),s(9,Me,2,0,"div",6)(10,Te,21,7,"div",7),a()),i&2&&(r(8),d("ngIf",o.vehicleData),r(),d("ngIf",o.loading),r(),d("ngIf",!o.loading))},dependencies:[T,O,ge,ae,le,me,ce,re,pe,se,de,he,ue,fe,ne,b,oe,ie,_,G,L,W,K,q,Y,X,te,ee,F],styles:[".vehicle-jobs-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.page-header[_ngcontent-%COMP%]   .title-section[_ngcontent-%COMP%]{display:flex;align-items:center}.page-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 768px){.page-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:16px}}.page-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin:0}.page-title[_ngcontent-%COMP%]   .vehicle-info[_ngcontent-%COMP%]{font-weight:400;color:#c19a6b}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;box-shadow:0 2px 10px #0000001a;overflow:hidden}.jobs-table[_ngcontent-%COMP%]{width:100%}.jobs-table[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:#f5f5f5;font-weight:500;color:#4a3c31;white-space:nowrap}.jobs-table[_ngcontent-%COMP%]   .mat-mdc-cell[_ngcontent-%COMP%]{color:#333}.jobs-table[_ngcontent-%COMP%]   .job-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s}.jobs-table[_ngcontent-%COMP%]   .job-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.vehicle-reg[_ngcontent-%COMP%]{font-size:12px;color:#666}.status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;color:#fff;font-size:12px;font-weight:500;display:inline-block;min-width:80px;text-align:center}.mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}.mat-mdc-paginator[_ngcontent-%COMP%]{background-color:#f5f5f5}"]})};export{be as VehicleJobsComponent};
