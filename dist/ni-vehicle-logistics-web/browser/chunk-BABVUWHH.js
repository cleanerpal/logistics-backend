import{a as j,b as ct}from"./chunk-VWFB2ZCV.js";import"./chunk-6ZM5HFJH.js";import{c as dt}from"./chunk-4TDDZIB3.js";import{a as St}from"./chunk-A3IKIUS4.js";import"./chunk-DJMXPRNS.js";import"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import"./chunk-FL7UC7QU.js";import{a as E,b as mt,c as pt}from"./chunk-RGR4672A.js";import{a as ut,b as gt,c as ht,d as Ct,e as ft,f as bt,g as _t,h as vt,i as Mt,j as xt,l as yt,m as Dt}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as W,b as K,c as X,d as Z,f as tt,h as et}from"./chunk-OFY7VGJP.js";import"./chunk-P7ITNQJW.js";import{a as rt,b as st}from"./chunk-HDC6EVXZ.js";import{b as lt}from"./chunk-Q2NIOR5G.js";import{C as at,H as nt,I as it,J as ot}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import{c as Q,g as U}from"./chunk-4PPYA6ZN.js";import{ea as A,ga as L,h as N,j as $,ka as O,o as q,pa as w,ra as Y,ta as G,ua as z,xa as T}from"./chunk-3O2P3FIP.js";import{$b as y,Cb as p,Db as B,Lb as n,Mb as i,Nb as _,Ob as u,Pb as g,Rb as I,Vb as J,Wb as C,ac as D,bc as S,db as l,fc as o,ga as x,gc as P,hc as v,ic as H,pa as R,pb as F,pc as V,qa as k,vb as m}from"./chunk-NXWLSP6D.js";import{g as b}from"./chunk-RA2WU32H.js";var jt=["jobStatusChart"],Et=()=>[5,10,25];function Rt(e,t){e&1&&(n(0,"div",5),_(1,"mat-spinner",6),i())}function kt(e,t){e&1&&(n(0,"th",30),o(1,"Job ID"),i())}function It(e,t){if(e&1&&(n(0,"td",31),o(1),i()),e&2){let a=t.$implicit;l(),P(a.id)}}function Jt(e,t){e&1&&(n(0,"th",30),o(1,"Vehicle"),i())}function At(e,t){if(e&1&&(n(0,"td",31),o(1),n(2,"div",32),o(3),i()()),e&2){let a=t.$implicit;l(),H(" ",a.vehicleMake," ",a.vehicleModel," "),l(2),P(a.vehicleRegistration)}}function zt(e,t){e&1&&(n(0,"th",30),o(1,"Status"),i())}function Ft(e,t){if(e&1&&(n(0,"td",31)(1,"span",33),o(2),i()()),e&2){let a=t.$implicit,s=C(2);l(),B("background-color",s.getStatusColor(a.status)),l(),v(" ",a.status," ")}}function Bt(e,t){e&1&&(n(0,"th",30),o(1," Current Driver "),i())}function Ht(e,t){if(e&1&&(n(0,"td",31),o(1),i()),e&2){let a=t.$implicit;l(),P(a.driverName)}}function Vt(e,t){e&1&&(n(0,"th",30),o(1," Scheduled Delivery "),i())}function Nt(e,t){if(e&1&&(n(0,"td",31),o(1),i()),e&2){let a=t.$implicit,s=C(2);l(),v(" ",s.formatDate(a.plannedDeliveryTime)," ")}}function $t(e,t){e&1&&(n(0,"th",34),o(1,"Actions"),i())}function qt(e,t){if(e&1){let a=I();n(0,"td",31)(1,"button",35),J("click",function(){let r=R(a).$implicit,c=C(2);return k(c.viewJobDetails(r.id))}),n(2,"mat-icon"),o(3,"edit"),i()()()}}function Qt(e,t){e&1&&_(0,"tr",36)}function Ut(e,t){if(e&1){let a=I();n(0,"tr",37),J("click",function(){let r=R(a).$implicit,c=C(2);return k(c.viewJobDetails(r.id))}),i()}}function Lt(e,t){e&1&&(n(0,"div",38),o(1," No jobs found "),i())}function Yt(e,t){if(e&1&&(n(0,"div",7)(1,"div",8)(2,"mat-card",9)(3,"mat-card-header")(4,"mat-card-title"),o(5,"Delivery Stats"),i(),n(6,"mat-card-subtitle"),o(7,"Current Month Performance"),i()(),n(8,"mat-card-content")(9,"div",10),o(10),i(),n(11,"div",11),o(12),i()()(),n(13,"mat-card",12)(14,"mat-card-header")(15,"mat-card-title"),o(16,"Job Overview"),i(),n(17,"mat-card-subtitle"),o(18,"Current Status Distribution"),i()(),n(19,"mat-card-content")(20,"div",13),_(21,"canvas",null,0),i()()()(),n(23,"mat-card",14)(24,"mat-card-header")(25,"mat-card-title"),o(26,"Recent Jobs"),i(),n(27,"mat-card-subtitle"),o(28,"Last 10 jobs in the system"),i()(),n(29,"mat-card-content")(30,"div",15)(31,"table",16),u(32,17),m(33,kt,2,0,"th",18)(34,It,2,1,"td",19),g(),u(35,20),m(36,Jt,2,0,"th",18)(37,At,4,3,"td",19),g(),u(38,21),m(39,zt,2,0,"th",18)(40,Ft,3,3,"td",19),g(),u(41,22),m(42,Bt,2,0,"th",18)(43,Ht,2,1,"td",19),g(),u(44,23),m(45,Vt,2,0,"th",18)(46,Nt,2,1,"td",19),g(),u(47,24),m(48,$t,2,0,"th",25)(49,qt,4,0,"td",19),g(),m(50,Qt,1,0,"tr",26)(51,Ut,1,0,"tr",27),i(),m(52,Lt,2,0,"div",28),_(53,"mat-paginator",29),i()()()()),e&2){let a=C();l(9),p("ngClass",a.deliveryRatingClass),l(),v(" ",a.onTimePercentage,"% On-Time "),l(2),v(" ",a.completedJobsCount," Jobs Completed "),l(19),p("dataSource",a.dataSource),l(19),p("matHeaderRowDef",a.displayedColumns),l(),p("matRowDefColumns",a.displayedColumns),l(),p("ngIf",a.dataSource.data.length===0),l(),p("pageSizeOptions",V(8,Et))}}var Pt=class e{firestore=x(L);snackBar=x(lt);router=x(Q);jobStatusChartRef;jobStatusChart;paginator;sort;loading=!0;dataSource=new Dt;displayedColumns=["id","vehicle","status","driver","deliveryDate","actions"];jobStatusCounts={Unallocated:0,Allocated:0,Collected:0,Delivered:0};onTimePercentage=0;completedJobsCount=0;deliveryRatingClass="poor";constructor(){}ngOnInit(){this.loadDashboardData()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnDestroy(){this.jobStatusChart&&this.jobStatusChart.destroy()}loadDashboardData(){return b(this,null,function*(){this.loading=!0;try{yield this.loadRecentJobs(),yield this.loadJobStatusCounts(),yield this.loadDeliveryStats(),this.initializeJobStatusChart(),this.loading=!1}catch(t){console.error("Error loading dashboard data:",t),this.snackBar.open("Error loading dashboard data. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]}),this.loading=!1}})}loadRecentJobs(){return b(this,null,function*(){try{let t=O(this.firestore,"Jobs"),a=z(t,G("createdAt","desc"),Y(10)),s=yield w(a),r=[];s.forEach(c=>{let d=c.data();r.push({id:c.id,vehicleMake:d.vehicleMake||"",vehicleModel:d.vehicleModel||"",vehicleRegistration:d.vehicleRegistration||"",status:d.status||"Unallocated",driverName:d.driverName||"Unassigned",plannedDeliveryTime:d.plannedDeliveryTime,actualDeliveryTime:d.actualDeliveryTime,completedAt:d.completedAt,createdAt:d.createdAt})}),this.dataSource.data=r}catch(t){console.error("Error loading recent jobs:",t),this.snackBar.open("Error loading recent jobs. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}loadJobStatusCounts(){return b(this,null,function*(){try{let t=O(this.firestore,"Jobs"),a=yield w(t);this.jobStatusCounts={Unallocated:0,Allocated:0,Collected:0,Delivered:0},a.forEach(s=>{let r=s.data().status;r&&this.jobStatusCounts[r]!==void 0&&this.jobStatusCounts[r]++})}catch(t){console.error("Error loading job status counts:",t),this.snackBar.open("Error loading job statistics. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}loadDeliveryStats(){return b(this,null,function*(){try{let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),1),s=new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59),r=O(this.firestore,"Jobs"),c=z(r,T("completedAt",">=",A.fromDate(a)),T("completedAt","<=",A.fromDate(s)),T("status","==","Delivered")),d=yield w(c),f=0,h=0;d.forEach(Ot=>{let M=Ot.data();if(h++,M.plannedDeliveryTime&&M.actualDeliveryTime){let wt=M.plannedDeliveryTime.toDate().getTime(),Tt=M.actualDeliveryTime.toDate().getTime();Math.abs(Tt-wt)/(1e3*60)<=30&&f++}}),this.completedJobsCount=h,this.onTimePercentage=h>0?Math.round(f/h*100):0,this.onTimePercentage>=80?this.deliveryRatingClass="excellent":this.onTimePercentage>=60?this.deliveryRatingClass="average":this.deliveryRatingClass="poor"}catch(t){console.error("Error loading delivery stats:",t),this.snackBar.open("Error loading delivery statistics. Please try again.","Close",{duration:5e3,panelClass:["error-snackbar"]})}})}initializeJobStatusChart(){if(!this.jobStatusChartRef)return;let t=this.jobStatusChartRef.nativeElement.getContext("2d");if(!t)return;let a=Object.values(this.jobStatusCounts).reduce((c,d)=>c+d,0),r={type:"pie",data:{labels:Object.keys(this.jobStatusCounts),datasets:[{data:Object.values(this.jobStatusCounts),backgroundColor:["#C19A6B","#4A3C31","#333333","#5D4037"],borderWidth:1,borderColor:"#F5F5F5"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{padding:20,usePointStyle:!0}},tooltip:{callbacks:{label:c=>{let d=c.label||"",f=c.raw,h=a>0?Math.round(f/a*100):0;return`${d}: ${f} (${h}%)`}}}}}};this.jobStatusChart=new St(t,r)}viewJobDetails(t){this.router.navigate(["/jobs/edit",t])}getStatusColor(t){switch(t){case"Unallocated":return"#F44336";case"Allocated":return"#FFC107";case"Collected":return"#2196F3";case"Delivered":return"#4CAF50";default:return"#9E9E9E"}}formatDate(t){return t?t.toDate().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A"}static \u0275fac=function(a){return new(a||e)};static \u0275cmp=F({type:e,selectors:[["app-dashboard"]],viewQuery:function(a,s){if(a&1&&(y(jt,5),y(j,5),y(E,5)),a&2){let r;D(r=S())&&(s.jobStatusChartRef=r.first),D(r=S())&&(s.paginator=r.first),D(r=S())&&(s.sort=r.first)}},decls:5,vars:2,consts:[["jobStatusChart",""],[1,"dashboard-container"],[1,"dashboard-title"],["class","loading-container",4,"ngIf"],["class","dashboard-content",4,"ngIf"],[1,"loading-container"],["diameter","50"],[1,"dashboard-content"],[1,"stats-row"],[1,"stats-card","delivery-stats"],[1,"delivery-percentage",3,"ngClass"],[1,"delivery-count"],[1,"stats-card","job-overview"],[1,"chart-container"],[1,"jobs-table-card"],[1,"table-container"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","vehicle"],["matColumnDef","status"],["matColumnDef","driver"],["matColumnDef","deliveryDate"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","job-row",3,"click",4,"matRowDef","matRowDefColumns"],["class","no-data-message",4,"ngIf"],["showFirstLastButtons","",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"vehicle-reg"],[1,"status-badge"],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row","",1,"job-row",3,"click"],[1,"no-data-message"]],template:function(a,s){a&1&&(n(0,"div",1)(1,"h1",2),o(2,"Dashboard"),i(),m(3,Rt,2,0,"div",3)(4,Yt,54,9,"div",4),i()),a&2&&(l(3),p("ngIf",s.loading),l(),p("ngIf",!s.loading))},dependencies:[q,N,$,et,W,X,tt,Z,K,yt,ut,ht,_t,Ct,gt,vt,ft,bt,Mt,xt,ot,it,nt,at,dt,ct,j,pt,E,mt,st,rt,U],styles:[".dashboard-container[_ngcontent-%COMP%]{padding:20px;background-color:#f5f5f5;min-height:100%}.dashboard-title[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:#4a3c31;margin-bottom:24px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:200px}.dashboard-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.stats-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px;margin-bottom:16px}.stats-card[_ngcontent-%COMP%]{height:100%;border-radius:8px;box-shadow:0 2px 10px #0000001a}.stats-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.stats-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:4px}.stats-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.stats-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px;display:flex;flex-direction:column;justify-content:center;height:calc(100% - 70px)}.delivery-stats[_ngcontent-%COMP%]   .delivery-percentage[_ngcontent-%COMP%]{font-size:36px;font-weight:700;margin-bottom:8px;text-align:center}.delivery-stats[_ngcontent-%COMP%]   .delivery-percentage.excellent[_ngcontent-%COMP%]{color:#4caf50}.delivery-stats[_ngcontent-%COMP%]   .delivery-percentage.average[_ngcontent-%COMP%]{color:#ffc107}.delivery-stats[_ngcontent-%COMP%]   .delivery-percentage.poor[_ngcontent-%COMP%]{color:#f44336}.delivery-stats[_ngcontent-%COMP%]   .delivery-count[_ngcontent-%COMP%]{font-size:18px;color:#666;text-align:center}.job-overview[_ngcontent-%COMP%]   .chart-container[_ngcontent-%COMP%]{height:250px;position:relative}.jobs-table-card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 10px #0000001a}.jobs-table-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px 16px 0}.jobs-table-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-title[_ngcontent-%COMP%]{color:#4a3c31;font-size:18px;margin-bottom:4px}.jobs-table-card[_ngcontent-%COMP%]   .mat-mdc-card-header[_ngcontent-%COMP%]   .mat-mdc-card-subtitle[_ngcontent-%COMP%]{color:#666;font-size:14px}.jobs-table-card[_ngcontent-%COMP%]   .mat-mdc-card-content[_ngcontent-%COMP%]{padding:16px}.table-container[_ngcontent-%COMP%]{width:100%;overflow-x:auto}.table-container[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%}.table-container[_ngcontent-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:500;color:#4a3c31}.table-container[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{cursor:pointer}.table-container[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#c19a6b0d}.table-container[_ngcontent-%COMP%]   .vehicle-reg[_ngcontent-%COMP%]{font-size:12px;color:#666}.table-container[_ngcontent-%COMP%]   .status-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:16px;color:#fff;font-size:12px;font-weight:500;display:inline-block;min-width:80px;text-align:center}.table-container[_ngcontent-%COMP%]   .no-data-message[_ngcontent-%COMP%]{padding:20px;text-align:center;color:#666;font-style:italic}@media (max-width: 768px){.stats-row[_ngcontent-%COMP%]{grid-template-columns:1fr}.delivery-stats[_ngcontent-%COMP%], .job-overview[_ngcontent-%COMP%]{height:auto}.chart-container[_ngcontent-%COMP%]{height:200px!important}.mat-column-driver[_ngcontent-%COMP%], .mat-column-actions[_ngcontent-%COMP%]{display:none}}@media (max-width: 480px){.dashboard-container[_ngcontent-%COMP%]{padding:12px}.mat-column-deliveryDate[_ngcontent-%COMP%]{display:none}.delivery-percentage[_ngcontent-%COMP%]{font-size:28px!important}.delivery-count[_ngcontent-%COMP%]{font-size:16px!important}}"]})};export{Pt as DashboardComponent};
