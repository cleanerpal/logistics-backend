import{a as Wt}from"./chunk-3LXRQY3K.js";import"./chunk-F5X5MWHG.js";import{a as D,b as At}from"./chunk-VWFB2ZCV.js";import{a as Ot,b as Dt}from"./chunk-6ZM5HFJH.js";import{a as bt,b as yt,c as Lt}from"./chunk-4TDDZIB3.js";import{a as Jt,d as Qt,e as jt,f as Bt,g as Gt,h as qt,i as Kt}from"./chunk-PQIIHW7R.js";import"./chunk-GW6WOXIL.js";import"./chunk-MS4AQ6UA.js";import{b as gt,c as ut}from"./chunk-LDLE5TDT.js";import{a as wt,b as Pt}from"./chunk-DJMXPRNS.js";import{d as St}from"./chunk-U5UIMM6O.js";import"./chunk-PP7BOOB7.js";import{a as pt}from"./chunk-FL7UC7QU.js";import{a as A,b as Tt,c as Et}from"./chunk-RGR4672A.js";import{a as T,b as It,c as kt,d as Ft,e as Rt,f as Nt,g as Vt,h as Ut,i as zt,j as Ht,l as $t}from"./chunk-HITQB7VJ.js";import"./chunk-DQFV6XNM.js";import{a as nt,b as ot,c as at,d as rt,f as lt,h as st}from"./chunk-OFY7VGJP.js";import{b as ct,f as dt,i as mt}from"./chunk-P7ITNQJW.js";import{a as vt,b as xt}from"./chunk-HDC6EVXZ.js";import{C as ft,E as _t,H as Ct,I as ht,J as Mt,b as q,g as K,h as W,i as k,k as y,l as X,o as Y,p as Z,q as tt,v as et,w as it}from"./chunk-E6Y7ME2X.js";import"./chunk-ZO4V6NUC.js";import"./chunk-M4BJXN77.js";import"./chunk-4PPYA6ZN.js";import{h as H,i as $,j as J,l as Q,o as j,ra as B,ta as G,xa as O}from"./chunk-3O2P3FIP.js";import{$b as S,Cb as c,H as R,L as N,Lb as o,Mb as n,Nb as g,Ob as M,Pb as v,Rb as L,Vb as x,Wb as m,a as F,ac as w,bc as P,db as r,ec as z,fc as a,gc as b,hc as u,ib as V,pa as C,pb as U,qa as h,tc as E,vb as d,vc as I}from"./chunk-NXWLSP6D.js";import"./chunk-RA2WU32H.js";function Zt(e,i){if(e&1&&(o(0,"mat-option",23),a(1),n()),e&2){let t=i.$implicit;c("value",t),r(),u(" ",t," ")}}function te(e,i){e&1&&(o(0,"div",24),g(1,"mat-spinner",25),o(2,"p"),a(3,"Loading audit logs..."),n()())}function ee(e,i){e&1&&(o(0,"div",30)(1,"mat-icon"),a(2,"history"),n(),o(3,"p"),a(4,"No audit logs found matching your criteria"),n()())}function ie(e,i){e&1&&(o(0,"th",42),a(1,"Timestamp"),n())}function ne(e,i){if(e&1&&(o(0,"td",43)(1,"div",44)(2,"div",45),a(3),E(4,"date"),n(),o(5,"div",46),a(6),E(7,"date"),n()()()),e&2){let t=i.$implicit;r(3),u(" ",I(4,2,t.timestamp,"MMM d, yyyy")," "),r(3),u(" ",I(7,5,t.timestamp,"h:mm:ss a")," ")}}function oe(e,i){e&1&&(o(0,"th",42),a(1,"Action"),n())}function ae(e,i){if(e&1&&(o(0,"td",43)(1,"mat-chip-set")(2,"mat-chip",47),a(3),n()()()),e&2){let t=i.$implicit;r(2),c("ngClass","action-chip-"+t.action),r(),b(t.action)}}function re(e,i){e&1&&(o(0,"th",42),a(1,"User"),n())}function le(e,i){if(e&1&&(o(0,"span",51),a(1),n()),e&2){let t=m().$implicit;r(),u("ID: ",t.userId,"")}}function se(e,i){if(e&1&&(o(0,"span",52),a(1),n()),e&2){let t=m().$implicit;r(),u("IP: ",t.ipAddress,"")}}function ce(e,i){if(e&1&&(o(0,"td",43)(1,"div",48)(2,"span"),a(3),n(),d(4,le,2,1,"span",49)(5,se,2,1,"span",50),n()()),e&2){let t=i.$implicit;r(3),b(t.userName||"Unknown User"),r(),c("ngIf",t.userId),r(),c("ngIf",t.ipAddress)}}function de(e,i){e&1&&(o(0,"th",42),a(1,"Resource"),n())}function me(e,i){if(e&1&&(o(0,"span"),a(1),n()),e&2){let t=m().$implicit;r(),b(t.resource)}}function pe(e,i){if(e&1&&(o(0,"span",55),a(1),n()),e&2){let t=m().$implicit;r(),u("ID: ",t.resourceId,"")}}function ge(e,i){e&1&&(o(0,"span"),a(1,"-"),n())}function ue(e,i){if(e&1&&(o(0,"td",43),d(1,me,2,1,"span",53)(2,pe,2,1,"span",54)(3,ge,2,0,"span",53),n()),e&2){let t=i.$implicit;r(),c("ngIf",t.resource),r(),c("ngIf",t.resourceId),r(),c("ngIf",!t.resource&&!t.resourceId)}}function fe(e,i){e&1&&(o(0,"th",56),a(1,"Details"),n())}function _e(e,i){if(e&1&&(o(0,"div",59)(1,"pre"),a(2),n()()),e&2){let t=m().$implicit,l=m(3);r(2),b(l.formatDetails(t.details))}}function Ce(e,i){if(e&1){let t=L();o(0,"td",43)(1,"button",57),x("click",function(){let s=C(t).$implicit;return h(s.showDetails=!s.showDetails)}),o(2,"mat-icon"),a(3),n()(),d(4,_e,3,1,"div",58),n()}if(e&2){let t=i.$implicit;r(3),b(t.showDetails?"expand_less":"expand_more"),r(),c("ngIf",t.showDetails)}}function he(e,i){e&1&&g(0,"tr",60)}function Me(e,i){e&1&&g(0,"tr",61)}function ve(e,i){if(e&1&&(o(0,"table",31),M(1,32),d(2,ie,2,0,"th",33)(3,ne,8,8,"td",34),v(),M(4,35),d(5,oe,2,0,"th",33)(6,ae,4,2,"td",34),v(),M(7,36),d(8,re,2,0,"th",33)(9,ce,6,3,"td",34),v(),M(10,37),d(11,de,2,0,"th",33)(12,ue,4,3,"td",34),v(),M(13,38),d(14,fe,2,0,"th",39)(15,Ce,5,2,"td",34),v(),d(16,he,1,0,"tr",40)(17,Me,1,0,"tr",41),n()),e&2){let t=m(2);c("dataSource",t.filteredData),r(16),c("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),r(),c("matRowDefColumns",t.displayedColumns)}}function xe(e,i){if(e&1){let t=L();o(0,"div",26),d(1,ee,5,0,"div",27)(2,ve,18,4,"table",28),o(3,"mat-paginator",29),x("page",function(s){C(t);let f=m();return h(f.onPageChange(s))}),n()()}if(e&2){let t=m();r(),c("ngIf",t.filteredData.length===0),r(),c("ngIf",t.filteredData.length>0),r(),c("pageSizeOptions",t.pageSizeOptions)("pageSize",t.pageSize)("length",t.totalLogs)}}var Xt=class e{constructor(i){this.auditLogsService=i}paginator;sort;table;displayedColumns=["timestamp","action","userName","resource","details"];dataSource=[];filteredData=[];isLoading=!0;totalLogs=0;pageSize=50;pageSizeOptions=[10,25,50,100];actionTypes=["UserCreated","UserUpdated","UserDeleted","DriverCreated","DriverUpdated","DriverDeleted","DriverHandover","VehicleCreated","VehicleUpdated","VehicleDeleted","JobCreated","JobUpdated","JobDeleted","JobAssigned","JobCompleted","PaymentProcessed","LoginSuccess","LoginFailed"];filterForm=new k({searchTerm:new y(""),actionType:new y(""),dateRange:new k({start:new y(null),end:new y(null)})});subscription=new F;ngOnInit(){this.loadAuditLogs(),this.subscription.add(this.filterForm.get("searchTerm").valueChanges.pipe(R(300),N()).subscribe(()=>this.applyFilters())),this.subscription.add(this.filterForm.get("actionType").valueChanges.subscribe(()=>this.applyFilters())),this.subscription.add(this.filterForm.get("dateRange").valueChanges.subscribe(()=>this.applyFilters()))}ngOnDestroy(){this.subscription.unsubscribe()}loadAuditLogs(){this.isLoading=!0;let i=[G("timestamp","desc"),B(this.pageSize)],t=this.filterForm.get("actionType")?.value;t&&i.push(O("action","==",t));let l=this.filterForm.get("dateRange")?.value;if(l?.start&&i.push(O("timestamp",">=",l.start)),l?.end){let s=new Date(l.end);s.setDate(s.getDate()+1),i.push(O("timestamp","<",s))}this.subscription.add(this.auditLogsService.getAuditLogs(i).subscribe(s=>{this.dataSource=s,this.applyFilters(),this.isLoading=!1}))}applyFilters(){let i=[...this.dataSource],t=this.filterForm.get("searchTerm")?.value?.toLowerCase();t&&(i=i.filter(l=>l.userName?.toLowerCase().includes(t)||l.action?.toLowerCase().includes(t)||l.resource?.toLowerCase().includes(t)||typeof l.details=="string"&&l.details.toLowerCase().includes(t))),this.filteredData=i,this.totalLogs=this.filteredData.length,this.paginator&&this.paginator.firstPage()}resetFilters(){this.filterForm.reset(),this.loadAuditLogs()}onPageChange(i){this.pageSize=i.pageSize,this.loadAuditLogs()}formatDetails(i){if(!i)return"No details available";if(typeof i=="object")try{return JSON.stringify(i,null,2)}catch{return"Error formatting details"}return i.toString()}exportToCsv(){let i=["Timestamp","Action","User","Resource","Details"],t=this.filteredData.map(p=>[p.timestamp.toLocaleString(),p.action,p.userName,p.resource||"",typeof p.details=="object"?JSON.stringify(p.details):p.details||""]);t.unshift(i);let l=t.map(p=>p.map(Yt=>`"${String(Yt).replace(/"/g,'""')}"`).join(",")).join(`
`),s=new Blob([l],{type:"text/csv;charset=utf-8;"}),f=URL.createObjectURL(s),_=document.createElement("a");_.setAttribute("href",f),_.setAttribute("download",`audit-logs-${new Date().toISOString().slice(0,10)}.csv`),_.style.visibility="hidden",document.body.appendChild(_),_.click(),document.body.removeChild(_)}static \u0275fac=function(t){return new(t||e)(V(Wt))};static \u0275cmp=U({type:e,selectors:[["app-audit-logs-list"]],viewQuery:function(t,l){if(t&1&&(S(D,5),S(A,5),S(T,5)),t&2){let s;w(s=P())&&(l.paginator=s.first),w(s=P())&&(l.sort=s.first),w(s=P())&&(l.table=s.first)}},decls:48,vars:6,consts:[["picker",""],[1,"audit-logs-container"],[1,"filter-card"],[3,"formGroup"],[1,"filters-row"],["appearance","outline",1,"search-field"],["matInput","","formControlName","searchTerm","placeholder","Search by user or details"],["matSuffix",""],["appearance","outline"],["formControlName","actionType"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formGroupName","dateRange",1,"date-range-container"],[3,"rangePicker"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date"],["matSuffix","",3,"for"],[1,"filter-buttons"],["mat-flat-button","","color","primary",1,"primary-button",3,"click"],["mat-stroked-button","","color","warn",3,"click"],["mat-stroked-button","","color","primary",3,"click"],["class","loading-container",4,"ngIf"],["class","table-container",4,"ngIf"],[3,"value"],[1,"loading-container"],["diameter","40"],[1,"table-container"],["class","no-data",4,"ngIf"],["mat-table","","matSort","",3,"dataSource",4,"ngIf"],["showFirstLastButtons","",3,"page","pageSizeOptions","pageSize","length"],[1,"no-data"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","timestamp"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","action"],["matColumnDef","userName"],["matColumnDef","resource"],["matColumnDef","details"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"timestamp-cell"],[1,"timestamp-date"],[1,"timestamp-time"],[3,"ngClass"],[1,"user-cell"],["class","user-id",4,"ngIf"],["class","ip-address",4,"ngIf"],[1,"user-id"],[1,"ip-address"],[4,"ngIf"],["class","resource-id",4,"ngIf"],[1,"resource-id"],["mat-header-cell",""],["mat-icon-button","","matTooltip","View Details",3,"click"],["class","details-panel",4,"ngIf"],[1,"details-panel"],["mat-header-row",""],["mat-row",""]],template:function(t,l){if(t&1){let s=L();o(0,"div",1)(1,"mat-card",2)(2,"mat-card-header")(3,"mat-card-title"),a(4,"Audit Logs"),n(),o(5,"mat-card-subtitle"),a(6,"View system activity records"),n()(),o(7,"mat-card-content")(8,"form",3)(9,"div",4)(10,"mat-form-field",5)(11,"mat-label"),a(12,"Search"),n(),g(13,"input",6),o(14,"mat-icon",7),a(15,"search"),n()(),o(16,"mat-form-field",8)(17,"mat-label"),a(18,"Action Type"),n(),o(19,"mat-select",9)(20,"mat-option",10),a(21,"All Actions"),n(),d(22,Zt,2,2,"mat-option",11),n()(),o(23,"div",12)(24,"mat-form-field",8)(25,"mat-label"),a(26,"Date Range"),n(),o(27,"mat-date-range-input",13),g(28,"input",14)(29,"input",15),n(),g(30,"mat-datepicker-toggle",16)(31,"mat-date-range-picker",null,0),n()(),o(33,"div",17)(34,"button",18),x("click",function(){return C(s),h(l.loadAuditLogs())}),o(35,"mat-icon"),a(36,"filter_list"),n(),a(37," Apply "),n(),o(38,"button",19),x("click",function(){return C(s),h(l.resetFilters())}),o(39,"mat-icon"),a(40,"clear"),n(),a(41," Reset "),n(),o(42,"button",20),x("click",function(){return C(s),h(l.exportToCsv())}),o(43,"mat-icon"),a(44,"file_download"),n(),a(45," Export "),n()()()()()(),d(46,te,4,0,"div",21)(47,xe,4,5,"div",22),n()}if(t&2){let s=z(32);r(8),c("formGroup",l.filterForm),r(14),c("ngForOf",l.actionTypes),r(5),c("rangePicker",s),r(3),c("for",s),r(16),c("ngIf",l.isLoading),r(),c("ngIf",!l.isLoading)}},dependencies:[j,H,$,J,Q,et,X,q,K,W,it,Y,tt,Z,$t,T,kt,Vt,Ft,It,Ut,Rt,Nt,zt,Ht,At,D,Et,A,Tt,ut,gt,mt,ct,dt,pt,Kt,Qt,jt,Bt,Gt,qt,Jt,Ct,_t,ft,Mt,ht,Pt,wt,St,st,nt,at,lt,rt,ot,xt,vt,Dt,Ot,Lt,bt,yt],styles:[".audit-logs-container[_ngcontent-%COMP%]{padding:20px;background-color:var(--background-color);min-height:calc(100vh - 64px)}.filter-card[_ngcontent-%COMP%]{margin-bottom:20px;background-color:#fff;border-radius:8px}.filter-card[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{color:var(--secondary-color);font-weight:500;padding:8px 0}.filter-card[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{color:var(--medium-gray)}.filters-row[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start}@media (max-width: 768px){.filters-row[_ngcontent-%COMP%]{flex-direction:column}}.filters-row[_ngcontent-%COMP%]   .search-field[_ngcontent-%COMP%]{flex:1;min-width:200px}.filters-row[_ngcontent-%COMP%]   .date-range-container[_ngcontent-%COMP%]{min-width:240px}.filters-row[_ngcontent-%COMP%]   .filter-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}.filters-row[_ngcontent-%COMP%]   .filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:100px}.filters-row[_ngcontent-%COMP%]   .filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:4px}@media (max-width: 768px){.filters-row[_ngcontent-%COMP%]   .filter-buttons[_ngcontent-%COMP%]{width:100%;justify-content:flex-end}}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:200px}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:16px;color:var(--medium-gray)}.table-container[_ngcontent-%COMP%]{background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 6px #0000001a}.table-container[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;color:var(--medium-gray)}.table-container[_ngcontent-%COMP%]   .no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;opacity:.5}table[_ngcontent-%COMP%]{width:100%}.mat-mdc-header-cell[_ngcontent-%COMP%]{background-color:var(--secondary-color);color:#fff;font-weight:500;padding:12px 16px}.mat-mdc-cell[_ngcontent-%COMP%]{padding:12px 16px}.mat-mdc-row[_ngcontent-%COMP%]:nth-child(2n){background-color:#00000005}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#0000000a}.timestamp-cell[_ngcontent-%COMP%]   .timestamp-date[_ngcontent-%COMP%]{font-weight:500}.timestamp-cell[_ngcontent-%COMP%]   .timestamp-time[_ngcontent-%COMP%]{font-size:.85rem;color:var(--medium-gray)}.user-cell[_ngcontent-%COMP%]{display:flex;flex-direction:column}.user-cell[_ngcontent-%COMP%]   .user-id[_ngcontent-%COMP%], .user-cell[_ngcontent-%COMP%]   .ip-address[_ngcontent-%COMP%]{font-size:.85rem;color:var(--medium-gray)}.resource-id[_ngcontent-%COMP%]{display:block;font-size:.85rem;color:var(--medium-gray)}.details-panel[_ngcontent-%COMP%]{background-color:#f9f9f9;padding:12px;border-radius:4px;margin-top:8px;margin-bottom:8px;max-height:200px;overflow:auto}.details-panel[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{margin:0;white-space:pre-wrap;font-family:monospace;font-size:.85rem}.action-chip-UserCreated[_ngcontent-%COMP%], .action-chip-DriverCreated[_ngcontent-%COMP%], .action-chip-VehicleCreated[_ngcontent-%COMP%], .action-chip-JobCreated[_ngcontent-%COMP%]{background-color:var(--success-color)!important;color:#fff!important}.action-chip-UserUpdated[_ngcontent-%COMP%], .action-chip-DriverUpdated[_ngcontent-%COMP%], .action-chip-VehicleUpdated[_ngcontent-%COMP%], .action-chip-JobUpdated[_ngcontent-%COMP%], .action-chip-JobAssigned[_ngcontent-%COMP%]{background-color:var(--info-color)!important;color:#fff!important}.action-chip-UserDeleted[_ngcontent-%COMP%], .action-chip-DriverDeleted[_ngcontent-%COMP%], .action-chip-VehicleDeleted[_ngcontent-%COMP%], .action-chip-JobDeleted[_ngcontent-%COMP%], .action-chip-LoginFailed[_ngcontent-%COMP%]{background-color:var(--error-color)!important;color:#fff!important}.action-chip-DriverHandover[_ngcontent-%COMP%], .action-chip-JobCompleted[_ngcontent-%COMP%], .action-chip-PaymentProcessed[_ngcontent-%COMP%], .action-chip-LoginSuccess[_ngcontent-%COMP%]{background-color:var(--warning-color)!important;color:#fff!important}mat-chip[_ngcontent-%COMP%]{background-color:var(--primary-color)!important;color:#fff!important}.primary-button[_ngcontent-%COMP%]{background-color:var(--primary-color)!important}.secondary-button[_ngcontent-%COMP%]{background-color:var(--secondary-color)!important}mat-paginator[_ngcontent-%COMP%]{background-color:#fafafa;border-top:1px solid var(--light-gray)}"]})};export{Xt as AuditLogsListComponent};
